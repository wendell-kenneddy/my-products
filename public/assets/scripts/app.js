/*! For license information please see app.js.LICENSE.txt */
(()=>{var t={666:t=>{var e=function(t){"use strict";var e,n=Object.prototype,r=n.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},s=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function u(t,e,n,r){var i=e&&e.prototype instanceof g?e:g,s=Object.create(i.prototype),o=new A(r||[]);return s._invoke=function(t,e,n){var r=l;return function(i,s){if(r===f)throw new Error("Generator is already running");if(r===p){if("throw"===i)throw s;return C()}for(n.method=i,n.arg=s;;){var o=n.delegate;if(o){var a=_(o,n);if(a){if(a===m)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===l)throw r=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=f;var c=h(t,e,n);if("normal"===c.type){if(r=n.done?p:d,c.arg===m)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r=p,n.method="throw",n.arg=c.arg)}}}(t,n,o),s}function h(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var l="suspendedStart",d="suspendedYield",f="executing",p="completed",m={};function g(){}function y(){}function v(){}var w={};c(w,s,(function(){return this}));var I=Object.getPrototypeOf,b=I&&I(I(D([])));b&&b!==n&&r.call(b,s)&&(w=b);var T=v.prototype=g.prototype=Object.create(w);function E(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function n(i,s,o,a){var c=h(t[i],t,s);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==typeof l&&r.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,o,a)}),(function(t){n("throw",t,o,a)})):e.resolve(l).then((function(t){u.value=t,o(u)}),(function(t){return n("throw",t,o,a)}))}a(c.arg)}var i;this._invoke=function(t,r){function s(){return new e((function(e,i){n(t,r,e,i)}))}return i=i?i.then(s,s):s()}}function _(t,n){var r=t.iterator[n.method];if(r===e){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=e,_(t,n),"throw"===n.method))return m;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var i=h(r,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,m;var s=i.arg;return s?s.done?(n[t.resultName]=s.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,m):s:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function k(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function N(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function A(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(k,this),this.reset(!0)}function D(t){if(t){var n=t[s];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function n(){for(;++i<t.length;)if(r.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return o.next=o}}return{next:C}}function C(){return{value:e,done:!0}}return y.prototype=v,c(T,"constructor",v),c(v,"constructor",y),y.displayName=c(v,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,v):(t.__proto__=v,c(t,a,"GeneratorFunction")),t.prototype=Object.create(T),t},t.awrap=function(t){return{__await:t}},E(S.prototype),c(S.prototype,o,(function(){return this})),t.AsyncIterator=S,t.async=function(e,n,r,i,s){void 0===s&&(s=Promise);var o=new S(u(e,n,r,i),s);return t.isGeneratorFunction(n)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},E(T),c(T,a,"Generator"),c(T,s,(function(){return this})),c(T,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=D,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(N),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(r,i){return a.type="throw",a.arg=t,n.next=r,i&&(n.method="next",n.arg=e),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var c=r.call(o,"catchLoc"),u=r.call(o,"finallyLoc");if(c&&u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,m):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),m},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),N(n),m}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;N(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:D(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),m}},t}(t.exports);try{regeneratorRuntime=e}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}}},e={};function n(r){var i=e[r];if(void 0!==i)return i.exports;var s=e[r]={exports:{}};return t[r](s,s.exports,n),s.exports}n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{"use strict";function t(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n}function e(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function r(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,s=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o}function i(t,e,n){if(n||2===arguments.length)for(var r,i=0,s=e.length;i<s;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))}n(666),Object.create,Object.create;const s={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let e=0;e<t.length;e+=3){const i=t[e],s=e+1<t.length,o=s?t[e+1]:0,a=e+2<t.length,c=a?t[e+2]:0,u=i>>2,h=(3&i)<<4|o>>4;let l=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(l=64)),r.push(n[u],n[h],n[l],n[d])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128)}return e}(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let n=0,r=0;for(;n<t.length;){const i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=t[n++];e[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(s>>10)),e[r++]=String.fromCharCode(56320+(1023&s))}else{const s=t[n++],o=t[n++];e[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let e=0;e<t.length;){const i=n[t.charAt(e++)],s=e<t.length?n[t.charAt(e)]:0;++e;const o=e<t.length?n[t.charAt(e)]:64;++e;const a=e<t.length?n[t.charAt(e)]:64;if(++e,null==i||null==s||null==o||null==a)throw Error();const c=i<<2|s>>4;if(r.push(c),64!==o){const t=s<<4&240|o>>2;if(r.push(t),64!==a){const t=o<<6&192|a;r.push(t)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class o{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),"function"==typeof t&&(this.promise.catch((()=>{})),1===t.length?t(e):t(e,n))}}}function a(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function c(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(a())}function u(){const t="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof t&&void 0!==t.id}function h(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function l(){const t=a();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}class d extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,d.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,f.prototype.create)}}class f{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},r=`${this.service}/${t}`,i=this.errors[t],s=i?function(t,e){return t.replace(p,((t,n)=>{const r=e[n];return null!=r?String(r):`<${n}?>`}))}(i,n):"Error",o=`${this.serviceName}: ${s} (${r}).`;return new d(r,o,n)}}const p=/\{\$([^}]+)}/g;function m(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const i of n){if(!r.includes(i))return!1;const n=t[i],s=e[i];if(g(n)&&g(s)){if(!m(n,s))return!1}else if(n!==s)return!1}for(const t of r)if(!n.includes(t))return!1;return!0}function g(t){return null!==t&&"object"==typeof t}function y(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach((t=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(t))})):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function v(t){const e={};return t.replace(/^\?/,"").split("&").forEach((t=>{if(t){const[n,r]=t.split("=");e[decodeURIComponent(n)]=decodeURIComponent(r)}})),e}function w(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}class I{constructor(t,e){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then((()=>{t(this)})).catch((t=>{this.error(t)}))}next(t){this.forEachObserver((e=>{e.next(t)}))}error(t){this.forEachObserver((e=>{e.error(t)})),this.close(t)}complete(){this.forEachObserver((t=>{t.complete()})),this.close()}subscribe(t,e,n){let r;if(void 0===t&&void 0===e&&void 0===n)throw new Error("Missing Observer.");r=function(t,e){if("object"!=typeof t||null===t)return!1;for(const e of["next","error","complete"])if(e in t&&"function"==typeof t[e])return!0;return!1}(t)?t:{next:t,error:e,complete:n},void 0===r.next&&(r.next=b),void 0===r.error&&(r.error=b),void 0===r.complete&&(r.complete=b);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(t){}})),this.observers.push(r),i}unsubscribeOne(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let e=0;e<this.observers.length;e++)this.sendOne(e,t)}sendOne(t,e){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[t])try{e(this.observers[t])}catch(t){"undefined"!=typeof console&&console.error&&console.error(t)}}))}close(t){this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function b(){}function T(t){return t&&t._delegate?t._delegate:t}var E=function(){function t(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}return t.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},t.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},t.prototype.setServiceProps=function(t){return this.serviceProps=t,this},t.prototype.setInstanceCreatedCallback=function(t){return this.onInstanceCreated=t,this},t}(),S="[DEFAULT]",_=function(){function t(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}return t.prototype.get=function(t){var e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){var n=new o;if(this.instancesDeferred.set(e,n),this.isInitialized(e)||this.shouldAutoInitialize())try{var r=this.getOrInitializeService({instanceIdentifier:e});r&&n.resolve(r)}catch(t){}}return this.instancesDeferred.get(e).promise},t.prototype.getImmediate=function(t){var e,n=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),r=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error("Service "+this.name+" is not available")}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(t){if(r)return null;throw t}},t.prototype.getComponent=function(){return this.component},t.prototype.setComponent=function(t){var n,i;if(t.name!==this.name)throw Error("Mismatching Component "+t.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:S})}catch(t){}try{for(var s=e(this.instancesDeferred.entries()),o=s.next();!o.done;o=s.next()){var a=r(o.value,2),c=a[0],u=a[1],h=this.normalizeInstanceIdentifier(c);try{var l=this.getOrInitializeService({instanceIdentifier:h});u.resolve(l)}catch(t){}}}catch(t){n={error:t}}finally{try{o&&!o.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}}},t.prototype.clearInstance=function(t){void 0===t&&(t=S),this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)},t.prototype.delete=function(){return function(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}c((r=r.apply(t,e||[])).next())}))}(this,void 0,void 0,(function(){var t;return function(t,e){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(t){s=[6,t],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}(this,(function(e){switch(e.label){case 0:return t=Array.from(this.instances.values()),[4,Promise.all(i(i([],r(t.filter((function(t){return"INTERNAL"in t})).map((function(t){return t.INTERNAL.delete()})))),r(t.filter((function(t){return"_delete"in t})).map((function(t){return t._delete()})))))];case 1:return e.sent(),[2]}}))}))},t.prototype.isComponentSet=function(){return null!=this.component},t.prototype.isInitialized=function(t){return void 0===t&&(t=S),this.instances.has(t)},t.prototype.getOptions=function(t){return void 0===t&&(t=S),this.instancesOptions.get(t)||{}},t.prototype.initialize=function(t){var n,i;void 0===t&&(t={});var s=t.options,o=void 0===s?{}:s,a=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(a))throw Error(this.name+"("+a+") has already been initialized");if(!this.isComponentSet())throw Error("Component "+this.name+" has not been registered yet");var c=this.getOrInitializeService({instanceIdentifier:a,options:o});try{for(var u=e(this.instancesDeferred.entries()),h=u.next();!h.done;h=u.next()){var l=r(h.value,2),d=l[0],f=l[1];a===this.normalizeInstanceIdentifier(d)&&f.resolve(c)}}catch(t){n={error:t}}finally{try{h&&!h.done&&(i=u.return)&&i.call(u)}finally{if(n)throw n.error}}return c},t.prototype.onInit=function(t,e){var n,r=this.normalizeInstanceIdentifier(e),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(t),this.onInitCallbacks.set(r,i);var s=this.instances.get(r);return s&&t(s,r),function(){i.delete(t)}},t.prototype.invokeOnInitCallbacks=function(t,n){var r,i,s=this.onInitCallbacks.get(n);if(s)try{for(var o=e(s),a=o.next();!a.done;a=o.next()){var c=a.value;try{c(t,n)}catch(t){}}}catch(t){r={error:t}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}},t.prototype.getOrInitializeService=function(t){var e,n=t.instanceIdentifier,r=t.options,i=void 0===r?{}:r,s=this.instances.get(n);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:(e=n,e===S?void 0:e),options:i}),this.instances.set(n,s),this.instancesOptions.set(n,i),this.invokeOnInitCallbacks(s,n),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,n,s)}catch(t){}return s||null},t.prototype.normalizeInstanceIdentifier=function(t){return void 0===t&&(t=S),this.component?this.component.multipleInstances?t:S:t},t.prototype.shouldAutoInitialize=function(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode},t}(),k=function(){function t(t){this.name=t,this.providers=new Map}return t.prototype.addComponent=function(t){var e=this.getProvider(t.name);if(e.isComponentSet())throw new Error("Component "+t.name+" has already been registered with "+this.name);e.setComponent(t)},t.prototype.addOrOverwriteComponent=function(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)},t.prototype.getProvider=function(t){if(this.providers.has(t))return this.providers.get(t);var e=new _(t,this);return this.providers.set(t,e),e},t.prototype.getProviders=function(){return Array.from(this.providers.values())},t}();const N=[];var A;!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(A||(A={}));const D={debug:A.DEBUG,verbose:A.VERBOSE,info:A.INFO,warn:A.WARN,error:A.ERROR,silent:A.SILENT},C=A.INFO,R={[A.DEBUG]:"log",[A.VERBOSE]:"log",[A.INFO]:"info",[A.WARN]:"warn",[A.ERROR]:"error"},x=(t,e,...n)=>{if(e<t.logLevel)return;const r=(new Date).toISOString(),i=R[e];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[i](`[${r}]  ${t.name}:`,...n)};class O{constructor(t){this.name=t,this._logLevel=C,this._logHandler=x,this._userLogHandler=null,N.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in A))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?D[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,A.DEBUG,...t),this._logHandler(this,A.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,A.VERBOSE,...t),this._logHandler(this,A.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,A.INFO,...t),this._logHandler(this,A.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,A.WARN,...t),this._logHandler(this,A.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,A.ERROR,...t),this._logHandler(this,A.ERROR,...t)}}class L{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map((t=>{if(function(t){const e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null})).filter((t=>t)).join(" ")}}const P="@firebase/app",M=new O("@firebase/app"),F={[P]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},U=new Map,V=new Map;function j(t,e){try{t.container.addComponent(e)}catch(n){M.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function q(t){const e=t.name;if(V.has(e))return M.debug(`There were multiple attempts to register component ${e}.`),!1;V.set(e,t);for(const e of U.values())j(e,t);return!0}function B(t,e){return t.container.getProvider(e)}const K=new f("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function."});class z{constructor(t,e,n){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new E("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw K.create("app-deleted",{appName:this._name})}}const H="9.1.0";function G(t="[DEFAULT]"){const e=U.get(t);if(!e)throw K.create("no-app",{appName:t});return e}function $(t,e,n){var r;let i=null!==(r=F[t])&&void 0!==r?r:t;n&&(i+=`-${n}`);const s=i.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const t=[`Unable to register library "${i}" with version "${e}":`];return s&&t.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&t.push("and"),o&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void M.warn(t.join(" "))}q(new E(`${i}-version`,(()=>({library:i,version:e})),"VERSION"))}q(new E("platform-logger",(t=>new L(t)),"PRIVATE")),$(P,"0.7.1",undefined),$("fire-js",""),$("firebase","9.1.0","app");const W=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},Q=new f("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),Y=new O("@firebase/auth");function X(t,...e){Y.logLevel<=A.ERROR&&Y.error(`Auth (9.1.0): ${t}`,...e)}function J(t,...e){throw tt(t,...e)}function Z(t,...e){return tt(t,...e)}function tt(t,...e){if("string"!=typeof t){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return Q.create(t,...e)}function et(t,e,...n){if(!t)throw tt(e,...n)}function nt(t){const e="INTERNAL ASSERTION FAILED: "+t;throw X(e),new Error(e)}function rt(t,e){t||nt(e)}const it=new Map;function st(t){rt(t instanceof Function,"Expected a class definition");let e=it.get(t);return e?(rt(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,it.set(t,e),e)}function ot(){var t;return"undefined"!=typeof self&&(null===(t=self.location)||void 0===t?void 0:t.href)||""}function at(){var t;return"undefined"!=typeof self&&(null===(t=self.location)||void 0===t?void 0:t.protocol)||null}class ct{constructor(t,e){this.shortDelay=t,this.longDelay=e,rt(e>t,"Short delay should be less than long delay!"),this.isMobile=c()||h()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===at()||"https:"===at()||u()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function ut(t,e){rt(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}class ht{static initialize(t,e,n){this.fetchImpl=t,e&&(this.headersImpl=e),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void nt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void nt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void nt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const lt={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},dt=new ct(3e4,6e4);function ft(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function pt(t,e,n,r,i={}){return mt(t,i,(()=>{let i={},s={};r&&("GET"===e?s=r:i={body:JSON.stringify(r)});const o=y(Object.assign({key:t.config.apiKey},s)).slice(1),a=new(ht.headers());return a.set("Content-Type","application/json"),a.set("X-Client-Version",t._getSdkClientVersion()),t.languageCode&&a.set("X-Firebase-Locale",t.languageCode),ht.fetch()(yt(t,t.config.apiHost,n,o),Object.assign({method:e,headers:a,referrerPolicy:"no-referrer"},i))}))}async function mt(t,e,n){t._canInitEmulator=!1;const r=Object.assign(Object.assign({},lt),e);try{const e=new vt(t),i=await Promise.race([n(),e.promise]);e.clearNetworkTimeout();const s=await i.json();if("needConfirmation"in s)throw wt(t,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{const e=i.ok?s.errorMessage:s.error.message,[n,o]=e.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw wt(t,"credential-already-in-use",s);if("EMAIL_EXISTS"===n)throw wt(t,"email-already-in-use",s);const a=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw function(t,e,n){const r=Object.assign(Object.assign({},W()),{[e]:n});return new f("auth","Firebase",r).create(e,{appName:t.name})}(t,a,o);J(t,a)}}catch(e){if(e instanceof d)throw e;J(t,"network-request-failed")}}async function gt(t,e,n,r,i={}){const s=await pt(t,e,n,r,i);return"mfaPendingCredential"in s&&J(t,"multi-factor-auth-required",{serverResponse:s}),s}function yt(t,e,n,r){const i=`${e}${n}?${r}`;return t.config.emulator?ut(t.config,i):`${t.config.apiScheme}://${i}`}class vt{constructor(t){this.auth=t,this.timer=null,this.promise=new Promise(((t,e)=>{this.timer=setTimeout((()=>e(Z(this.auth,"timeout"))),dt.get())}))}clearNetworkTimeout(){clearTimeout(this.timer)}}function wt(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=Z(t,e,r);return i.customData._tokenResponse=n,i}function It(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch(t){}}function bt(t){return 1e3*Number(t)}function Tt(t){const[e,n,r]=t.split(".");if(void 0===e||void 0===n||void 0===r)return X("JWT malformed, contained fewer than 3 sections"),null;try{const t=function(t){try{return s.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null}(n);return t?JSON.parse(t):(X("Failed to decode base64 JWT payload"),null)}catch(t){return X("Caught error parsing JWT payload as JSON",t),null}}async function Et(t,e,n=!1){if(n)return e;try{return await e}catch(e){throw e instanceof d&&function({code:t}){return"auth/user-disabled"===t||"auth/user-token-expired"===t}(e)&&t.auth.currentUser===t&&await t.auth.signOut(),e}}class St{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(t){var e;if(t){const t=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),t}{this.errorBackoff=3e4;const t=(null!==(e=this.user.stsTokenManager.expirationTime)&&void 0!==e?e:0)-Date.now()-3e5;return Math.max(0,t)}}schedule(t=!1){if(!this.isRunning)return;const e=this.getInterval(t);this.timerId=setTimeout((async()=>{await this.iteration()}),e)}async iteration(){try{await this.user.getIdToken(!0)}catch(t){return void("auth/network-request-failed"===t.code&&this.schedule(!0))}this.schedule()}}class _t{constructor(t,e){this.createdAt=t,this.lastLoginAt=e,this._initializeTime()}_initializeTime(){this.lastSignInTime=It(this.lastLoginAt),this.creationTime=It(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function kt(e){var n;const r=e.auth,i=await e.getIdToken(),s=await Et(e,async function(t,e){return pt(t,"POST","/v1/accounts:lookup",e)}(r,{idToken:i}));et(null==s?void 0:s.users.length,r,"internal-error");const o=s.users[0];e._notifyReloadListener(o);const a=(null===(n=o.providerUserInfo)||void 0===n?void 0:n.length)?o.providerUserInfo.map((e=>{var{providerId:n}=e,r=t(e,["providerId"]);return{providerId:n,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})):[],c=(u=e.providerData,h=a,[...u.filter((t=>!h.some((e=>e.providerId===t.providerId)))),...h]);var u,h;const l=e.isAnonymous,d=!(e.email&&o.passwordHash||(null==c?void 0:c.length)),f=!!l&&d,p={uid:o.localId,displayName:o.displayName||null,photoURL:o.photoUrl||null,email:o.email||null,emailVerified:o.emailVerified||!1,phoneNumber:o.phoneNumber||null,tenantId:o.tenantId||null,providerData:c,metadata:new _t(o.createdAt,o.lastLoginAt),isAnonymous:f};Object.assign(e,p)}class Nt{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){et(t.idToken,"internal-error"),et(void 0!==t.idToken,"internal-error"),et(void 0!==t.refreshToken,"internal-error");const e="expiresIn"in t&&void 0!==t.expiresIn?Number(t.expiresIn):function(t){const e=Tt(t);return et(e,"internal-error"),et(void 0!==e.exp,"internal-error"),et(void 0!==e.iat,"internal-error"),Number(e.exp)-Number(e.iat)}(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,e)}async getToken(t,e=!1){return et(!this.accessToken||this.refreshToken,t,"user-token-expired"),e||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(t,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(t,e){const{accessToken:n,refreshToken:r,expiresIn:i}=await async function(t,e){const n=await mt(t,{},(()=>{const n=y({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:r,apiKey:i}=t.config,s=yt(t,r,"/v1/token",`key=${i}`);return ht.fetch()(s,{method:"POST",headers:{"X-Client-Version":t._getSdkClientVersion(),"Content-Type":"application/x-www-form-urlencoded"},body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(t,e);this.updateTokensAndExpiration(n,r,Number(i))}updateTokensAndExpiration(t,e,n){this.refreshToken=e||null,this.accessToken=t||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(t,e){const{refreshToken:n,accessToken:r,expirationTime:i}=e,s=new Nt;return n&&(et("string"==typeof n,"internal-error",{appName:t}),s.refreshToken=n),r&&(et("string"==typeof r,"internal-error",{appName:t}),s.accessToken=r),i&&(et("number"==typeof i,"internal-error",{appName:t}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new Nt,this.toJSON())}_performRefresh(){return nt("not implemented")}}function At(t,e){et("string"==typeof t||void 0===t,"internal-error",{appName:e})}class Dt{constructor(e){var{uid:n,auth:r,stsTokenManager:i}=e,s=t(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.emailVerified=!1,this.isAnonymous=!1,this.tenantId=null,this.providerData=[],this.proactiveRefresh=new St(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=n,this.auth=r,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.metadata=new _t(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(t){const e=await Et(this,this.stsTokenManager.getToken(this.auth,t));return et(e,this.auth,"internal-error"),this.accessToken!==e&&(this.accessToken=e,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),e}getIdTokenResult(t){return async function(t,e=!1){const n=T(t),r=await n.getIdToken(e),i=Tt(r);et(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const s="object"==typeof i.firebase?i.firebase:void 0,o=null==s?void 0:s.sign_in_provider;return{claims:i,token:r,authTime:It(bt(i.auth_time)),issuedAtTime:It(bt(i.iat)),expirationTime:It(bt(i.exp)),signInProvider:o||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}}(this,t)}reload(){return async function(t){const e=T(t);await kt(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}(this)}_assign(t){this!==t&&(et(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map((t=>Object.assign({},t))),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){return new Dt(Object.assign(Object.assign({},this),{auth:t,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(t){et(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(t,e=!1){let n=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),n=!0),e&&await kt(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){const t=await this.getIdToken();return await Et(this,async function(t,e){return pt(t,"POST","/v1/accounts:delete",e)}(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((t=>Object.assign({},t))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,e){var n,r,i,s,o,a,c,u;const h=null!==(n=e.displayName)&&void 0!==n?n:void 0,l=null!==(r=e.email)&&void 0!==r?r:void 0,d=null!==(i=e.phoneNumber)&&void 0!==i?i:void 0,f=null!==(s=e.photoURL)&&void 0!==s?s:void 0,p=null!==(o=e.tenantId)&&void 0!==o?o:void 0,m=null!==(a=e._redirectEventId)&&void 0!==a?a:void 0,g=null!==(c=e.createdAt)&&void 0!==c?c:void 0,y=null!==(u=e.lastLoginAt)&&void 0!==u?u:void 0,{uid:v,emailVerified:w,isAnonymous:I,providerData:b,stsTokenManager:T}=e;et(v&&T,t,"internal-error");const E=Nt.fromJSON(this.name,T);et("string"==typeof v,t,"internal-error"),At(h,t.name),At(l,t.name),et("boolean"==typeof w,t,"internal-error"),et("boolean"==typeof I,t,"internal-error"),At(d,t.name),At(f,t.name),At(p,t.name),At(m,t.name),At(g,t.name),At(y,t.name);const S=new Dt({uid:v,auth:t,email:l,emailVerified:w,displayName:h,isAnonymous:I,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:E,createdAt:g,lastLoginAt:y});return b&&Array.isArray(b)&&(S.providerData=b.map((t=>Object.assign({},t)))),m&&(S._redirectEventId=m),S}static async _fromIdTokenResponse(t,e,n=!1){const r=new Nt;r.updateFromServerResponse(e);const i=new Dt({uid:e.localId,auth:t,stsTokenManager:r,isAnonymous:n});return await kt(i),i}}class Ct{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,e){this.storage[t]=e}async _get(t){const e=this.storage[t];return void 0===e?null:e}async _remove(t){delete this.storage[t]}_addListener(t,e){}_removeListener(t,e){}}Ct.type="NONE";const Rt=Ct;function xt(t,e,n){return`firebase:${t}:${e}:${n}`}class Ot{constructor(t,e,n){this.persistence=t,this.auth=e,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=xt(this.userKey,r.apiKey,i),this.fullPersistenceKey=xt("persistence",r.apiKey,i),this.boundEventHandler=e._onStorageEvent.bind(e),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence._get(this.fullUserKey);return t?Dt._fromJSON(this.auth,t):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t)return;const e=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=t,e?this.setCurrentUser(e):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,e,n="authUser"){if(!e.length)return new Ot(st(Rt),t,n);const r=(await Promise.all(e.map((async t=>{if(await t._isAvailable())return t})))).filter((t=>t));let i=r[0]||st(Rt);const s=xt(n,t.config.apiKey,t.name);let o=null;for(const n of e)try{const e=await n._get(s);if(e){const r=Dt._fromJSON(t,e);n!==i&&(o=r),i=n;break}}catch(t){}const a=r.filter((t=>t._shouldAllowMigration));return i._shouldAllowMigration&&a.length?(i=a[0],o&&await i._set(s,o.toJSON()),await Promise.all(e.map((async t=>{if(t!==i)try{await t._remove(s)}catch(t){}}))),new Ot(i,t,n)):new Ot(i,t,n)}}function Lt(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Ut(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Pt(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(jt(e))return"Blackberry";if(qt(e))return"Webos";if(Mt(e))return"Safari";if((e.includes("chrome/")||Ft(e))&&!e.includes("edge/"))return"Chrome";if(Vt(e))return"Android";{const e=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=t.match(e);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function Pt(t=a()){return/firefox\//i.test(t)}function Mt(t=a()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Ft(t=a()){return/crios\//i.test(t)}function Ut(t=a()){return/iemobile/i.test(t)}function Vt(t=a()){return/android/i.test(t)}function jt(t=a()){return/blackberry/i.test(t)}function qt(t=a()){return/webos/i.test(t)}function Bt(t=a()){return/iphone|ipad|ipod/i.test(t)}function Kt(t=a()){return Bt(t)||Vt(t)||qt(t)||jt(t)||/windows phone/i.test(t)||Ut(t)}function zt(t,e=[]){let n;switch(t){case"Browser":n=Lt(a());break;case"Worker":n=`${Lt(a())}-${t}`;break;default:n=t}return`${n}/JsCore/9.1.0/${e.length?e.join(","):"FirebaseCore-web"}`}class Ht{constructor(t,e){this.app=t,this.config=e,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new $t(this),this.idTokenSubscription=new $t(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Q,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=e.sdkClientVersion}_initializeWithPersistence(t,e){return e&&(this._popupRedirectResolver=st(e)),this._initializationPromise=this.queue((async()=>{var n;this._deleted||(this.persistenceManager=await Ot.create(this,t),this._deleted||((null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)&&await this._popupRedirectResolver._initialize(this),await this.initializeCurrentUser(e),this._deleted||(this._isInitialized=!0)))})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const t=await this.assertedPersistence.getCurrentUser();return this.currentUser||t?this.currentUser&&t&&this.currentUser.uid===t.uid?(this._currentUser._assign(t),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(t):void 0}async initializeCurrentUser(t){var e;let n=await this.assertedPersistence.getCurrentUser();if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const r=null===(e=this.redirectUser)||void 0===e?void 0:e._redirectEventId,i=null==n?void 0:n._redirectEventId,s=await this.tryRedirectSignIn(t);r&&r!==i||!(null==s?void 0:s.user)||(n=s.user)}return n?n._redirectEventId?(et(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)):this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}async tryRedirectSignIn(t){let e=null;try{e=await this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch(t){await this._setRedirectUser(null)}return e}async reloadAndSetCurrentUserOrClear(t){try{await kt(t)}catch(t){if("auth/network-request-failed"!==t.code)return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(t){const e=t?T(t):null;return e&&et(e.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(e&&e._clone(this))}async _updateCurrentUser(t){if(!this._deleted)return t&&et(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),this.queue((async()=>{await this.directlySetCurrentUser(t),this.notifyAuthListeners()}))}async signOut(){return(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null)}setPersistence(t){return this.queue((async()=>{await this.assertedPersistence.setPersistence(st(t))}))}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(t){this._errorFactory=new f("auth","Firebase",t())}onAuthStateChanged(t,e,n){return this.registerStateListener(this.authStateSubscription,t,e,n)}onIdTokenChanged(t,e,n){return this.registerStateListener(this.idTokenSubscription,t,e,n)}toJSON(){var t;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(t=this._currentUser)||void 0===t?void 0:t.toJSON()}}async _setRedirectUser(t,e){const n=await this.getOrInitRedirectPersistenceManager(e);return null===t?n.removeCurrentUser():n.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const e=t&&st(t)||this._popupRedirectResolver;et(e,this,"argument-error"),this.redirectPersistenceManager=await Ot.create(this,[st(e._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(t){var e,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(e=this._currentUser)||void 0===e?void 0:e._redirectEventId)===t?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===t?this.redirectUser:null}async _persistUserIfCurrent(t){if(t===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(t)))}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t,e;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(e=null===(t=this.currentUser)||void 0===t?void 0:t.uid)&&void 0!==e?e:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,e,n,r){if(this._deleted)return()=>{};const i="function"==typeof e?e:e.next.bind(e),s=this._isInitialized?Promise.resolve():this._initializationPromise;return et(s,this,"internal-error"),s.then((()=>i(this.currentUser))),"function"==typeof e?t.addObserver(e,n,r):t.addObserver(e)}async directlySetCurrentUser(t){this.currentUser&&this.currentUser!==t&&(this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh()),this.currentUser=t,t?await this.assertedPersistence.setCurrentUser(t):await this.assertedPersistence.removeCurrentUser()}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return et(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){t&&!this.frameworks.includes(t)&&(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=zt(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getSdkClientVersion(){return this.clientVersion}}function Gt(t){return T(t)}class $t{constructor(t){this.auth=t,this.observer=null,this.addObserver=function(t,e){const n=new I(t,void 0);return n.subscribe.bind(n)}((t=>this.observer=t))}get next(){return et(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}class Wt{constructor(t,e){this.providerId=t,this.signInMethod=e}toJSON(){return nt("not implemented")}_getIdTokenResponse(t){return nt("not implemented")}_linkToIdToken(t,e){return nt("not implemented")}_getReauthenticationResolver(t){return nt("not implemented")}}class Qt extends Wt{constructor(t,e,n,r=null){super("password",n),this._email=t,this._password=e,this._tenantId=r}static _fromEmailAndPassword(t,e){return new Qt(t,e,"password")}static _fromEmailAndCode(t,e,n=null){return new Qt(t,e,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(t){const e="string"==typeof t?JSON.parse(t):t;if((null==e?void 0:e.email)&&(null==e?void 0:e.password)){if("password"===e.signInMethod)return this._fromEmailAndPassword(e.email,e.password);if("emailLink"===e.signInMethod)return this._fromEmailAndCode(e.email,e.password,e.tenantId)}return null}async _getIdTokenResponse(t){switch(this.signInMethod){case"password":return async function(t,e){return gt(t,"POST","/v1/accounts:signInWithPassword",ft(t,e))}(t,{returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(t,e){return gt(t,"POST","/v1/accounts:signInWithEmailLink",ft(t,e))}(t,{email:this._email,oobCode:this._password});default:J(t,"internal-error")}}async _linkToIdToken(t,e){switch(this.signInMethod){case"password":return async function(t,e){return pt(t,"POST","/v1/accounts:update",e)}(t,{idToken:e,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(t,e){return gt(t,"POST","/v1/accounts:signInWithEmailLink",ft(t,e))}(t,{idToken:e,email:this._email,oobCode:this._password});default:J(t,"internal-error")}}_getReauthenticationResolver(t){return this._getIdTokenResponse(t)}}async function Yt(t,e){return gt(t,"POST","/v1/accounts:signInWithIdp",ft(t,e))}class Xt extends Wt{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(t){const e=new Xt(t.providerId,t.signInMethod);return t.idToken||t.accessToken?(t.idToken&&(e.idToken=t.idToken),t.accessToken&&(e.accessToken=t.accessToken),t.nonce&&!t.pendingToken&&(e.nonce=t.nonce),t.pendingToken&&(e.pendingToken=t.pendingToken)):t.oauthToken&&t.oauthTokenSecret?(e.accessToken=t.oauthToken,e.secret=t.oauthTokenSecret):J("argument-error"),e}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n="string"==typeof e?JSON.parse(e):e,{providerId:r,signInMethod:i}=n,s=t(n,["providerId","signInMethod"]);if(!r||!i)return null;const o=new Xt(r,i);return Object.assign(o,s),o}_getIdTokenResponse(t){return Yt(t,this.buildRequest())}_linkToIdToken(t,e){const n=this.buildRequest();return n.idToken=e,Yt(t,n)}_getReauthenticationResolver(t){const e=this.buildRequest();return e.autoCreate=!1,Yt(t,e)}buildRequest(){const t={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)t.pendingToken=this.pendingToken;else{const e={};this.idToken&&(e.id_token=this.idToken),this.accessToken&&(e.access_token=this.accessToken),this.secret&&(e.oauth_token_secret=this.secret),e.providerId=this.providerId,this.nonce&&!this.pendingToken&&(e.nonce=this.nonce),t.postBody=y(e)}return t}}const Jt={USER_NOT_FOUND:"user-not-found"};class Zt extends Wt{constructor(t){super("phone","phone"),this.params=t}static _fromVerification(t,e){return new Zt({verificationId:t,verificationCode:e})}static _fromTokenResponse(t,e){return new Zt({phoneNumber:t,temporaryProof:e})}_getIdTokenResponse(t){return async function(t,e){return gt(t,"POST","/v1/accounts:signInWithPhoneNumber",ft(t,e))}(t,this._makeVerificationRequest())}_linkToIdToken(t,e){return async function(t,e){const n=await gt(t,"POST","/v1/accounts:signInWithPhoneNumber",ft(t,e));if(n.temporaryProof)throw wt(t,"account-exists-with-different-credential",n);return n}(t,Object.assign({idToken:e},this._makeVerificationRequest()))}_getReauthenticationResolver(t){return async function(t,e){return gt(t,"POST","/v1/accounts:signInWithPhoneNumber",ft(t,Object.assign(Object.assign({},e),{operation:"REAUTH"})),Jt)}(t,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:t,phoneNumber:e,verificationId:n,verificationCode:r}=this.params;return t&&e?{temporaryProof:t,phoneNumber:e}:{sessionInfo:n,code:r}}toJSON(){const t={providerId:this.providerId};return this.params.phoneNumber&&(t.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(t.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(t.verificationCode=this.params.verificationCode),this.params.verificationId&&(t.verificationId=this.params.verificationId),t}static fromJSON(t){"string"==typeof t&&(t=JSON.parse(t));const{verificationId:e,verificationCode:n,phoneNumber:r,temporaryProof:i}=t;return n||e||r||i?new Zt({verificationId:e,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}class te{constructor(t){var e,n,r,i,s,o;const a=v(w(t)),c=null!==(e=a.apiKey)&&void 0!==e?e:null,u=null!==(n=a.oobCode)&&void 0!==n?n:null,h=function(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=a.mode)&&void 0!==r?r:null);et(c&&u&&h,"argument-error"),this.apiKey=c,this.operation=h,this.code=u,this.continueUrl=null!==(i=a.continueUrl)&&void 0!==i?i:null,this.languageCode=null!==(s=a.languageCode)&&void 0!==s?s:null,this.tenantId=null!==(o=a.tenantId)&&void 0!==o?o:null}static parseLink(t){const e=function(t){const e=v(w(t)).link,n=e?v(w(e)).deep_link_id:null,r=v(w(t)).deep_link_id;return(r?v(w(r)).link:null)||r||n||e||t}(t);try{return new te(e)}catch(t){return null}}}class ee{constructor(){this.providerId=ee.PROVIDER_ID}static credential(t,e){return Qt._fromEmailAndPassword(t,e)}static credentialWithLink(t,e){const n=te.parseLink(e);return et(n,"argument-error"),Qt._fromEmailAndCode(t,n.code,n.tenantId)}}ee.PROVIDER_ID="password",ee.EMAIL_PASSWORD_SIGN_IN_METHOD="password",ee.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class ne{constructor(t){this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){return this.customParameters=t,this}getCustomParameters(){return this.customParameters}}class re extends ne{constructor(){super(...arguments),this.scopes=[]}addScope(t){return this.scopes.includes(t)||this.scopes.push(t),this}getScopes(){return[...this.scopes]}}class ie extends re{constructor(){super("facebook.com")}static credential(t){return Xt._fromParams({providerId:ie.PROVIDER_ID,signInMethod:ie.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return ie.credentialFromTaggedObject(t)}static credentialFromError(t){return ie.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return ie.credential(t.oauthAccessToken)}catch(t){return null}}}ie.FACEBOOK_SIGN_IN_METHOD="facebook.com",ie.PROVIDER_ID="facebook.com";class se extends re{constructor(){super("google.com"),this.addScope("profile")}static credential(t,e){return Xt._fromParams({providerId:se.PROVIDER_ID,signInMethod:se.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:e})}static credentialFromResult(t){return se.credentialFromTaggedObject(t)}static credentialFromError(t){return se.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:e,oauthAccessToken:n}=t;if(!e&&!n)return null;try{return se.credential(e,n)}catch(t){return null}}}se.GOOGLE_SIGN_IN_METHOD="google.com",se.PROVIDER_ID="google.com";class oe extends re{constructor(){super("github.com")}static credential(t){return Xt._fromParams({providerId:oe.PROVIDER_ID,signInMethod:oe.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return oe.credentialFromTaggedObject(t)}static credentialFromError(t){return oe.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return oe.credential(t.oauthAccessToken)}catch(t){return null}}}oe.GITHUB_SIGN_IN_METHOD="github.com",oe.PROVIDER_ID="github.com";class ae extends re{constructor(){super("twitter.com")}static credential(t,e){return Xt._fromParams({providerId:ae.PROVIDER_ID,signInMethod:ae.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:e})}static credentialFromResult(t){return ae.credentialFromTaggedObject(t)}static credentialFromError(t){return ae.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthAccessToken:e,oauthTokenSecret:n}=t;if(!e||!n)return null;try{return ae.credential(e,n)}catch(t){return null}}}ae.TWITTER_SIGN_IN_METHOD="twitter.com",ae.PROVIDER_ID="twitter.com";class ce{constructor(t){this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}static async _fromIdTokenResponse(t,e,n,r=!1){const i=await Dt._fromIdTokenResponse(t,n,r),s=ue(n);return new ce({user:i,providerId:s,_tokenResponse:n,operationType:e})}static async _forOperation(t,e,n){await t._updateTokensIfNecessary(n,!0);const r=ue(n);return new ce({user:t,providerId:r,_tokenResponse:n,operationType:e})}}function ue(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}class he extends d{constructor(t,e,n,r){var i;super(e.code,e.message),this.operationType=n,this.user=r,this.name="FirebaseError",Object.setPrototypeOf(this,he.prototype),this.appName=t.name,this.code=e.code,this.tenantId=null!==(i=t.tenantId)&&void 0!==i?i:void 0,this.serverResponse=e.customData.serverResponse}static _fromErrorAndOperation(t,e,n,r){return new he(t,e,n,r)}}function le(t,e,n,r){return("reauthenticate"===e?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw he._fromErrorAndOperation(t,n,e,r);throw n}))}async function de(t,e,n=!1){const r="signIn",i=await le(t,r,e),s=await ce._fromIdTokenResponse(t,r,i);return n||await t._updateCurrentUser(s.user),s}async function fe(t,e,n){const r=Gt(t),i=await async function(t,e){return gt(t,"POST","/v1/accounts:signUp",ft(t,e))}(r,{returnSecureToken:!0,email:e,password:n}),s=await ce._fromIdTokenResponse(r,"signIn",i);return await r._updateCurrentUser(s.user),s}function pe(t,e,n){return async function(t,e){return de(Gt(t),e)}(T(t),ee.credential(e,n))}function me(t,e,n,r){return T(t).onAuthStateChanged(e,n,r)}function ge(t){return T(t).signOut()}new WeakMap;const ye="__sak";class ve{constructor(t,e){this.storage=t,this.type=e}_isAvailable(){try{return this.storage?(this.storage.setItem(ye,"1"),this.storage.removeItem(ye),Promise.resolve(!0)):Promise.resolve(!1)}catch(t){return Promise.resolve(!1)}}_set(t,e){return this.storage.setItem(t,JSON.stringify(e)),Promise.resolve()}_get(t){const e=this.storage.getItem(t);return Promise.resolve(e?JSON.parse(e):null)}_remove(t){return this.storage.removeItem(t),Promise.resolve()}}class we extends ve{constructor(){super(window.localStorage,"LOCAL"),this.boundEventHandler=(t,e)=>this.onStorageEvent(t,e),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const t=a();return Mt(t)||Bt(t)}()&&function(){try{return!(!window||window===window.top)}catch(t){return!1}}(),this.fallbackToPolling=Kt(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(const e of Object.keys(this.listeners)){const n=this.storage.getItem(e),r=this.localCache[e];n!==r&&t(e,r,n)}}onStorageEvent(t,e=!1){if(!t.key)return void this.forAllChangedKeys(((t,e,n)=>{this.notifyListeners(t,n)}));const n=t.key;if(e?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const r=this.storage.getItem(n);if(t.newValue!==r)null!==t.newValue?this.storage.setItem(n,t.newValue):this.storage.removeItem(n);else if(this.localCache[n]===t.newValue&&!e)return}const r=()=>{const t=this.storage.getItem(n);(e||this.localCache[n]!==t)&&this.notifyListeners(n,t)},i=this.storage.getItem(n);l()&&10===document.documentMode&&i!==t.newValue&&t.newValue!==t.oldValue?setTimeout(r,10):r()}notifyListeners(t,e){this.localCache[t]=e;const n=this.listeners[t];if(n)for(const t of Array.from(n))t(e?JSON.parse(e):e)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((t,e,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:e,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,e){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(e)}_removeListener(t,e){this.listeners[t]&&(this.listeners[t].delete(e),0===this.listeners[t].size&&delete this.listeners[t]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(t,e){await super._set(t,e),this.localCache[t]=JSON.stringify(e)}async _get(t){const e=await super._get(t);return this.localCache[t]=JSON.stringify(e),e}async _remove(t){await super._remove(t),delete this.localCache[t]}}we.type="LOCAL";const Ie=we;class be extends ve{constructor(){super(window.sessionStorage,"SESSION")}_addListener(t,e){}_removeListener(t,e){}}be.type="SESSION";const Te=be;class Ee{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const e=this.receivers.find((e=>e.isListeningto(t)));if(e)return e;const n=new Ee(t);return this.receivers.push(n),n}isListeningto(t){return this.eventTarget===t}async handleEvent(t){const e=t,{eventId:n,eventType:r,data:i}=e.data,s=this.handlersMap[r];if(!(null==s?void 0:s.size))return;e.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const o=Array.from(s).map((async t=>t(e.origin,i))),a=await function(t){return Promise.all(t.map((async t=>{try{return{fulfilled:!0,value:await t}}catch(t){return{fulfilled:!1,reason:t}}})))}(o);e.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:a})}_subscribe(t,e){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(e)}_unsubscribe(t,e){this.handlersMap[t]&&e&&this.handlersMap[t].delete(e),e&&0!==this.handlersMap[t].size||delete this.handlersMap[t],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Se(t="",e=10){let n="";for(let t=0;t<e;t++)n+=Math.floor(10*Math.random());return t+n}Ee.receivers=[];class _e{constructor(t){this.target=t,this.handlers=new Set}removeMessageHandler(t){t.messageChannel&&(t.messageChannel.port1.removeEventListener("message",t.onMessage),t.messageChannel.port1.close()),this.handlers.delete(t)}async _send(t,e,n=50){const r="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,s;return new Promise(((o,a)=>{const c=Se("",20);r.port1.start();const u=setTimeout((()=>{a(new Error("unsupported_event"))}),n);s={messageChannel:r,onMessage(t){const e=t;if(e.data.eventId===c)switch(e.data.status){case"ack":clearTimeout(u),i=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(i),o(e.data.response);break;default:clearTimeout(u),clearTimeout(i),a(new Error("invalid_response"))}}},this.handlers.add(s),r.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:t,eventId:c,data:e},[r.port2])})).finally((()=>{s&&this.removeMessageHandler(s)}))}}function ke(){return window}function Ne(){return void 0!==ke().WorkerGlobalScope&&"function"==typeof ke().importScripts}const Ae="firebaseLocalStorageDb",De="firebaseLocalStorage",Ce="fbase_key";class Re{constructor(t){this.request=t}toPromise(){return new Promise(((t,e)=>{this.request.addEventListener("success",(()=>{t(this.request.result)})),this.request.addEventListener("error",(()=>{e(this.request.error)}))}))}}function xe(t,e){return t.transaction([De],e?"readwrite":"readonly").objectStore(De)}function Oe(){const t=indexedDB.open(Ae,1);return new Promise(((e,n)=>{t.addEventListener("error",(()=>{n(t.error)})),t.addEventListener("upgradeneeded",(()=>{const e=t.result;try{e.createObjectStore(De,{keyPath:Ce})}catch(t){n(t)}})),t.addEventListener("success",(async()=>{const n=t.result;n.objectStoreNames.contains(De)?e(n):(n.close(),await function(){const t=indexedDB.deleteDatabase(Ae);return new Re(t).toPromise()}(),e(await Oe()))}))}))}async function Le(t,e,n){const r=xe(t,!0).put({[Ce]:e,value:n});return new Re(r).toPromise()}function Pe(t,e){const n=xe(t,!0).delete(e);return new Re(n).toPromise()}class Me{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await Oe()),this.db}async _withRetries(t){let e=0;for(;;)try{const e=await this._openDb();return await t(e)}catch(t){if(e++>3)throw t;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Ne()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Ee._getInstance(Ne()?self:null),this.receiver._subscribe("keyChanged",(async(t,e)=>({keyProcessed:(await this._poll()).includes(e.key)}))),this.receiver._subscribe("ping",(async(t,e)=>["keyChanged"]))}async initializeSender(){var t,e;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(t){return null}}(),!this.activeServiceWorker)return;this.sender=new _e(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(t=n[0])||void 0===t?void 0:t.fulfilled)&&(null===(e=n[0])||void 0===e?void 0:e.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(t){if(this.sender&&this.activeServiceWorker&&function(){var t;return(null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null}()===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const t=await Oe();return await Le(t,ye,"1"),await Pe(t,ye),!0}catch(t){}return!1}async _withPendingWrite(t){this.pendingWrites++;try{await t()}finally{this.pendingWrites--}}async _set(t,e){return this._withPendingWrite((async()=>(await this._withRetries((n=>Le(n,t,e))),this.localCache[t]=e,this.notifyServiceWorker(t))))}async _get(t){const e=await this._withRetries((e=>async function(t,e){const n=xe(t,!1).get(e),r=await new Re(n).toPromise();return void 0===r?null:r.value}(e,t)));return this.localCache[t]=e,e}async _remove(t){return this._withPendingWrite((async()=>(await this._withRetries((e=>Pe(e,t))),delete this.localCache[t],this.notifyServiceWorker(t))))}async _poll(){const t=await this._withRetries((t=>{const e=xe(t,!1).getAll();return new Re(e).toPromise()}));if(!t)return[];if(0!==this.pendingWrites)return[];const e=[],n=new Set;for(const{fbase_key:r,value:i}of t)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),e.push(r));for(const t of Object.keys(this.localCache))this.localCache[t]&&!n.has(t)&&(this.notifyListeners(t,null),e.push(t));return e}notifyListeners(t,e){this.localCache[t]=e;const n=this.listeners[t];if(n)for(const t of Array.from(n))t(e)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,e){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(e)}_removeListener(t,e){this.listeners[t]&&(this.listeners[t].delete(e),0===this.listeners[t].size&&delete this.listeners[t]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Me.type="LOCAL";const Fe=Me;function Ue(t){return`__${t}${Math.floor(1e6*Math.random())}`}Ue("rcb"),new ct(3e4,6e4);class Ve{constructor(t){this.providerId=Ve.PROVIDER_ID,this.auth=Gt(t)}verifyPhoneNumber(t,e){return async function(t,e,n){var r;const i=await n.verify();try{let s;if(et("string"==typeof i,t,"argument-error"),et("recaptcha"===n.type,t,"argument-error"),s="string"==typeof e?{phoneNumber:e}:e,"session"in s){const e=s.session;if("phoneNumber"in s){et("enroll"===e.type,t,"internal-error");const n=await function(t,e){return pt(t,"POST","/v2/accounts/mfaEnrollment:start",ft(t,e))}(t,{idToken:e.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,recaptchaToken:i}});return n.phoneSessionInfo.sessionInfo}{et("signin"===e.type,t,"internal-error");const n=(null===(r=s.multiFactorHint)||void 0===r?void 0:r.uid)||s.multiFactorUid;et(n,t,"missing-multi-factor-info");const o=await function(t,e){return pt(t,"POST","/v2/accounts/mfaSignIn:start",ft(t,e))}(t,{mfaPendingCredential:e.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:i}});return o.phoneResponseInfo.sessionInfo}}{const{sessionInfo:e}=await async function(t,e){return pt(t,"POST","/v1/accounts:sendVerificationCode",ft(t,e))}(t,{phoneNumber:s.phoneNumber,recaptchaToken:i});return e}}finally{n._reset()}}(this.auth,t,T(e))}static credential(t,e){return Zt._fromVerification(t,e)}static credentialFromResult(t){const e=t;return Ve.credentialFromTaggedObject(e)}static credentialFromError(t){return Ve.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{phoneNumber:e,temporaryProof:n}=t;return e&&n?Zt._fromTokenResponse(e,n):null}}Ve.PROVIDER_ID="phone",Ve.PHONE_SIGN_IN_METHOD="phone";class je extends Wt{constructor(t){super("custom","custom"),this.params=t}_getIdTokenResponse(t){return Yt(t,this._buildIdpRequest())}_linkToIdToken(t,e){return Yt(t,this._buildIdpRequest(e))}_getReauthenticationResolver(t){return Yt(t,this._buildIdpRequest())}_buildIdpRequest(t){const e={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return t&&(e.idToken=t),e}}function qe(t){return de(t.auth,new je(t),t.bypassAuthState)}function Be(t){const{auth:e,user:n}=t;return et(n,e,"internal-error"),async function(t,e,n=!1){const{auth:r}=t,i="reauthenticate";try{const s=await Et(t,le(r,i,e,t),n);et(s.idToken,r,"internal-error");const o=Tt(s.idToken);et(o,r,"internal-error");const{sub:a}=o;return et(t.uid===a,r,"user-mismatch"),ce._forOperation(t,i,s)}catch(t){throw"auth/user-not-found"===(null==t?void 0:t.code)&&J(r,"user-mismatch"),t}}(n,new je(t),t.bypassAuthState)}async function Ke(t){const{auth:e,user:n}=t;return et(n,e,"internal-error"),async function(t,e,n=!1){const r=await Et(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return ce._forOperation(t,"link",r)}(n,new je(t),t.bypassAuthState)}class ze{constructor(t,e,n,r,i=!1){this.auth=t,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(e)?e:[e]}execute(){return new Promise((async(t,e)=>{this.pendingPromise={resolve:t,reject:e};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(t){this.reject(t)}}))}async onAuthEvent(t){const{urlResponse:e,sessionId:n,postBody:r,tenantId:i,error:s,type:o}=t;if(s)return void this.reject(s);const a={auth:this.auth,requestUri:e,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(t){this.reject(t)}}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return qe;case"linkViaPopup":case"linkViaRedirect":return Ke;case"reauthViaPopup":case"reauthViaRedirect":return Be;default:J(this.auth,"internal-error")}}resolve(t){rt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(t),this.unregisterAndCleanUp()}reject(t){rt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(t),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const He=new ct(2e3,1e4);class Ge extends ze{constructor(t,e,n,r,i){super(t,e,r,i),this.provider=n,this.authWindow=null,this.pollId=null,Ge.currentPopupAction&&Ge.currentPopupAction.cancel(),Ge.currentPopupAction=this}async executeNotNull(){const t=await this.execute();return et(t,this.auth,"internal-error"),t}async onExecution(){rt(1===this.filter.length,"Popup operations only handle one event");const t=Se();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch((t=>{this.reject(t)})),this.resolver._isIframeWebStorageSupported(this.auth,(t=>{t||this.reject(Z(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var t;return(null===(t=this.authWindow)||void 0===t?void 0:t.associatedEvent)||null}cancel(){this.reject(Z(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Ge.currentPopupAction=null}pollUserCancellation(){const t=()=>{var e,n;(null===(n=null===(e=this.authWindow)||void 0===e?void 0:e.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(Z(this.auth,"popup-closed-by-user"))}),2e3):this.pollId=window.setTimeout(t,He.get())};t()}}Ge.currentPopupAction=null;const $e=new Map;class We extends ze{constructor(t,e,n=!1){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],e,void 0,n),this.eventId=null}async execute(){let t=$e.get(this.auth._key());if(!t){try{const e=await async function(t,e){const n=function(t){return xt("pendingRedirect",t.config.apiKey,t.name)}(e),r="true"===await Qe(t)._get(n);return await Qe(t)._remove(n),r}(this.resolver,this.auth),n=e?await super.execute():null;t=()=>Promise.resolve(n)}catch(e){t=()=>Promise.reject(e)}$e.set(this.auth._key(),t)}return t()}async onAuthEvent(t){if("signInViaRedirect"===t.type)return super.onAuthEvent(t);if("unknown"!==t.type){if(t.eventId){const e=await this.auth._redirectUserForId(t.eventId);if(e)return this.user=e,super.onAuthEvent(t);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function Qe(t){return st(t._redirectPersistence)}async function Ye(t,e,n=!1){const r=Gt(t),i=function(t,e){return e?st(e):(et(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}(r,e),s=new We(r,i,n),o=await s.execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}class Xe{constructor(t){this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let e=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(t,n)&&(e=!0,this.sendToConsumer(t,n),this.saveEventToCache(t))})),this.hasHandledPotentialRedirect||!function(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Ze(t);default:return!1}}(t)||(this.hasHandledPotentialRedirect=!0,e||(this.queuedRedirectEvent=t,e=!0)),e}sendToConsumer(t,e){var n;if(t.error&&!Ze(t)){const r=(null===(n=t.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";e.onError(Z(this.auth,r))}else e.onAuthEvent(t)}isEventForConsumer(t,e){const n=null===e.eventId||!!t.eventId&&t.eventId===e.eventId;return e.filter.includes(t.type)&&n}hasEventBeenHandled(t){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Je(t))}saveEventToCache(t){this.cachedEventUids.add(Je(t)),this.lastProcessedEventTime=Date.now()}}function Je(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter((t=>t)).join("-")}function Ze({type:t,error:e}){return"unknown"===t&&"auth/no-auth-event"===(null==e?void 0:e.code)}const tn=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,en=/^https?/;function nn(t){const e=ot(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const i=new URL(t);return""===i.hostname&&""===r?"chrome-extension:"===n&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!en.test(n))return!1;if(tn.test(t))return r===t;const i=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const rn=new ct(3e4,6e4);function sn(){const t=ke().___jsl;if(null==t?void 0:t.H)for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let e=0;e<t.CP.length;e++)t.CP[e]=null}let on=null;function an(t){return on=on||function(t){return new Promise(((e,n)=>{var r,i,s,o;function a(){sn(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{sn(),n(Z(t,"network-request-failed"))},timeout:rn.get()})}if(null===(i=null===(r=ke().gapi)||void 0===r?void 0:r.iframes)||void 0===i?void 0:i.Iframe)e(gapi.iframes.getContext());else{if(!(null===(s=ke().gapi)||void 0===s?void 0:s.load)){const e=Ue("iframefcb");return ke()[e]=()=>{gapi.load?a():n(Z(t,"network-request-failed"))},o=`https://apis.google.com/js/api.js?onload=${e}`,new Promise(((t,e)=>{const n=document.createElement("script");n.setAttribute("src",o),n.onload=t,n.onerror=t=>{const n=Z("internal-error");n.customData=t,e(n)},n.type="text/javascript",n.charset="UTF-8",function(){var t,e;return null!==(e=null===(t=document.getElementsByTagName("head"))||void 0===t?void 0:t[0])&&void 0!==e?e:document}().appendChild(n)}))}a()}})).catch((t=>{throw on=null,t}))}(t),on}const cn=new ct(5e3,15e3),un={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"}},hn=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function ln(t){const e=t.config;et(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?ut(e,"emulator/auth/iframe"):`https://${t.config.authDomain}/__/auth/iframe`,r={apiKey:e.apiKey,appName:t.name,v:H},i=hn.get(t.config.apiHost);i&&(r.eid=i);const s=t._getFrameworks();return s.length&&(r.fw=s.join(",")),`${n}?${y(r).slice(1)}`}const dn={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class fn{constructor(t){this.window=t,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(t){}}}function pn(t,e,n,r,i,s){et(t.config.authDomain,t,"auth-domain-config-required"),et(t.config.apiKey,t,"invalid-api-key");const o={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:H,eventId:i};if(e instanceof ne){e.setDefaultLanguage(t.languageCode),o.providerId=e.providerId||"",function(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[t,e]of Object.entries(s||{}))o[t]=e}if(e instanceof re){const t=e.getScopes().filter((t=>""!==t));t.length>0&&(o.scopes=t.join(","))}t.tenantId&&(o.tid=t.tenantId);const a=o;for(const t of Object.keys(a))void 0===a[t]&&delete a[t];return`${function({config:t}){return t.emulator?ut(t,"emulator/auth/handler"):`https://${t.authDomain}/__/auth/handler`}(t)}?${y(a).slice(1)}`}const mn="webStorageSupport",gn=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Te,this._completeRedirectFn=Ye}async _openPopup(t,e,n,r){var i;return rt(null===(i=this.eventManagers[t._key()])||void 0===i?void 0:i.manager,"_initialize() not called before _openPopup()"),function(t,e,n,r=500,i=600){const s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let c="";const u=Object.assign(Object.assign({},dn),{width:r.toString(),height:i.toString(),top:s,left:o}),h=a().toLowerCase();n&&(c=Ft(h)?"_blank":n),Pt(h)&&(e=e||"http://localhost",u.scrollbars="yes");const l=Object.entries(u).reduce(((t,[e,n])=>`${t}${e}=${n},`),"");if(function(t=a()){var e;return Bt(t)&&!!(null===(e=window.navigator)||void 0===e?void 0:e.standalone)}(h)&&"_self"!==c)return function(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(e||"",c),new fn(null);const d=window.open(e||"",c,l);et(d,t,"popup-blocked");try{d.focus()}catch(t){}return new fn(d)}(t,pn(t,e,n,ot(),r),Se())}async _openRedirect(t,e,n,r){var i;return await this._originValidation(t),i=pn(t,e,n,ot(),r),ke().location.href=i,new Promise((()=>{}))}_initialize(t){const e=t._key();if(this.eventManagers[e]){const{manager:t,promise:n}=this.eventManagers[e];return t?Promise.resolve(t):(rt(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(t);return this.eventManagers[e]={promise:n},n}async initAndGetManager(t){const e=await async function(t){const e=await an(t),n=ke().gapi;return et(n,t,"internal-error"),e.open({where:document.body,url:ln(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:un,dontclear:!0},(e=>new Promise((async(n,r)=>{await e.restyle({setHideOnLeave:!1});const i=Z(t,"network-request-failed"),s=ke().setTimeout((()=>{r(i)}),cn.get());function o(){ke().clearTimeout(s),n(e)}e.ping(o).then(o,(()=>{r(i)}))}))))}(t),n=new Xe(t);return e.register("authEvent",(e=>(et(null==e?void 0:e.authEvent,t,"invalid-auth-event"),{status:n.onEvent(e.authEvent)?"ACK":"ERROR"})),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:n},this.iframes[t._key()]=e,n}_isIframeWebStorageSupported(t,e){this.iframes[t._key()].send(mn,{type:mn},(n=>{var r;const i=null===(r=null==n?void 0:n[0])||void 0===r?void 0:r.webStorageSupport;void 0!==i&&e(!!i),J(t,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(t){const e=t._key();return this.originValidationPromises[e]||(this.originValidationPromises[e]=async function(t){if(t.config.emulator)return;const{authorizedDomains:e}=await async function(t,e={}){return pt(t,"GET","/v1/projects",e)}(t);for(const t of e)try{if(nn(t))return}catch(t){}J(t,"unauthorized-domain")}(t)),this.originValidationPromises[e]}get _shouldInitProactively(){return Kt()||Mt()||Bt()}};var yn;class vn{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){var t;return this.assertAuthConfigured(),(null===(t=this.auth.currentUser)||void 0===t?void 0:t.uid)||null}async getToken(t){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(t)}:null}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const e=this.auth.onIdTokenChanged((e=>{var n;t((null===(n=e)||void 0===n?void 0:n.stsTokenManager.accessToken)||null)}));this.internalListeners.set(t,e),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const e=this.internalListeners.get(t);e&&(this.internalListeners.delete(t),e(),this.updateProactiveRefresh())}assertAuthConfigured(){et(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}yn="Browser",q(new E("auth",((t,{options:e})=>{const n=t.getProvider("app").getImmediate(),{apiKey:r,authDomain:i}=n.options;return(t=>{et(r&&!r.includes(":"),"invalid-api-key",{appName:t.name}),et(!(null==i?void 0:i.includes(":")),"argument-error",{appName:t.name});const n={apiKey:r,authDomain:i,clientPlatform:yn,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:zt(yn)},s=new Ht(t,n);return function(t,e){const n=(null==e?void 0:e.persistence)||[],r=(Array.isArray(n)?n:[n]).map(st);(null==e?void 0:e.errorMap)&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,null==e?void 0:e.popupRedirectResolver)}(s,e),s})(n)}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((t,e,n)=>{t.getProvider("auth-internal").initialize()}))),q(new E("auth-internal",(t=>(t=>new vn(t))(Gt(t.getProvider("auth").getImmediate()))),"PRIVATE").setInstantiationMode("EXPLICIT")),$("@firebase/auth","0.18.0",void 0);var wn,In="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:{},bn={},Tn=Tn||{},En=In||self;function Sn(){}function _n(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function kn(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var Nn="closure_uid_"+(1e9*Math.random()>>>0),An=0;function Dn(t,e,n){return t.call.apply(t.bind,arguments)}function Cn(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function Rn(t,e,n){return(Rn=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Dn:Cn).apply(null,arguments)}function xn(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function On(t,e){function n(){}n.prototype=e.prototype,t.Z=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Vb=function(t,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return e.prototype[n].apply(t,i)}}function Ln(){this.s=this.s,this.o=this.o}var Pn={};Ln.prototype.s=!1,Ln.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var t=function(t){return Object.prototype.hasOwnProperty.call(t,Nn)&&t[Nn]||(t[Nn]=++An)}(this);delete Pn[t]}},Ln.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const Mn=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(let n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},Fn=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){const r=t.length,i="string"==typeof t?t.split(""):t;for(let s=0;s<r;s++)s in i&&e.call(n,i[s],s,t)};function Un(t){return Array.prototype.concat.apply([],arguments)}function Vn(t){const e=t.length;if(0<e){const n=Array(e);for(let r=0;r<e;r++)n[r]=t[r];return n}return[]}function jn(t){return/^[\s\xa0]*$/.test(t)}var qn,Bn=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function Kn(t,e){return-1!=t.indexOf(e)}function zn(t,e){return t<e?-1:t>e?1:0}t:{var Hn=En.navigator;if(Hn){var Gn=Hn.userAgent;if(Gn){qn=Gn;break t}}qn=""}function $n(t,e,n){for(const r in t)e.call(n,t[r],r,t)}function Wn(t){const e={};for(const n in t)e[n]=t[n];return e}var Qn="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Yn(t,e){let n,r;for(let e=1;e<arguments.length;e++){for(n in r=arguments[e],r)t[n]=r[n];for(let e=0;e<Qn.length;e++)n=Qn[e],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function Xn(t){return Xn[" "](t),t}Xn[" "]=Sn;var Jn,Zn,tr=Kn(qn,"Opera"),er=Kn(qn,"Trident")||Kn(qn,"MSIE"),nr=Kn(qn,"Edge"),rr=nr||er,ir=Kn(qn,"Gecko")&&!(Kn(qn.toLowerCase(),"webkit")&&!Kn(qn,"Edge"))&&!(Kn(qn,"Trident")||Kn(qn,"MSIE"))&&!Kn(qn,"Edge"),sr=Kn(qn.toLowerCase(),"webkit")&&!Kn(qn,"Edge");function or(){var t=En.document;return t?t.documentMode:void 0}t:{var ar="",cr=(Zn=qn,ir?/rv:([^\);]+)(\)|;)/.exec(Zn):nr?/Edge\/([\d\.]+)/.exec(Zn):er?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Zn):sr?/WebKit\/(\S+)/.exec(Zn):tr?/(?:Version)[ \/]?(\S+)/.exec(Zn):void 0);if(cr&&(ar=cr?cr[1]:""),er){var ur=or();if(null!=ur&&ur>parseFloat(ar)){Jn=String(ur);break t}}Jn=ar}var hr,lr={};function dr(){return t=lr,Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=function(){let t=0;const e=Bn(String(Jn)).split("."),n=Bn("9").split("."),r=Math.max(e.length,n.length);for(let o=0;0==t&&o<r;o++){var i=e[o]||"",s=n[o]||"";do{if(i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==i[0].length&&0==s[0].length)break;t=zn(0==i[1].length?0:parseInt(i[1],10),0==s[1].length?0:parseInt(s[1],10))||zn(0==i[2].length,0==s[2].length)||zn(i[2],s[2]),i=i[3],s=s[3]}while(0==t)}return 0<=t}();var t}En.document&&er?hr=or()||parseInt(Jn,10)||void 0:hr=void 0;var fr=hr,pr=function(){if(!En.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{En.addEventListener("test",Sn,e),En.removeEventListener("test",Sn,e)}catch(t){}return t}();function mr(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}function gr(t,e){if(mr.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(ir){t:{try{Xn(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:yr[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&gr.Z.h.call(this)}}mr.prototype.h=function(){this.defaultPrevented=!0},On(gr,mr);var yr={2:"touch",3:"pen",4:"mouse"};gr.prototype.h=function(){gr.Z.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var vr="closure_listenable_"+(1e6*Math.random()|0),wr=0;function Ir(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ia=i,this.key=++wr,this.ca=this.fa=!1}function br(t){t.ca=!0,t.listener=null,t.proxy=null,t.src=null,t.ia=null}function Tr(t){this.src=t,this.g={},this.h=0}function Er(t,e){var n=e.type;if(n in t.g){var r,i=t.g[n],s=Mn(i,e);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(br(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function Sr(t,e,n,r){for(var i=0;i<t.length;++i){var s=t[i];if(!s.ca&&s.listener==e&&s.capture==!!n&&s.ia==r)return i}return-1}Tr.prototype.add=function(t,e,n,r,i){var s=t.toString();(t=this.g[s])||(t=this.g[s]=[],this.h++);var o=Sr(t,e,r,i);return-1<o?(e=t[o],n||(e.fa=!1)):((e=new Ir(e,this.src,s,!!r,i)).fa=n,t.push(e)),e};var _r="closure_lm_"+(1e6*Math.random()|0),kr={};function Nr(t,e,n,r,i){if(r&&r.once)return Dr(t,e,n,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)Nr(t,e[s],n,r,i);return null}return n=Mr(n),t&&t[vr]?t.N(e,n,kn(r)?!!r.capture:!!r,i):Ar(t,e,n,!1,r,i)}function Ar(t,e,n,r,i,s){if(!e)throw Error("Invalid event type");var o=kn(i)?!!i.capture:!!i,a=Lr(t);if(a||(t[_r]=a=new Tr(t)),(n=a.add(e,n,r,o,s)).proxy)return n;if(r=function(){var t=Or;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)pr||(i=o),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(xr(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Dr(t,e,n,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)Dr(t,e[s],n,r,i);return null}return n=Mr(n),t&&t[vr]?t.O(e,n,kn(r)?!!r.capture:!!r,i):Ar(t,e,n,!0,r,i)}function Cr(t,e,n,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)Cr(t,e[s],n,r,i);else r=kn(r)?!!r.capture:!!r,n=Mr(n),t&&t[vr]?(t=t.i,(e=String(e).toString())in t.g&&-1<(n=Sr(s=t.g[e],n,r,i))&&(br(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete t.g[e],t.h--))):t&&(t=Lr(t))&&(e=t.g[e.toString()],t=-1,e&&(t=Sr(e,n,r,i)),(n=-1<t?e[t]:null)&&Rr(n))}function Rr(t){if("number"!=typeof t&&t&&!t.ca){var e=t.src;if(e&&e[vr])Er(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(xr(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Lr(e))?(Er(n,t),0==n.h&&(n.src=null,e[_r]=null)):br(t)}}}function xr(t){return t in kr?kr[t]:kr[t]="on"+t}function Or(t,e){if(t.ca)t=!0;else{e=new gr(e,this);var n=t.listener,r=t.ia||t.src;t.fa&&Rr(t),t=n.call(r,e)}return t}function Lr(t){return(t=t[_r])instanceof Tr?t:null}var Pr="__closure_events_fn_"+(1e9*Math.random()>>>0);function Mr(t){return"function"==typeof t?t:(t[Pr]||(t[Pr]=function(e){return t.handleEvent(e)}),t[Pr])}function Fr(){Ln.call(this),this.i=new Tr(this),this.P=this,this.I=null}function Ur(t,e){var n,r=t.I;if(r)for(n=[];r;r=r.I)n.push(r);if(t=t.P,r=e.type||e,"string"==typeof e)e=new mr(e,t);else if(e instanceof mr)e.target=e.target||t;else{var i=e;Yn(e=new mr(r,t),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=e.g=n[s];i=Vr(o,r,!0,e)&&i}if(i=Vr(o=e.g=t,r,!0,e)&&i,i=Vr(o,r,!1,e)&&i,n)for(s=0;s<n.length;s++)i=Vr(o=e.g=n[s],r,!1,e)&&i}function Vr(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.ca&&o.capture==n){var a=o.listener,c=o.ia||o.src;o.fa&&Er(t.i,o),i=!1!==a.call(c,r)&&i}}return i&&!r.defaultPrevented}On(Fr,Ln),Fr.prototype[vr]=!0,Fr.prototype.removeEventListener=function(t,e,n,r){Cr(this,t,e,n,r)},Fr.prototype.M=function(){if(Fr.Z.M.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)br(n[r]);delete e.g[t],e.h--}}this.I=null},Fr.prototype.N=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},Fr.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};var jr=En.JSON.stringify;function qr(){var t=Wr;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var Br,Kr=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}((()=>new zr),(t=>t.reset()));class zr{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}function Hr(t){En.setTimeout((()=>{throw t}),0)}function Gr(t,e){Br||function(){var t=En.Promise.resolve(void 0);Br=function(){t.then(Qr)}}(),$r||(Br(),$r=!0),Wr.add(t,e)}var $r=!1,Wr=new class{constructor(){this.h=this.g=null}add(t,e){const n=Kr.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}};function Qr(){for(var t;t=qr();){try{t.h.call(t.g)}catch(t){Hr(t)}var e=Kr;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}$r=!1}function Yr(t,e){Fr.call(this),this.h=t||1,this.g=e||En,this.j=Rn(this.kb,this),this.l=Date.now()}function Xr(t){t.da=!1,t.S&&(t.g.clearTimeout(t.S),t.S=null)}function Jr(t,e,n){if("function"==typeof t)n&&(t=Rn(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=Rn(t.handleEvent,t)}return 2147483647<Number(e)?-1:En.setTimeout(t,e||0)}function Zr(t){t.g=Jr((()=>{t.g=null,t.i&&(t.i=!1,Zr(t))}),t.j);const e=t.h;t.h=null,t.m.apply(null,e)}On(Yr,Fr),(wn=Yr.prototype).da=!1,wn.S=null,wn.kb=function(){if(this.da){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-t):(this.S&&(this.g.clearTimeout(this.S),this.S=null),Ur(this,"tick"),this.da&&(Xr(this),this.start()))}},wn.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},wn.M=function(){Yr.Z.M.call(this),Xr(this),delete this.g};class ti extends Ln{constructor(t,e){super(),this.m=t,this.j=e,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:Zr(this)}M(){super.M(),this.g&&(En.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ei(t){Ln.call(this),this.h=t,this.g={}}On(ei,Ln);var ni=[];function ri(t,e,n,r){Array.isArray(n)||(n&&(ni[0]=n.toString()),n=ni);for(var i=0;i<n.length;i++){var s=Nr(e,n[i],r||t.handleEvent,!1,t.h||t);if(!s)break;t.g[s.key]=s}}function ii(t){$n(t.g,(function(t,e){this.g.hasOwnProperty(e)&&Rr(t)}),t),t.g={}}function si(){this.g=!0}function oi(t,e,n,r){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return jr(n)}catch(t){return e}}(t,n)+(r?" "+r:"")}))}ei.prototype.M=function(){ei.Z.M.call(this),ii(this)},ei.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},si.prototype.Aa=function(){this.g=!1},si.prototype.info=function(){};var ai={},ci=null;function ui(){return ci=ci||new Fr}function hi(t){mr.call(this,ai.Ma,t)}function li(t){const e=ui();Ur(e,new hi(e,t))}function di(t,e){mr.call(this,ai.STAT_EVENT,t),this.stat=e}function fi(t){const e=ui();Ur(e,new di(e,t))}function pi(t,e){mr.call(this,ai.Na,t),this.size=e}function mi(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return En.setTimeout((function(){t()}),e)}ai.Ma="serverreachability",On(hi,mr),ai.STAT_EVENT="statevent",On(di,mr),ai.Na="timingevent",On(pi,mr);var gi={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},yi={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function vi(){}function wi(t){return t.h||(t.h=t.i())}function Ii(){}vi.prototype.h=null;var bi,Ti={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function Ei(){mr.call(this,"d")}function Si(){mr.call(this,"c")}function _i(){}function ki(t,e,n,r){this.l=t,this.j=e,this.m=n,this.X=r||1,this.V=new ei(this),this.P=Ai,t=rr?125:void 0,this.W=new Yr(t),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new Ni}function Ni(){this.i=null,this.g="",this.h=!1}On(Ei,mr),On(Si,mr),On(_i,vi),_i.prototype.g=function(){return new XMLHttpRequest},_i.prototype.i=function(){return{}},bi=new _i;var Ai=45e3,Di={},Ci={};function Ri(t,e,n){t.K=1,t.v=ts(Wi(e)),t.s=n,t.U=!0,xi(t,null)}function xi(t,e){t.F=Date.now(),Mi(t),t.A=Wi(t.v);var n=t.A,r=t.X;Array.isArray(r)||(r=[String(r)]),fs(n.h,"t",r),t.C=0,n=t.l.H,t.h=new Ni,t.g=po(t.l,n?e:null,!t.s),0<t.O&&(t.L=new ti(Rn(t.Ia,t,t.g),t.O)),ri(t.V,t.g,"readystatechange",t.gb),e=t.H?Wn(t.H):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.A,t.u,t.s,e)):(t.u="GET",t.g.ea(t.A,t.u,null,e)),li(1),function(t,e,n,r,i,s){t.info((function(){if(t.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var h=u[0];u=u[1];var l=h.split("_");o=2<=l.length&&"type"==l[1]?o+(h+"=")+u+"&":o+(h+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+o}))}(t.j,t.u,t.A,t.m,t.X,t.s)}function Oi(t){return!!t.g&&"GET"==t.u&&2!=t.K&&t.l.Ba}function Li(t,e,n){let r,i=!0;for(;!t.I&&t.C<n.length;){if(r=Pi(t,n),r==Ci){4==e&&(t.o=4,fi(14),i=!1),oi(t.j,t.m,null,"[Incomplete Response]");break}if(r==Di){t.o=4,fi(15),oi(t.j,t.m,n,"[Invalid Chunk]"),i=!1;break}oi(t.j,t.m,r,null),qi(t,r)}Oi(t)&&r!=Ci&&r!=Di&&(t.h.g="",t.C=0),4!=e||0!=n.length||t.h.h||(t.o=1,fi(16),i=!1),t.i=t.i&&i,i?0<n.length&&!t.aa&&(t.aa=!0,(e=t.l).g==t&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),so(e),e.L=!0,fi(11))):(oi(t.j,t.m,n,"[Invalid Chunked Response]"),ji(t),Vi(t))}function Pi(t,e){var n=t.C,r=e.indexOf("\n",n);return-1==r?Ci:(n=Number(e.substring(n,r)),isNaN(n)?Di:(r+=1)+n>e.length?Ci:(e=e.substr(r,n),t.C=r+n,e))}function Mi(t){t.Y=Date.now()+t.P,Fi(t,t.P)}function Fi(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=mi(Rn(t.eb,t),e)}function Ui(t){t.B&&(En.clearTimeout(t.B),t.B=null)}function Vi(t){0==t.l.G||t.I||co(t.l,t)}function ji(t){Ui(t);var e=t.L;e&&"function"==typeof e.na&&e.na(),t.L=null,Xr(t.W),ii(t.V),t.g&&(e=t.g,t.g=null,e.abort(),e.na())}function qi(t,e){try{var n=t.l;if(0!=n.G&&(n.g==t||ws(n.i,t)))if(n.I=t.N,!t.J&&ws(n.i,t)&&3==n.G){try{var r=n.Ca.g.parse(e)}catch(t){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.u){if(n.g){if(!(n.g.F+3e3<t.F))break t;ao(n),Ys(n)}io(n),fi(18)}}else n.ta=i[1],0<n.ta-n.U&&37500>i[2]&&n.N&&0==n.A&&!n.v&&(n.v=mi(Rn(n.ab,n),6e3));if(1>=vs(n.i)&&n.ka){try{n.ka()}catch(t){}n.ka=void 0}}else ho(n,11)}else if((t.J||n.g==t)&&ao(n),!jn(e))for(i=n.Ca.g.parse(e),e=0;e<i.length;e++){let u=i[e];if(n.U=u[0],u=u[1],2==n.G)if("c"==u[0]){n.J=u[1],n.la=u[2];const e=u[3];null!=e&&(n.ma=e,n.h.info("VER="+n.ma));const i=u[4];null!=i&&(n.za=i,n.h.info("SVER="+n.za));const h=u[5];null!=h&&"number"==typeof h&&0<h&&(r=1.5*h,n.K=r,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n;const l=t.g;if(l){const t=l.g?l.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var s=r.i;!s.g&&(Kn(t,"spdy")||Kn(t,"quic")||Kn(t,"h2"))&&(s.j=s.l,s.g=new Set,s.h&&(Is(s,s.h),s.h=null))}if(r.D){const t=l.g?l.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(r.sa=t,Zi(r.F,r.D,t))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-t.F,n.h.info("Handshake RTT: "+n.O+"ms"));var o=t;if((r=n).oa=fo(r,r.H?r.la:null,r.W),o.J){bs(r.i,o);var a=o,c=r.K;c&&a.setTimeout(c),a.B&&(Ui(a),Mi(a)),r.g=o}else ro(r);0<n.l.length&&Zs(n)}else"stop"!=u[0]&&"close"!=u[0]||ho(n,7);else 3==n.G&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?ho(n,7):Qs(n):"noop"!=u[0]&&n.j&&n.j.wa(u),n.A=0)}li(4)}catch(t){}}function Bi(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(_n(t)||"string"==typeof t)Fn(t,e,void 0);else{if(t.T&&"function"==typeof t.T)var n=t.T();else if(t.R&&"function"==typeof t.R)n=void 0;else if(_n(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;r=function(t){if(t.R&&"function"==typeof t.R)return t.R();if("string"==typeof t)return t.split("");if(_n(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t),i=r.length;for(var s=0;s<i;s++)e.call(void 0,r[s],n&&n[s],t)}}function Ki(t,e){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Ki)for(n=t.T(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function zi(t){if(t.i!=t.g.length){for(var e=0,n=0;e<t.g.length;){var r=t.g[e];Hi(t.h,r)&&(t.g[n++]=r),e++}t.g.length=n}if(t.i!=t.g.length){var i={};for(n=e=0;e<t.g.length;)Hi(i,r=t.g[e])||(t.g[n++]=r,i[r]=1),e++;t.g.length=n}}function Hi(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(wn=ki.prototype).setTimeout=function(t){this.P=t},wn.gb=function(t){t=t.target;const e=this.L;e&&3==zs(t)?e.l():this.Ia(t)},wn.Ia=function(t){try{if(t==this.g)t:{const h=zs(this.g);var e=this.g.Da();const l=this.g.ba();if(!(3>h)&&(3!=h||rr||this.g&&(this.h.h||this.g.ga()||Hs(this.g)))){this.I||4!=h||7==e||li(8==e||0>=l?3:2),Ui(this);var n=this.g.ba();this.N=n;e:if(Oi(this)){var r=Hs(this.g);t="";var i=r.length,s=4==zs(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){ji(this),Vi(this);var o="";break e}this.h.i=new En.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,t+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.splice(0,i),this.h.g+=t,this.C=0,o=this.h.g}else o=this.g.ga();if(this.i=200==n,function(t,e,n,r,i,s,o){t.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+s+" "+o}))}(this.j,this.u,this.A,this.m,this.X,h,n),this.i){if(this.$&&!this.J){e:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!jn(a)){var u=a;break e}}u=null}if(!(n=u)){this.i=!1,this.o=3,fi(12),ji(this),Vi(this);break t}oi(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,qi(this,n)}this.U?(Li(this,h,o),rr&&this.i&&3==h&&(ri(this.V,this.W,"tick",this.fb),this.W.start())):(oi(this.j,this.m,o,null),qi(this,o)),4==h&&ji(this),this.i&&!this.I&&(4==h?co(this.l,this):(this.i=!1,Mi(this)))}else 400==n&&0<o.indexOf("Unknown SID")?(this.o=3,fi(12)):(this.o=0,fi(13)),ji(this),Vi(this)}}}catch(t){}},wn.fb=function(){if(this.g){var t=zs(this.g),e=this.g.ga();this.C<e.length&&(Ui(this),Li(this,t,e),this.i&&4!=t&&Mi(this))}},wn.cancel=function(){this.I=!0,ji(this)},wn.eb=function(){this.B=null;const t=Date.now();0<=t-this.Y?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.j,this.A),2!=this.K&&(li(3),fi(17)),ji(this),this.o=2,Vi(this)):Fi(this,this.Y-t)},(wn=Ki.prototype).R=function(){zi(this);for(var t=[],e=0;e<this.g.length;e++)t.push(this.h[this.g[e]]);return t},wn.T=function(){return zi(this),this.g.concat()},wn.get=function(t,e){return Hi(this.h,t)?this.h[t]:e},wn.set=function(t,e){Hi(this.h,t)||(this.i++,this.g.push(t)),this.h[t]=e},wn.forEach=function(t,e){for(var n=this.T(),r=0;r<n.length;r++){var i=n[r],s=this.get(i);t.call(e,s,i,this)}};var Gi=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function $i(t,e){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,t instanceof $i){this.g=void 0!==e?e:t.g,Qi(this,t.j),this.s=t.s,Yi(this,t.i),Xi(this,t.m),this.l=t.l,e=t.h;var n=new us;n.i=e.i,e.g&&(n.g=new Ki(e.g),n.h=e.h),Ji(this,n),this.o=t.o}else t&&(n=String(t).match(Gi))?(this.g=!!e,Qi(this,n[1]||"",!0),this.s=es(n[2]||""),Yi(this,n[3]||"",!0),Xi(this,n[4]),this.l=es(n[5]||"",!0),Ji(this,n[6]||"",!0),this.o=es(n[7]||"")):(this.g=!!e,this.h=new us(null,this.g))}function Wi(t){return new $i(t)}function Qi(t,e,n){t.j=n?es(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function Yi(t,e,n){t.i=n?es(e,!0):e}function Xi(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function Ji(t,e,n){e instanceof us?(t.h=e,function(t,e){e&&!t.j&&(hs(t),t.i=null,t.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(ls(this,e),fs(this,n,t))}),t)),t.j=e}(t.h,t.g)):(n||(e=ns(e,as)),t.h=new us(e,t.g))}function Zi(t,e,n){t.h.set(e,n)}function ts(t){return Zi(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function es(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function ns(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,rs),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function rs(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}$i.prototype.toString=function(){var t=[],e=this.j;e&&t.push(ns(e,is,!0),":");var n=this.i;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(ns(e,is,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&t.push("/"),t.push(ns(n,"/"==n.charAt(0)?os:ss,!0))),(n=this.h.toString())&&t.push("?",n),(n=this.o)&&t.push("#",ns(n,cs)),t.join("")};var is=/[#\/\?@]/g,ss=/[#\?:]/g,os=/[#\?]/g,as=/[#\?@]/g,cs=/#/g;function us(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function hs(t){t.g||(t.g=new Ki,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var s=t[n].substring(0,r);i=t[n].substring(r+1)}else s=t[n];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function ls(t,e){hs(t),e=ps(t,e),Hi(t.g.h,e)&&(t.i=null,t.h-=t.g.get(e).length,Hi((t=t.g).h,e)&&(delete t.h[e],t.i--,t.g.length>2*t.i&&zi(t)))}function ds(t,e){return hs(t),e=ps(t,e),Hi(t.g.h,e)}function fs(t,e,n){ls(t,e),0<n.length&&(t.i=null,t.g.set(ps(t,e),Vn(n)),t.h+=n.length)}function ps(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function ms(t){this.l=t||gs,t=En.PerformanceNavigationTiming?0<(t=En.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(En.g&&En.g.Ea&&En.g.Ea()&&En.g.Ea().Zb),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(wn=us.prototype).add=function(t,e){hs(this),this.i=null,t=ps(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},wn.forEach=function(t,e){hs(this),this.g.forEach((function(n,r){Fn(n,(function(n){t.call(e,n,r,this)}),this)}),this)},wn.T=function(){hs(this);for(var t=this.g.R(),e=this.g.T(),n=[],r=0;r<e.length;r++)for(var i=t[r],s=0;s<i.length;s++)n.push(e[r]);return n},wn.R=function(t){hs(this);var e=[];if("string"==typeof t)ds(this,t)&&(e=Un(e,this.g.get(ps(this,t))));else{t=this.g.R();for(var n=0;n<t.length;n++)e=Un(e,t[n])}return e},wn.set=function(t,e){return hs(this),this.i=null,ds(this,t=ps(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},wn.get=function(t,e){return t&&0<(t=this.R(t)).length?String(t[0]):e},wn.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var t=[],e=this.g.T(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.R(r);for(var s=0;s<r.length;s++){var o=i;""!==r[s]&&(o+="="+encodeURIComponent(String(r[s]))),t.push(o)}}return this.i=t.join("&")};var gs=10;function ys(t){return!!t.h||!!t.g&&t.g.size>=t.j}function vs(t){return t.h?1:t.g?t.g.size:0}function ws(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function Is(t,e){t.g?t.g.add(e):t.h=e}function bs(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function Ts(t){if(null!=t.h)return t.i.concat(t.h.D);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const n of t.g.values())e=e.concat(n.D);return e}return Vn(t.i)}function Es(){}function Ss(){this.g=new Es}function _s(t,e,n){const r=n||"";try{Bi(t,(function(t,n){let i=t;kn(t)&&(i=jr(t)),e.push(r+n+"="+encodeURIComponent(i))}))}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}}function ks(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}function Ns(t){this.l=t.$b||null,this.j=t.ib||!1}function As(t,e){Fr.call(this),this.D=t,this.u=e,this.m=void 0,this.readyState=Ds,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}ms.prototype.cancel=function(){if(this.i=Ts(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}},Es.prototype.stringify=function(t){return En.JSON.stringify(t,void 0)},Es.prototype.parse=function(t){return En.JSON.parse(t,void 0)},On(Ns,vi),Ns.prototype.g=function(){return new As(this.l,this.j)},Ns.prototype.i=function(t){return function(){return t}}({}),On(As,Fr);var Ds=0;function Cs(t){t.j.read().then(t.Sa.bind(t)).catch(t.ha.bind(t))}function Rs(t){t.readyState=4,t.l=null,t.j=null,t.A=null,xs(t)}function xs(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(wn=As.prototype).open=function(t,e){if(this.readyState!=Ds)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,xs(this)},wn.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||En).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))},wn.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Rs(this)),this.readyState=Ds},wn.Va=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,xs(this)),this.g&&(this.readyState=3,xs(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==En.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Cs(this)}else t.text().then(this.Ua.bind(this),this.ha.bind(this))},wn.Sa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?Rs(this):xs(this),3==this.readyState&&Cs(this)}},wn.Ua=function(t){this.g&&(this.response=this.responseText=t,Rs(this))},wn.Ta=function(t){this.g&&(this.response=t,Rs(this))},wn.ha=function(){this.g&&Rs(this)},wn.setRequestHeader=function(t,e){this.v.append(t,e)},wn.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},wn.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(As.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var Os=En.JSON.parse;function Ls(t){Fr.call(this),this.headers=new Ki,this.u=t||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Ps,this.K=this.L=!1}On(Ls,Fr);var Ps="",Ms=/^https?$/i,Fs=["POST","PUT"];function Us(t){return"content-type"==t.toLowerCase()}function Vs(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,js(t),Bs(t)}function js(t){t.D||(t.D=!0,Ur(t,"complete"),Ur(t,"error"))}function qs(t){if(t.h&&void 0!==Tn&&(!t.C[1]||4!=zs(t)||2!=t.ba()))if(t.v&&4==zs(t))Jr(t.Fa,0,t);else if(Ur(t,"readystatechange"),4==zs(t)){t.h=!1;try{const a=t.ba();t:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var n;if(!(n=e)){var r;if(r=0===a){var i=String(t.H).match(Gi)[1]||null;if(!i&&En.self&&En.self.location){var s=En.self.location.protocol;i=s.substr(0,s.length-1)}r=!Ms.test(i?i.toLowerCase():"")}n=r}if(n)Ur(t,"complete"),Ur(t,"success");else{t.m=6;try{var o=2<zs(t)?t.g.statusText:""}catch(t){o=""}t.j=o+" ["+t.ba()+"]",js(t)}}finally{Bs(t)}}}function Bs(t,e){if(t.g){Ks(t);const n=t.g,r=t.C[0]?Sn:null;t.g=null,t.C=null,e||Ur(t,"ready");try{n.onreadystatechange=r}catch(t){}}}function Ks(t){t.g&&t.K&&(t.g.ontimeout=null),t.A&&(En.clearTimeout(t.A),t.A=null)}function zs(t){return t.g?t.g.readyState:0}function Hs(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.J){case Ps:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Gs(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=function(t){let e="";return $n(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Zi(t,e,n))}function $s(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Ws(t){this.za=0,this.l=[],this.h=new si,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=$s("failFast",!1,t),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=$s("baseRetryDelayMs",5e3,t),this.$a=$s("retryDelaySeedMs",1e4,t),this.Ya=$s("forwardChannelMaxRetries",2,t),this.ra=$s("forwardChannelRequestTimeoutMs",2e4,t),this.qa=t&&t.xmlHttpFactory||void 0,this.Ba=t&&t.Yb||!1,this.K=void 0,this.H=t&&t.supportsCrossDomainXhr||!1,this.J="",this.i=new ms(t&&t.concurrentRequestLimit),this.Ca=new Ss,this.ja=t&&t.fastHandshake||!1,this.Ra=t&&t.Wb||!1,t&&t.Aa&&this.h.Aa(),t&&t.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&t&&t.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!t||!1!==t.Xb}function Qs(t){if(Xs(t),3==t.G){var e=t.V++,n=Wi(t.F);Zi(n,"SID",t.J),Zi(n,"RID",e),Zi(n,"TYPE","terminate"),eo(t,n),(e=new ki(t,t.h,e,void 0)).K=2,e.v=ts(Wi(n)),n=!1,En.navigator&&En.navigator.sendBeacon&&(n=En.navigator.sendBeacon(e.v.toString(),"")),!n&&En.Image&&((new Image).src=e.v,n=!0),n||(e.g=po(e.l,null),e.g.ea(e.v)),e.F=Date.now(),Mi(e)}lo(t)}function Ys(t){t.g&&(so(t),t.g.cancel(),t.g=null)}function Xs(t){Ys(t),t.u&&(En.clearTimeout(t.u),t.u=null),ao(t),t.i.cancel(),t.m&&("number"==typeof t.m&&En.clearTimeout(t.m),t.m=null)}function Js(t,e){t.l.push(new class{constructor(t,e){this.h=t,this.g=e}}(t.Za++,e)),3==t.G&&Zs(t)}function Zs(t){ys(t.i)||t.m||(t.m=!0,Gr(t.Ha,t),t.C=0)}function to(t,e){var n;n=e?e.m:t.V++;const r=Wi(t.F);Zi(r,"SID",t.J),Zi(r,"RID",n),Zi(r,"AID",t.U),eo(t,r),t.o&&t.s&&Gs(r,t.o,t.s),n=new ki(t,t.h,n,t.C+1),null===t.o&&(n.H=t.s),e&&(t.l=e.D.concat(t.l)),e=no(t,n,1e3),n.setTimeout(Math.round(.5*t.ra)+Math.round(.5*t.ra*Math.random())),Is(t.i,n),Ri(n,r,e)}function eo(t,e){t.j&&Bi({},(function(t,n){Zi(e,n,t)}))}function no(t,e,n){n=Math.min(t.l.length,n);var r=t.j?Rn(t.j.Oa,t.j,t):null;t:{var i=t.l;let e=-1;for(;;){const t=["count="+n];-1==e?0<n?(e=i[0].h,t.push("ofs="+e)):e=0:t.push("ofs="+e);let s=!0;for(let o=0;o<n;o++){let n=i[o].h;const a=i[o].g;if(n-=e,0>n)e=Math.max(0,i[o].h-100),s=!1;else try{_s(a,t,"req"+n+"_")}catch(t){r&&r(a)}}if(s){r=t.join("&");break t}}}return t=t.l.splice(0,n),e.D=t,r}function ro(t){t.g||t.u||(t.Y=1,Gr(t.Ga,t),t.A=0)}function io(t){return!(t.g||t.u||3<=t.A||(t.Y++,t.u=mi(Rn(t.Ga,t),uo(t,t.A)),t.A++,0))}function so(t){null!=t.B&&(En.clearTimeout(t.B),t.B=null)}function oo(t){t.g=new ki(t,t.h,"rpc",t.Y),null===t.o&&(t.g.H=t.s),t.g.O=0;var e=Wi(t.oa);Zi(e,"RID","rpc"),Zi(e,"SID",t.J),Zi(e,"CI",t.N?"0":"1"),Zi(e,"AID",t.U),eo(t,e),Zi(e,"TYPE","xmlhttp"),t.o&&t.s&&Gs(e,t.o,t.s),t.K&&t.g.setTimeout(t.K);var n=t.g;t=t.la,n.K=1,n.v=ts(Wi(e)),n.s=null,n.U=!0,xi(n,t)}function ao(t){null!=t.v&&(En.clearTimeout(t.v),t.v=null)}function co(t,e){var n=null;if(t.g==e){ao(t),so(t),t.g=null;var r=2}else{if(!ws(t.i,e))return;n=e.D,bs(t.i,e),r=1}if(t.I=e.N,0!=t.G)if(e.i)if(1==r){n=e.s?e.s.length:0,e=Date.now()-e.F;var i=t.C;Ur(r=ui(),new pi(r,n,e,i)),Zs(t)}else ro(t);else if(3==(i=e.o)||0==i&&0<t.I||!(1==r&&function(t,e){return!(vs(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.l=e.D.concat(t.l),0):1==t.G||2==t.G||t.C>=(t.Xa?0:t.Ya)||(t.m=mi(Rn(t.Ha,t,e),uo(t,t.C)),t.C++,0)))}(t,e)||2==r&&io(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),i){case 1:ho(t,5);break;case 4:ho(t,10);break;case 3:ho(t,6);break;default:ho(t,2)}}function uo(t,e){let n=t.Pa+Math.floor(Math.random()*t.$a);return t.j||(n*=2),n*e}function ho(t,e){if(t.h.info("Error code "+e),2==e){var n=null;t.j&&(n=null);var r=Rn(t.jb,t);n||(n=new $i("//www.google.com/images/cleardot.gif"),En.location&&"http"==En.location.protocol||Qi(n,"https"),ts(n)),function(t,e){const n=new si;if(En.Image){const r=new Image;r.onload=xn(ks,n,r,"TestLoadImage: loaded",!0,e),r.onerror=xn(ks,n,r,"TestLoadImage: error",!1,e),r.onabort=xn(ks,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=xn(ks,n,r,"TestLoadImage: timeout",!1,e),En.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(n.toString(),r)}else fi(2);t.G=0,t.j&&t.j.va(e),lo(t),Xs(t)}function lo(t){t.G=0,t.I=-1,t.j&&(0==Ts(t.i).length&&0==t.l.length||(t.i.i.length=0,Vn(t.l),t.l.length=0),t.j.ua())}function fo(t,e,n){let r=function(t){return t instanceof $i?Wi(t):new $i(t,void 0)}(n);if(""!=r.i)e&&Yi(r,e+"."+r.i),Xi(r,r.m);else{const t=En.location;r=function(t,e,n,r){var i=new $i(null,void 0);return t&&Qi(i,t),e&&Yi(i,e),n&&Xi(i,n),r&&(i.l=r),i}(t.protocol,e?e+"."+t.hostname:t.hostname,+t.port,n)}return t.aa&&$n(t.aa,(function(t,e){Zi(r,e,t)})),e=t.D,n=t.sa,e&&n&&Zi(r,e,n),Zi(r,"VER",t.ma),eo(t,r),r}function po(t,e,n){if(e&&!t.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=n&&t.Ba&&!t.qa?new Ls(new Ns({ib:!0})):new Ls(t.qa)).L=t.H,e}function mo(){}function go(){if(er&&!(10<=Number(fr)))throw Error("Environmental error: no available transport.")}function yo(t,e){Fr.call(this),this.g=new Ws(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(t?t["X-WebChannel-Client-Profile"]=e.ya:t={"X-WebChannel-Client-Profile":e.ya}),this.g.P=t,(t=e&&e.httpHeadersOverwriteParam)&&!jn(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!jn(e)&&(this.g.D=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new Io(this)}function vo(t){Ei.call(this);var e=t.__sm__;if(e){t:{for(const n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function wo(){Si.call(this),this.status=1}function Io(t){this.g=t}(wn=Ls.prototype).ea=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+t);e=e?e.toUpperCase():"GET",this.H=t,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():bi.g(),this.C=this.u?wi(this.u):wi(bi),this.g.onreadystatechange=Rn(this.Fa,this);try{this.F=!0,this.g.open(e,String(t),!0),this.F=!1}catch(t){return void Vs(this,t)}t=n||"";const i=new Ki(this.headers);r&&Bi(r,(function(t,e){i.set(e,t)})),r=function(t){t:{var e=Us;const n=t.length,r="string"==typeof t?t.split(""):t;for(let i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(i.T()),n=En.FormData&&t instanceof En.FormData,!(0<=Mn(Fs,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach((function(t,e){this.g.setRequestHeader(e,t)}),this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Ks(this),0<this.B&&((this.K=function(t){return er&&dr()&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Rn(this.pa,this)):this.A=Jr(this.pa,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(t){Vs(this,t)}},wn.pa=function(){void 0!==Tn&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Ur(this,"timeout"),this.abort(8))},wn.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,Ur(this,"complete"),Ur(this,"abort"),Bs(this))},wn.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Bs(this,!0)),Ls.Z.M.call(this)},wn.Fa=function(){this.s||(this.F||this.v||this.l?qs(this):this.cb())},wn.cb=function(){qs(this)},wn.ba=function(){try{return 2<zs(this)?this.g.status:-1}catch(t){return-1}},wn.ga=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},wn.Qa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Os(e)}},wn.Da=function(){return this.m},wn.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(wn=Ws.prototype).ma=8,wn.G=1,wn.hb=function(t){try{this.h.info("Origin Trials invoked: "+t)}catch(t){}},wn.Ha=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;const i=new ki(this,this.h,t,void 0);let s=this.s;if(this.P&&(s?(s=Wn(s),Yn(s,this.P)):s=this.P),null===this.o&&(i.H=s),this.ja)t:{for(var e=0,n=0;n<this.l.length;n++){var r=this.l[n];if(void 0===(r="__data__"in r.g&&"string"==typeof(r=r.g.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=n;break t}if(4096===e||n===this.l.length-1){e=n+1;break t}}e=1e3}else e=1e3;e=no(this,i,e),Zi(n=Wi(this.F),"RID",t),Zi(n,"CVER",22),this.D&&Zi(n,"X-HTTP-Session-Id",this.D),eo(this,n),this.o&&s&&Gs(n,this.o,s),Is(this.i,i),this.Ra&&Zi(n,"TYPE","init"),this.ja?(Zi(n,"$req",e),Zi(n,"SID","null"),i.$=!0,Ri(i,n,null)):Ri(i,n,e),this.G=2}}else 3==this.G&&(t?to(this,t):0==this.l.length||ys(this.i)||to(this))},wn.Ga=function(){if(this.u=null,oo(this),this.$&&!(this.L||null==this.g||0>=this.O)){var t=2*this.O;this.h.info("BP detection timer enabled: "+t),this.B=mi(Rn(this.bb,this),t)}},wn.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,fi(10),Ys(this),oo(this))},wn.ab=function(){null!=this.v&&(this.v=null,Ys(this),io(this),fi(19))},wn.jb=function(t){t?(this.h.info("Successfully pinged google.com"),fi(2)):(this.h.info("Failed to ping google.com"),fi(1))},(wn=mo.prototype).xa=function(){},wn.wa=function(){},wn.va=function(){},wn.ua=function(){},wn.Oa=function(){},go.prototype.g=function(t,e){return new yo(t,e)},On(yo,Fr),yo.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var t=this.g,e=this.l,n=this.h||void 0;t.Wa&&(t.h.info("Origin Trials enabled."),Gr(Rn(t.hb,t,e))),fi(0),t.W=e,t.aa=n||{},t.N=t.X,t.F=fo(t,null,t.W),Zs(t)},yo.prototype.close=function(){Qs(this.g)},yo.prototype.u=function(t){if("string"==typeof t){var e={};e.__data__=t,Js(this.g,e)}else this.v?((e={}).__data__=jr(t),Js(this.g,e)):Js(this.g,t)},yo.prototype.M=function(){this.g.j=null,delete this.j,Qs(this.g),delete this.g,yo.Z.M.call(this)},On(vo,Ei),On(wo,Si),On(Io,mo),Io.prototype.xa=function(){Ur(this.g,"a")},Io.prototype.wa=function(t){Ur(this.g,new vo(t))},Io.prototype.va=function(t){Ur(this.g,new wo(t))},Io.prototype.ua=function(){Ur(this.g,"b")},go.prototype.createWebChannel=go.prototype.g,yo.prototype.send=yo.prototype.u,yo.prototype.open=yo.prototype.m,yo.prototype.close=yo.prototype.close,gi.NO_ERROR=0,gi.TIMEOUT=8,gi.HTTP_ERROR=6,yi.COMPLETE="complete",Ii.EventType=Ti,Ti.OPEN="a",Ti.CLOSE="b",Ti.ERROR="c",Ti.MESSAGE="d",Fr.prototype.listen=Fr.prototype.N,Ls.prototype.listenOnce=Ls.prototype.O,Ls.prototype.getLastError=Ls.prototype.La,Ls.prototype.getLastErrorCode=Ls.prototype.Da,Ls.prototype.getStatus=Ls.prototype.ba,Ls.prototype.getResponseJson=Ls.prototype.Qa,Ls.prototype.getResponseText=Ls.prototype.ga,Ls.prototype.send=Ls.prototype.ea;var bo=bn.createWebChannelTransport=function(){return new go},To=bn.getStatEventTarget=function(){return ui()},Eo=bn.ErrorCode=gi,So=bn.EventType=yi,_o=bn.Event=ai,ko=bn.Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},No=bn.FetchXmlHttpFactory=Ns,Ao=bn.WebChannel=Ii,Do=bn.XhrIo=Ls;class Co{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}Co.UNAUTHENTICATED=new Co(null),Co.GOOGLE_CREDENTIALS=new Co("google-credentials-uid"),Co.FIRST_PARTY=new Co("first-party-uid"),Co.MOCK_USER=new Co("mock-user");let Ro="9.1.0";const xo=new O("@firebase/firestore");function Oo(){return xo.logLevel}function Lo(t,...e){if(xo.logLevel<=A.DEBUG){const n=e.map(Fo);xo.debug(`Firestore (${Ro}): ${t}`,...n)}}function Po(t,...e){if(xo.logLevel<=A.ERROR){const n=e.map(Fo);xo.error(`Firestore (${Ro}): ${t}`,...n)}}function Mo(t,...e){if(xo.logLevel<=A.WARN){const n=e.map(Fo);xo.warn(`Firestore (${Ro}): ${t}`,...n)}}function Fo(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function Uo(t="Unexpected state"){const e=`FIRESTORE (${Ro}) INTERNAL ASSERTION FAILED: `+t;throw Po(e),new Error(e)}function Vo(t,e){t||Uo()}function jo(t,e){return t}const qo={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Bo extends Error{constructor(t,e){super(e),this.code=t,this.message=e,this.name="FirebaseError",this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Ko{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class zo{constructor(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization=`Bearer ${t}`}}class Ho{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(Co.UNAUTHENTICATED)))}shutdown(){}}class Go{constructor(t){this.t=t,this.currentUser=Co.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let n=this.i;const r=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let i=new Ko;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Ko,t.enqueueRetryable((()=>r(this.currentUser)))};const s=()=>{const e=i;t.enqueueRetryable((async()=>{await e.promise,await r(this.currentUser)}))},o=t=>{Lo("FirebaseCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit((t=>o(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(Lo("FirebaseCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Ko)}}),0),s()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(Lo("FirebaseCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(Vo("string"==typeof e.accessToken),new zo(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return Vo(null===t||"string"==typeof t),new Co(t)}}class $o{constructor(t,e,n){this.h=t,this.l=e,this.m=n,this.type="FirstParty",this.user=Co.FIRST_PARTY}get authHeaders(){const t={"X-Goog-AuthUser":this.l},e=this.h.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),this.m&&(t["X-Goog-Iam-Authorization-Token"]=this.m),t}}class Wo{constructor(t,e,n){this.h=t,this.l=e,this.m=n}getToken(){return Promise.resolve(new $o(this.h,this.l,this.m))}start(t,e){t.enqueueRetryable((()=>e(Co.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Qo{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.g(t),this.p=t=>e.writeSequenceNumber(t))}g(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.p&&this.p(t),t}}function Yo(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}Qo.T=-1;class Xo{static I(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length;let n="";for(;n.length<20;){const r=Yo(40);for(let i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length))}return n}}function Jo(t,e){return t<e?-1:t>e?1:0}function Zo(t,e,n){return t.length===e.length&&t.every(((t,r)=>n(t,e[r])))}function ta(t){return t+"\0"}class ea{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Bo(qo.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Bo(qo.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Bo(qo.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Bo(qo.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return ea.fromMillis(Date.now())}static fromDate(t){return ea.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new ea(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?Jo(this.nanoseconds,t.nanoseconds):Jo(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class na{constructor(t){this.timestamp=t}static fromTimestamp(t){return new na(t)}static min(){return new na(new ea(0,0))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function ra(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function ia(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function sa(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class oa{constructor(t,e,n){void 0===e?e=0:e>t.length&&Uo(),void 0===n?n=t.length-e:n>t.length-e&&Uo(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===oa.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof oa?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const n=t.get(r),i=e.get(r);if(n<i)return-1;if(n>i)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class aa extends oa{construct(t,e,n){return new aa(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new Bo(qo.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new aa(e)}static emptyPath(){return new aa([])}}const ca=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ua extends oa{construct(t,e,n){return new ua(t,e,n)}static isValidIdentifier(t){return ca.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ua.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new ua(["__name__"])}static fromServerFormat(t){const e=[];let n="",r=0;const i=()=>{if(0===n.length)throw new Bo(qo.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let s=!1;for(;r<t.length;){const e=t[r];if("\\"===e){if(r+1===t.length)throw new Bo(qo.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[r+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new Bo(qo.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,r+=2}else"`"===e?(s=!s,r++):"."!==e||s?(n+=e,r++):(i(),r++)}if(i(),s)throw new Bo(qo.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new ua(e)}static emptyPath(){return new ua([])}}class ha{constructor(t){this.fields=t,t.sort(ua.comparator)}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Zo(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}class la{constructor(t){this.binaryString=t}static fromBase64String(t){const e=atob(t);return new la(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new la(e)}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return Jo(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}la.EMPTY_BYTE_STRING=new la("");const da=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function fa(t){if(Vo(!!t),"string"==typeof t){let e=0;const n=da.exec(t);if(Vo(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:pa(t.seconds),nanos:pa(t.nanos)}}function pa(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function ma(t){return"string"==typeof t?la.fromBase64String(t):la.fromUint8Array(t)}function ga(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function ya(t){const e=t.mapValue.fields.__previous_value__;return ga(e)?ya(e):e}function va(t){const e=fa(t.mapValue.fields.__local_write_time__.timestampValue);return new ea(e.seconds,e.nanos)}function wa(t){return null==t}function Ia(t){return 0===t&&1/t==-1/0}class ba{constructor(t){this.path=t}static fromPath(t){return new ba(aa.fromString(t))}static fromName(t){return new ba(aa.fromString(t).popFirst(5))}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}isEqual(t){return null!==t&&0===aa.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return aa.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new ba(new aa(t.slice()))}}function Ta(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?ga(t)?4:10:Uo()}function Ea(t,e){const n=Ta(t);if(n!==Ta(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return va(t).isEqual(va(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=fa(t.timestampValue),r=fa(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return ma(t.bytesValue).isEqual(ma(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return pa(t.geoPointValue.latitude)===pa(e.geoPointValue.latitude)&&pa(t.geoPointValue.longitude)===pa(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return pa(t.integerValue)===pa(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=pa(t.doubleValue),r=pa(e.doubleValue);return n===r?Ia(n)===Ia(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return Zo(t.arrayValue.values||[],e.arrayValue.values||[],Ea);case 10:return function(t,e){const n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(ra(n)!==ra(r))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===r[t]||!Ea(n[t],r[t])))return!1;return!0}(t,e);default:return Uo()}}function Sa(t,e){return void 0!==(t.values||[]).find((t=>Ea(t,e)))}function _a(t,e){const n=Ta(t),r=Ta(e);if(n!==r)return Jo(n,r);switch(n){case 0:return 0;case 1:return Jo(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=pa(t.integerValue||t.doubleValue),r=pa(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return ka(t.timestampValue,e.timestampValue);case 4:return ka(va(t),va(e));case 5:return Jo(t.stringValue,e.stringValue);case 6:return function(t,e){const n=ma(t),r=ma(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),r=e.split("/");for(let t=0;t<n.length&&t<r.length;t++){const e=Jo(n[t],r[t]);if(0!==e)return e}return Jo(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=Jo(pa(t.latitude),pa(e.latitude));return 0!==n?n:Jo(pa(t.longitude),pa(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],r=e.values||[];for(let t=0;t<n.length&&t<r.length;++t){const e=_a(n[t],r[t]);if(e)return e}return Jo(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){const n=t.fields||{},r=Object.keys(n),i=e.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let t=0;t<r.length&&t<s.length;++t){const e=Jo(r[t],s[t]);if(0!==e)return e;const o=_a(n[r[t]],i[s[t]]);if(0!==o)return o}return Jo(r.length,s.length)}(t.mapValue,e.mapValue);default:throw Uo()}}function ka(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Jo(t,e);const n=fa(t),r=fa(e),i=Jo(n.seconds,r.seconds);return 0!==i?i:Jo(n.nanos,r.nanos)}function Na(t){return Aa(t)}function Aa(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=fa(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?ma(t.bytesValue).toBase64():"referenceValue"in t?(n=t.referenceValue,ba.fromName(n).toString()):"geoPointValue"in t?`geo(${(e=t.geoPointValue).latitude},${e.longitude})`:"arrayValue"in t?function(t){let e="[",n=!0;for(const r of t.values||[])n?n=!1:e+=",",e+=Aa(r);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",r=!0;for(const i of e)r?r=!1:n+=",",n+=`${i}:${Aa(t.fields[i])}`;return n+"}"}(t.mapValue):Uo();var e,n}function Da(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function Ca(t){return!!t&&"integerValue"in t}function Ra(t){return!!t&&"arrayValue"in t}function xa(t){return!!t&&"nullValue"in t}function Oa(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function La(t){return!!t&&"mapValue"in t}function Pa(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return ia(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=Pa(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Pa(t.arrayValue.values[n]);return e}return Object.assign({},t)}class Ma{constructor(t){this.value=t}static empty(){return new Ma({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!La(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Pa(e)}setAll(t){let e=ua.emptyPath(),n={},r=[];t.forEach(((t,i)=>{if(!e.isImmediateParentOf(i)){const t=this.getFieldsMap(e);this.applyChanges(t,n,r),n={},r=[],e=i.popLast()}t?n[i.lastSegment()]=Pa(t):r.push(i.lastSegment())}));const i=this.getFieldsMap(e);this.applyChanges(i,n,r)}delete(t){const e=this.field(t.popLast());La(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Ea(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let r=e.mapValue.fields[t.get(n)];La(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields}applyChanges(t,e,n){ia(e,((e,n)=>t[e]=n));for(const e of n)delete t[e]}clone(){return new Ma(Pa(this.value))}}function Fa(t){const e=[];return ia(t.fields,((t,n)=>{const r=new ua([t]);if(La(n)){const t=Fa(n.mapValue).fields;if(0===t.length)e.push(r);else for(const n of t)e.push(r.child(n))}else e.push(r)})),new ha(e)}class Ua{constructor(t,e,n,r,i){this.key=t,this.documentType=e,this.version=n,this.data=r,this.documentState=i}static newInvalidDocument(t){return new Ua(t,0,na.min(),Ma.empty(),0)}static newFoundDocument(t,e,n){return new Ua(t,1,e,n,0)}static newNoDocument(t,e){return new Ua(t,2,e,Ma.empty(),0)}static newUnknownDocument(t,e){return new Ua(t,3,e,Ma.empty(),2)}convertToFoundDocument(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Ma.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Ma.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof Ua&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}clone(){return new Ua(this.key,this.documentType,this.version,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Va{constructor(t,e=null,n=[],r=[],i=null,s=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.A=null}}function ja(t,e=null,n=[],r=[],i=null,s=null,o=null){return new Va(t,e,n,r,i,s,o)}function qa(t){const e=jo(t);if(null===e.A){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>function(t){return t.field.canonicalString()+t.op.toString()+Na(t.value)}(t))).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),wa(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=tc(e.startAt)),e.endAt&&(t+="|ub:",t+=tc(e.endAt)),e.A=t}return e.A}function Ba(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!nc(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let i=0;i<t.filters.length;i++)if(n=t.filters[i],r=e.filters[i],n.op!==r.op||!n.field.isEqual(r.field)||!Ea(n.value,r.value))return!1;var n,r;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!ic(t.startAt,e.startAt)&&ic(t.endAt,e.endAt)}function Ka(t){return ba.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class za extends class{}{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.R(t,e,n):new Ha(t,e,n):"array-contains"===e?new Qa(t,n):"in"===e?new Ya(t,n):"not-in"===e?new Xa(t,n):"array-contains-any"===e?new Ja(t,n):new za(t,e,n)}static R(t,e,n){return"in"===e?new Ga(t,n):new $a(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.P(_a(e,this.value)):null!==e&&Ta(this.value)===Ta(e)&&this.P(_a(e,this.value))}P(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Uo()}}v(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class Ha extends za{constructor(t,e,n){super(t,e,n),this.key=ba.fromName(n.referenceValue)}matches(t){const e=ba.comparator(t.key,this.key);return this.P(e)}}class Ga extends za{constructor(t,e){super(t,"in",e),this.keys=Wa(0,e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class $a extends za{constructor(t,e){super(t,"not-in",e),this.keys=Wa(0,e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function Wa(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>ba.fromName(t.referenceValue)))}class Qa extends za{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return Ra(e)&&Sa(e.arrayValue,this.value)}}class Ya extends za{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&Sa(this.value.arrayValue,e)}}class Xa extends za{constructor(t,e){super(t,"not-in",e)}matches(t){if(Sa(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!Sa(this.value.arrayValue,e)}}class Ja extends za{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!Ra(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>Sa(this.value.arrayValue,t)))}}class Za{constructor(t,e){this.position=t,this.before=e}}function tc(t){return`${t.before?"b":"a"}:${t.position.map((t=>Na(t))).join(",")}`}class ec{constructor(t,e="asc"){this.field=t,this.dir=e}}function nc(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function rc(t,e,n){let r=0;for(let i=0;i<t.position.length;i++){const s=e[i],o=t.position[i];if(r=s.field.isKeyField()?ba.comparator(ba.fromName(o.referenceValue),n.key):_a(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function ic(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Ea(t.position[n],e.position[n]))return!1;return!0}class sc{constructor(t,e=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.V=null,this.S=null,this.startAt,this.endAt}}function oc(t){return new sc(t)}function ac(t){return!wa(t.limit)&&"F"===t.limitType}function cc(t){return!wa(t.limit)&&"L"===t.limitType}function uc(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function hc(t){for(const e of t.filters)if(e.v())return e.field;return null}function lc(t){return null!==t.collectionGroup}function dc(t){const e=jo(t);if(null===e.V){e.V=[];const t=hc(e),n=uc(e);if(null!==t&&null===n)t.isKeyField()||e.V.push(new ec(t)),e.V.push(new ec(ua.keyField(),"asc"));else{let t=!1;for(const n of e.explicitOrderBy)e.V.push(n),n.field.isKeyField()&&(t=!0);if(!t){const t=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.V.push(new ec(ua.keyField(),t))}}}return e.V}function fc(t){const e=jo(t);if(!e.S)if("F"===e.limitType)e.S=ja(e.path,e.collectionGroup,dc(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const n of dc(e)){const e="desc"===n.dir?"asc":"desc";t.push(new ec(n.field,e))}const n=e.endAt?new Za(e.endAt.position,!e.endAt.before):null,r=e.startAt?new Za(e.startAt.position,!e.startAt.before):null;e.S=ja(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}return e.S}function pc(t,e){return Ba(fc(t),fc(e))&&t.limitType===e.limitType}function mc(t){return`${qa(fc(t))}|lt:${t.limitType}`}function gc(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>{return`${(e=t).field.canonicalString()} ${e.op} ${Na(e.value)}`;var e})).join(", ")}]`),wa(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t))).join(", ")}]`),t.startAt&&(e+=", startAt: "+tc(t.startAt)),t.endAt&&(e+=", endAt: "+tc(t.endAt)),`Target(${e})`}(fc(t))}; limitType=${t.limitType})`}function yc(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):ba.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of t.explicitOrderBy)if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!rc(t.startAt,dc(t),e)||t.endAt&&rc(t.endAt,dc(t),e))}(t,e)}function vc(t){return(e,n)=>{let r=!1;for(const i of dc(t)){const t=wc(i,e,n);if(0!==t)return t;r=r||i.field.isKeyField()}return 0}}function wc(t,e,n){const r=t.field.isKeyField()?ba.comparator(e.key,n.key):function(t,e,n){const r=e.data.field(t),i=n.data.field(t);return null!==r&&null!==i?_a(r,i):Uo()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Uo()}}function Ic(t,e){if(t.D){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ia(e)?"-0":e}}function bc(t){return{integerValue:""+t}}function Tc(t,e){return function(t){return"number"==typeof t&&Number.isInteger(t)&&!Ia(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}(e)?bc(e):Ic(t,e)}class Ec{constructor(){this._=void 0}}function Sc(t,e,n){return t instanceof Nc?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Ac?Dc(t,e):t instanceof Cc?Rc(t,e):function(t,e){const n=kc(t,e),r=Oc(n)+Oc(t.C);return Ca(n)&&Ca(t.C)?bc(r):Ic(t.N,r)}(t,e)}function _c(t,e,n){return t instanceof Ac?Dc(t,e):t instanceof Cc?Rc(t,e):n}function kc(t,e){return t instanceof xc?Ca(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}class Nc extends Ec{}class Ac extends Ec{constructor(t){super(),this.elements=t}}function Dc(t,e){const n=Lc(e);for(const e of t.elements)n.some((t=>Ea(t,e)))||n.push(e);return{arrayValue:{values:n}}}class Cc extends Ec{constructor(t){super(),this.elements=t}}function Rc(t,e){let n=Lc(e);for(const e of t.elements)n=n.filter((t=>!Ea(t,e)));return{arrayValue:{values:n}}}class xc extends Ec{constructor(t,e){super(),this.N=t,this.C=e}}function Oc(t){return pa(t.integerValue||t.doubleValue)}function Lc(t){return Ra(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class Pc{constructor(t,e){this.field=t,this.transform=e}}class Mc{constructor(t,e){this.version=t,this.transformResults=e}}class Fc{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new Fc}static exists(t){return new Fc(void 0,t)}static updateTime(t){return new Fc(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Uc(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class Vc{}function jc(t,e,n){t instanceof Hc?function(t,e,n){const r=t.value.clone(),i=Wc(t.fieldTransforms,e,n.transformResults);r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof Gc?function(t,e,n){if(!Uc(t.precondition,e))return void e.convertToUnknownDocument(n.version);const r=Wc(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll($c(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function qc(t,e,n){t instanceof Hc?function(t,e,n){if(!Uc(t.precondition,e))return;const r=t.value.clone(),i=Qc(t.fieldTransforms,n,e);r.setAll(i),e.convertToFoundDocument(zc(e),r).setHasLocalMutations()}(t,e,n):t instanceof Gc?function(t,e,n){if(!Uc(t.precondition,e))return;const r=Qc(t.fieldTransforms,n,e),i=e.data;i.setAll($c(t)),i.setAll(r),e.convertToFoundDocument(zc(e),i).setHasLocalMutations()}(t,e,n):function(t,e){Uc(t.precondition,e)&&e.convertToNoDocument(na.min())}(t,e)}function Bc(t,e){let n=null;for(const r of t.fieldTransforms){const t=e.data.field(r.field),i=kc(r.transform,t||null);null!=i&&(null==n&&(n=Ma.empty()),n.set(r.field,i))}return n||null}function Kc(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&Zo(t,e,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Ac&&e instanceof Ac||t instanceof Cc&&e instanceof Cc?Zo(t.elements,e.elements,Ea):t instanceof xc&&e instanceof xc?Ea(t.C,e.C):t instanceof Nc&&e instanceof Nc}(t.transform,e.transform)}(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}function zc(t){return t.isFoundDocument()?t.version:na.min()}class Hc extends Vc{constructor(t,e,n,r=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=r,this.type=0}}class Gc extends Vc{constructor(t,e,n,r,i=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}}function $c(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}})),e}function Wc(t,e,n){const r=new Map;Vo(t.length===n.length);for(let i=0;i<n.length;i++){const s=t[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,_c(o,a,n[i]))}return r}function Qc(t,e,n){const r=new Map;for(const i of t){const t=i.transform,s=n.data.field(i.field);r.set(i.field,Sc(t,s,e))}return r}class Yc extends Vc{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}}class Xc extends Vc{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}}class Jc{constructor(t){this.count=t}}var Zc,tu;function eu(t){if(void 0===t)return Po("GRPC error has no .code"),qo.UNKNOWN;switch(t){case Zc.OK:return qo.OK;case Zc.CANCELLED:return qo.CANCELLED;case Zc.UNKNOWN:return qo.UNKNOWN;case Zc.DEADLINE_EXCEEDED:return qo.DEADLINE_EXCEEDED;case Zc.RESOURCE_EXHAUSTED:return qo.RESOURCE_EXHAUSTED;case Zc.INTERNAL:return qo.INTERNAL;case Zc.UNAVAILABLE:return qo.UNAVAILABLE;case Zc.UNAUTHENTICATED:return qo.UNAUTHENTICATED;case Zc.INVALID_ARGUMENT:return qo.INVALID_ARGUMENT;case Zc.NOT_FOUND:return qo.NOT_FOUND;case Zc.ALREADY_EXISTS:return qo.ALREADY_EXISTS;case Zc.PERMISSION_DENIED:return qo.PERMISSION_DENIED;case Zc.FAILED_PRECONDITION:return qo.FAILED_PRECONDITION;case Zc.ABORTED:return qo.ABORTED;case Zc.OUT_OF_RANGE:return qo.OUT_OF_RANGE;case Zc.UNIMPLEMENTED:return qo.UNIMPLEMENTED;case Zc.DATA_LOSS:return qo.DATA_LOSS;default:return Uo()}}(tu=Zc||(Zc={}))[tu.OK=0]="OK",tu[tu.CANCELLED=1]="CANCELLED",tu[tu.UNKNOWN=2]="UNKNOWN",tu[tu.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",tu[tu.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",tu[tu.NOT_FOUND=5]="NOT_FOUND",tu[tu.ALREADY_EXISTS=6]="ALREADY_EXISTS",tu[tu.PERMISSION_DENIED=7]="PERMISSION_DENIED",tu[tu.UNAUTHENTICATED=16]="UNAUTHENTICATED",tu[tu.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",tu[tu.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",tu[tu.ABORTED=10]="ABORTED",tu[tu.OUT_OF_RANGE=11]="OUT_OF_RANGE",tu[tu.UNIMPLEMENTED=12]="UNIMPLEMENTED",tu[tu.INTERNAL=13]="INTERNAL",tu[tu.UNAVAILABLE=14]="UNAVAILABLE",tu[tu.DATA_LOSS=15]="DATA_LOSS";class nu{constructor(t,e){this.comparator=t,this.root=e||iu.EMPTY}insert(t,e){return new nu(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,iu.BLACK,null,null))}remove(t){return new nu(this.comparator,this.root.remove(t,this.comparator).copy(null,null,iu.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new ru(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new ru(this.root,t,this.comparator,!1)}getReverseIterator(){return new ru(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new ru(this.root,t,this.comparator,!0)}}class ru{constructor(t,e,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class iu{constructor(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:iu.RED,this.left=null!=r?r:iu.EMPTY,this.right=null!=i?i:iu.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,r,i){return new iu(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let r=this;const i=n(t,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return iu.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return iu.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,iu.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,iu.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Uo();if(this.right.isRed())throw Uo();const t=this.left.check();if(t!==this.right.check())throw Uo();return t+(this.isRed()?0:1)}}iu.EMPTY=null,iu.RED=!0,iu.BLACK=!1,iu.EMPTY=new class{constructor(){this.size=0}get key(){throw Uo()}get value(){throw Uo()}get color(){throw Uo()}get left(){throw Uo()}get right(){throw Uo()}copy(t,e,n,r,i){return this}insert(t,e,n){return new iu(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class su{constructor(t){this.comparator=t,this.data=new nu(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new ou(this.data.getIterator())}getIteratorFrom(t){return new ou(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof su))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(0!==this.comparator(t,r))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new su(this.comparator);return e.data=t,e}}class ou{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}const au=new nu(ba.comparator);function cu(){return au}const uu=new nu(ba.comparator);function hu(){return uu}const lu=new nu(ba.comparator);const du=new su(ba.comparator);function fu(...t){let e=du;for(const n of t)e=e.add(n);return e}const pu=new su(Jo);function mu(){return pu}class gu{constructor(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(t,e){const n=new Map;return n.set(t,yu.createSynthesizedTargetChangeForCurrentChange(t,e)),new gu(na.min(),n,mu(),cu(),fu())}}class yu{constructor(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(t,e){return new yu(la.EMPTY_BYTE_STRING,e,fu(),fu(),fu())}}class vu{constructor(t,e,n,r){this.k=t,this.removedTargetIds=e,this.key=n,this.$=r}}class wu{constructor(t,e){this.targetId=t,this.O=e}}class Iu{constructor(t,e,n=la.EMPTY_BYTE_STRING,r=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}}class bu{constructor(){this.F=0,this.M=Su(),this.L=la.EMPTY_BYTE_STRING,this.B=!1,this.U=!0}get current(){return this.B}get resumeToken(){return this.L}get q(){return 0!==this.F}get K(){return this.U}j(t){t.approximateByteSize()>0&&(this.U=!0,this.L=t)}W(){let t=fu(),e=fu(),n=fu();return this.M.forEach(((r,i)=>{switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:Uo()}})),new yu(this.L,this.B,t,e,n)}G(){this.U=!1,this.M=Su()}H(t,e){this.U=!0,this.M=this.M.insert(t,e)}J(t){this.U=!0,this.M=this.M.remove(t)}Y(){this.F+=1}X(){this.F-=1}Z(){this.U=!0,this.B=!0}}class Tu{constructor(t){this.tt=t,this.et=new Map,this.nt=cu(),this.st=Eu(),this.it=new su(Jo)}rt(t){for(const e of t.k)t.$&&t.$.isFoundDocument()?this.ot(e,t.$):this.at(e,t.key,t.$);for(const e of t.removedTargetIds)this.at(e,t.key,t.$)}ct(t){this.forEachTarget(t,(e=>{const n=this.ut(e);switch(t.state){case 0:this.ht(e)&&n.j(t.resumeToken);break;case 1:n.X(),n.q||n.G(),n.j(t.resumeToken);break;case 2:n.X(),n.q||this.removeTarget(e);break;case 3:this.ht(e)&&(n.Z(),n.j(t.resumeToken));break;case 4:this.ht(e)&&(this.lt(e),n.j(t.resumeToken));break;default:Uo()}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.et.forEach(((t,n)=>{this.ht(n)&&e(n)}))}ft(t){const e=t.targetId,n=t.O.count,r=this.dt(e);if(r){const t=r.target;if(Ka(t))if(0===n){const n=new ba(t.path);this.at(e,n,Ua.newNoDocument(n,na.min()))}else Vo(1===n);else this.wt(e)!==n&&(this.lt(e),this.it=this.it.add(e))}}_t(t){const e=new Map;this.et.forEach(((n,r)=>{const i=this.dt(r);if(i){if(n.current&&Ka(i.target)){const e=new ba(i.target.path);null!==this.nt.get(e)||this.gt(r,e)||this.at(r,e,Ua.newNoDocument(e,t))}n.K&&(e.set(r,n.W()),n.G())}}));let n=fu();this.st.forEach(((t,e)=>{let r=!0;e.forEachWhile((t=>{const e=this.dt(t);return!e||2===e.purpose||(r=!1,!1)})),r&&(n=n.add(t))}));const r=new gu(t,e,this.it,this.nt,n);return this.nt=cu(),this.st=Eu(),this.it=new su(Jo),r}ot(t,e){if(!this.ht(t))return;const n=this.gt(t,e.key)?2:0;this.ut(t).H(e.key,n),this.nt=this.nt.insert(e.key,e),this.st=this.st.insert(e.key,this.yt(e.key).add(t))}at(t,e,n){if(!this.ht(t))return;const r=this.ut(t);this.gt(t,e)?r.H(e,1):r.J(e),this.st=this.st.insert(e,this.yt(e).delete(t)),n&&(this.nt=this.nt.insert(e,n))}removeTarget(t){this.et.delete(t)}wt(t){const e=this.ut(t).W();return this.tt.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Y(t){this.ut(t).Y()}ut(t){let e=this.et.get(t);return e||(e=new bu,this.et.set(t,e)),e}yt(t){let e=this.st.get(t);return e||(e=new su(Jo),this.st=this.st.insert(t,e)),e}ht(t){const e=null!==this.dt(t);return e||Lo("WatchChangeAggregator","Detected inactive target",t),e}dt(t){const e=this.et.get(t);return e&&e.q?null:this.tt.Et(t)}lt(t){this.et.set(t,new bu),this.tt.getRemoteKeysForTarget(t).forEach((e=>{this.at(t,e,null)}))}gt(t,e){return this.tt.getRemoteKeysForTarget(t).has(e)}}function Eu(){return new nu(ba.comparator)}function Su(){return new nu(ba.comparator)}const _u={asc:"ASCENDING",desc:"DESCENDING"},ku={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class Nu{constructor(t,e){this.databaseId=t,this.D=e}}function Au(t,e){return t.D?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Du(t,e){return t.D?e.toBase64():e.toUint8Array()}function Cu(t,e){return Au(t,e.toTimestamp())}function Ru(t){return Vo(!!t),na.fromTimestamp(function(t){const e=fa(t);return new ea(e.seconds,e.nanos)}(t))}function xu(t,e){return function(t){return new aa(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function Ou(t){const e=aa.fromString(t);return Vo(nh(e)),e}function Lu(t,e){return xu(t.databaseId,e.path)}function Pu(t,e){const n=Ou(e);if(n.get(1)!==t.databaseId.projectId)throw new Bo(qo.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Bo(qo.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new ba(Vu(n))}function Mu(t,e){return xu(t.databaseId,e)}function Fu(t){const e=Ou(t);return 4===e.length?aa.emptyPath():Vu(e)}function Uu(t){return new aa(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Vu(t){return Vo(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function ju(t,e,n){return{name:Lu(t,e),fields:n.value.mapValue.fields}}function qu(t,e){let n;if(e instanceof Hc)n={update:ju(t,e.key,e.value)};else if(e instanceof Yc)n={delete:Lu(t,e.key)};else if(e instanceof Gc)n={update:ju(t,e.key,e.data),updateMask:eh(e.fieldMask)};else{if(!(e instanceof Xc))return Uo();n={verify:Lu(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((t=>function(t,e){const n=e.transform;if(n instanceof Nc)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Ac)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Cc)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof xc)return{fieldPath:e.field.canonicalString(),increment:n.C};throw Uo()}(0,t)))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:Cu(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:Uo()}(t,e.precondition)),n}function Bu(t,e){const n=e.currentDocument?function(t){return void 0!==t.updateTime?Fc.updateTime(Ru(t.updateTime)):void 0!==t.exists?Fc.exists(t.exists):Fc.none()}(e.currentDocument):Fc.none(),r=e.updateTransforms?e.updateTransforms.map((e=>function(t,e){let n=null;if("setToServerValue"in e)Vo("REQUEST_TIME"===e.setToServerValue),n=new Nc;else if("appendMissingElements"in e){const t=e.appendMissingElements.values||[];n=new Ac(t)}else if("removeAllFromArray"in e){const t=e.removeAllFromArray.values||[];n=new Cc(t)}else"increment"in e?n=new xc(t,e.increment):Uo();const r=ua.fromServerFormat(e.fieldPath);return new Pc(r,n)}(t,e))):[];if(e.update){e.update.name;const i=Pu(t,e.update.name),s=new Ma({mapValue:{fields:e.update.fields}});if(e.updateMask){const t=function(t){const e=t.fieldPaths||[];return new ha(e.map((t=>ua.fromServerFormat(t))))}(e.updateMask);return new Gc(i,s,t,n,r)}return new Hc(i,s,n,r)}if(e.delete){const r=Pu(t,e.delete);return new Yc(r,n)}if(e.verify){const r=Pu(t,e.verify);return new Xc(r,n)}return Uo()}function Ku(t,e){return{documents:[Mu(t,e.path)]}}function zu(t,e){const n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=Mu(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Mu(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);const i=function(t){if(0===t.length)return;const e=t.map((t=>function(t){if("=="===t.op){if(Oa(t.value))return{unaryFilter:{field:Xu(t.field),op:"IS_NAN"}};if(xa(t.value))return{unaryFilter:{field:Xu(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Oa(t.value))return{unaryFilter:{field:Xu(t.field),op:"IS_NOT_NAN"}};if(xa(t.value))return{unaryFilter:{field:Xu(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Xu(t.field),op:Yu(t.op),value:t.value}}}(t)));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}(e.filters);i&&(n.structuredQuery.where=i);const s=function(t){if(0!==t.length)return t.map((t=>function(t){return{field:Xu(t.field),direction:Qu(t.dir)}}(t)))}(e.orderBy);s&&(n.structuredQuery.orderBy=s);const o=function(t,e){return t.D||wa(e)?e:{value:e}}(t,e.limit);return null!==o&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt=$u(e.startAt)),e.endAt&&(n.structuredQuery.endAt=$u(e.endAt)),n}function Hu(t){let e=Fu(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){Vo(1===r);const t=n.from[0];t.allDescendants?i=t.collectionId:e=e.child(t.collectionId)}let s=[];n.where&&(s=Gu(n.where));let o=[];n.orderBy&&(o=n.orderBy.map((t=>function(t){return new ec(Ju(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t))));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,wa(e)?null:e}(n.limit));let c=null;n.startAt&&(c=Wu(n.startAt));let u=null;return n.endAt&&(u=Wu(n.endAt)),function(t,e,n,r,i,s,o,a){return new sc(t,e,n,r,i,s,o,a)}(e,i,o,s,a,"F",c,u)}function Gu(t){return t?void 0!==t.unaryFilter?[th(t)]:void 0!==t.fieldFilter?[Zu(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map((t=>Gu(t))).reduce(((t,e)=>t.concat(e))):Uo():[]}function $u(t){return{before:t.before,values:t.position}}function Wu(t){const e=!!t.before,n=t.values||[];return new Za(n,e)}function Qu(t){return _u[t]}function Yu(t){return ku[t]}function Xu(t){return{fieldPath:t.canonicalString()}}function Ju(t){return ua.fromServerFormat(t.fieldPath)}function Zu(t){return za.create(Ju(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Uo()}}(t.fieldFilter.op),t.fieldFilter.value)}function th(t){switch(t.unaryFilter.op){case"IS_NAN":const e=Ju(t.unaryFilter.field);return za.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=Ju(t.unaryFilter.field);return za.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Ju(t.unaryFilter.field);return za.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Ju(t.unaryFilter.field);return za.create(i,"!=",{nullValue:"NULL_VALUE"});default:return Uo()}}function eh(t){const e=[];return t.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function nh(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}function rh(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=sh(e)),e=ih(t.get(n),e);return sh(e)}function ih(t,e){let n=e;const r=t.length;for(let e=0;e<r;e++){const r=t.charAt(e);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}function sh(t){return t+""}function oh(t){const e=t.length;if(Vo(e>=2),2===e)return Vo(""===t.charAt(0)&&""===t.charAt(1)),aa.emptyPath();const n=e-2,r=[];let i="";for(let s=0;s<e;){const e=t.indexOf("",s);switch((e<0||e>n)&&Uo(),t.charAt(e+1)){case"":const n=t.substring(s,e);let o;0===i.length?o=n:(i+=n,o=i,i=""),r.push(o);break;case"":i+=t.substring(s,e),i+="\0";break;case"":i+=t.substring(s,e+1);break;default:Uo()}s=e+2}return new aa(r)}class ah{constructor(t,e){this.seconds=t,this.nanoseconds=e}}class ch{constructor(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}}ch.store="owner",ch.key="owner";class uh{constructor(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}}uh.store="mutationQueues",uh.keyPath="userId";class hh{constructor(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}}hh.store="mutations",hh.keyPath="batchId",hh.userMutationsIndex="userMutationsIndex",hh.userMutationsKeyPath=["userId","batchId"];class lh{constructor(){}static prefixForUser(t){return[t]}static prefixForPath(t,e){return[t,rh(e)]}static key(t,e,n){return[t,rh(e),n]}}lh.store="documentMutations",lh.PLACEHOLDER=new lh;class dh{constructor(t,e){this.path=t,this.readTime=e}}class fh{constructor(t,e){this.path=t,this.version=e}}class ph{constructor(t,e,n,r,i,s){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=s}}ph.store="remoteDocuments",ph.readTimeIndex="readTimeIndex",ph.readTimeIndexPath="readTime",ph.collectionReadTimeIndex="collectionReadTimeIndex",ph.collectionReadTimeIndexPath=["parentPath","readTime"];class mh{constructor(t){this.byteSize=t}}mh.store="remoteDocumentGlobal",mh.key="remoteDocumentGlobalKey";class gh{constructor(t,e,n,r,i,s,o){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=s,this.query=o}}gh.store="targets",gh.keyPath="targetId",gh.queryTargetsIndexName="queryTargetsIndex",gh.queryTargetsKeyPath=["canonicalId","targetId"];class yh{constructor(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n}}yh.store="targetDocuments",yh.keyPath=["targetId","path"],yh.documentTargetsIndex="documentTargetsIndex",yh.documentTargetsKeyPath=["path","targetId"];class vh{constructor(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}}vh.key="targetGlobalKey",vh.store="targetGlobal";class wh{constructor(t,e){this.collectionId=t,this.parent=e}}wh.store="collectionParents",wh.keyPath=["collectionId","parent"];class Ih{constructor(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r}}Ih.store="clientMetadata",Ih.keyPath="clientId";class bh{constructor(t,e,n){this.bundleId=t,this.createTime=e,this.version=n}}bh.store="bundles",bh.keyPath="bundleId";class Th{constructor(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n}}Th.store="namedQueries",Th.keyPath="name";const Eh=[uh.store,hh.store,lh.store,ph.store,gh.store,ch.store,vh.store,yh.store,Ih.store,mh.store,wh.store,bh.store,Th.store],Sh="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class _h{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}class kh{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&Uo(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new kh(((n,r)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,r)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,r)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof kh?e:kh.resolve(e)}catch(t){return kh.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):kh.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):kh.reject(e)}static resolve(t){return new kh(((e,n)=>{e(t)}))}static reject(t){return new kh(((e,n)=>{n(t)}))}static waitFor(t){return new kh(((e,n)=>{let r=0,i=0,s=!1;t.forEach((t=>{++r,t.next((()=>{++i,s&&i===r&&e()}),(t=>n(t)))})),s=!0,i===r&&e()}))}static or(t){let e=kh.resolve(!1);for(const n of t)e=e.next((t=>t?kh.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,r)=>{n.push(e.call(this,t,r))})),this.waitFor(n)}}class Nh{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.Tt=new Ko,this.transaction.oncomplete=()=>{this.Tt.resolve()},this.transaction.onabort=()=>{e.error?this.Tt.reject(new Ch(t,e.error)):this.Tt.resolve()},this.transaction.onerror=e=>{const n=Ph(e.target.error);this.Tt.reject(new Ch(t,n))}}static open(t,e,n,r){try{return new Nh(e,t.transaction(r,n))}catch(t){throw new Ch(e,t)}}get It(){return this.Tt.promise}abort(t){t&&this.Tt.reject(t),this.aborted||(Lo("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}store(t){const e=this.transaction.objectStore(t);return new xh(e)}}class Ah{constructor(t,e,n){this.name=t,this.version=e,this.At=n,12.2===Ah.Rt(a())&&Po("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return Lo("SimpleDb","Removing database:",t),Oh(window.indexedDB.deleteDatabase(t)).toPromise()}static bt(){if("object"!=typeof indexedDB)return!1;if(Ah.Pt())return!0;const t=a(),e=Ah.Rt(t),n=0<e&&e<10,r=Ah.vt(t),i=0<r&&r<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||i)}static Pt(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Vt)}static St(t,e){return t.store(e)}static Rt(t){const e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static vt(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async Dt(t){return this.db||(Lo("SimpleDb","Opening database:",this.name),this.db=await new Promise(((e,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=t=>{const n=t.target.result;e(n)},r.onblocked=()=>{n(new Ch(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=e=>{const r=e.target.error;"VersionError"===r.name?n(new Bo(qo.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new Bo(qo.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new Ch(t,r))},r.onupgradeneeded=t=>{Lo("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',t.oldVersion);const e=t.target.result;this.At.Ct(e,r.transaction,t.oldVersion,this.version).next((()=>{Lo("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.Nt&&(this.db.onversionchange=t=>this.Nt(t)),this.db}xt(t){this.Nt=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(t,e,n,r){const i="readonly"===e;let s=0;for(;;){++s;try{this.db=await this.Dt(t);const e=Nh.open(this.db,t,i?"readonly":"readwrite",n),s=r(e).catch((t=>(e.abort(t),kh.reject(t)))).toPromise();return s.catch((()=>{})),await e.It,s}catch(t){const e="FirebaseError"!==t.name&&s<3;if(Lo("SimpleDb","Transaction failed with error:",t.message,"Retrying:",e),this.close(),!e)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class Dh{constructor(t){this.kt=t,this.$t=!1,this.Ot=null}get isDone(){return this.$t}get Ft(){return this.Ot}set cursor(t){this.kt=t}done(){this.$t=!0}Mt(t){this.Ot=t}delete(){return Oh(this.kt.delete())}}class Ch extends Bo{constructor(t,e){super(qo.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}}function Rh(t){return"IndexedDbTransactionError"===t.name}class xh{constructor(t){this.store=t}put(t,e){let n;return void 0!==e?(Lo("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(Lo("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),Oh(n)}add(t){return Lo("SimpleDb","ADD",this.store.name,t,t),Oh(this.store.add(t))}get(t){return Oh(this.store.get(t)).next((e=>(void 0===e&&(e=null),Lo("SimpleDb","GET",this.store.name,t,e),e)))}delete(t){return Lo("SimpleDb","DELETE",this.store.name,t),Oh(this.store.delete(t))}count(){return Lo("SimpleDb","COUNT",this.store.name),Oh(this.store.count())}Lt(t,e){const n=this.cursor(this.options(t,e)),r=[];return this.Bt(n,((t,e)=>{r.push(e)})).next((()=>r))}Ut(t,e){Lo("SimpleDb","DELETE ALL",this.store.name);const n=this.options(t,e);n.qt=!1;const r=this.cursor(n);return this.Bt(r,((t,e,n)=>n.delete()))}Kt(t,e){let n;e?n=t:(n={},e=t);const r=this.cursor(n);return this.Bt(r,e)}jt(t){const e=this.cursor({});return new kh(((n,r)=>{e.onerror=t=>{const e=Ph(t.target.error);r(e)},e.onsuccess=e=>{const r=e.target.result;r?t(r.primaryKey,r.value).next((t=>{t?r.continue():n()})):n()}}))}Bt(t,e){const n=[];return new kh(((r,i)=>{t.onerror=t=>{i(t.target.error)},t.onsuccess=t=>{const i=t.target.result;if(!i)return void r();const s=new Dh(i),o=e(i.primaryKey,i.value,s);if(o instanceof kh){const t=o.catch((t=>(s.done(),kh.reject(t))));n.push(t)}s.isDone?r():null===s.Ft?i.continue():i.continue(s.Ft)}})).next((()=>kh.waitFor(n)))}options(t,e){let n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){const n=this.store.index(t.index);return t.qt?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}}function Oh(t){return new kh(((e,n)=>{t.onsuccess=t=>{const n=t.target.result;e(n)},t.onerror=t=>{const e=Ph(t.target.error);n(e)}}))}let Lh=!1;function Ph(t){const e=Ah.Rt(a());if(e>=12.2&&e<13){const e="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(e)>=0){const t=new Bo("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Lh||(Lh=!0,setTimeout((()=>{throw t}),0)),t}}return t}class Mh extends _h{constructor(t,e){super(),this.Qt=t,this.currentSequenceNumber=e}}function Fh(t,e){const n=jo(t);return Ah.St(n.Qt,e)}class Uh{constructor(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const r=this.mutations[e];r.key.isEqual(t.key)&&jc(r,t,n[e])}}applyToLocalView(t){for(const e of this.baseMutations)e.key.isEqual(t.key)&&qc(e,t,this.localWriteTime);for(const e of this.mutations)e.key.isEqual(t.key)&&qc(e,t,this.localWriteTime)}applyToLocalDocumentSet(t){this.mutations.forEach((e=>{const n=t.get(e.key),r=n;this.applyToLocalView(r),n.isValidDocument()||r.convertToNoDocument(na.min())}))}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),fu())}isEqual(t){return this.batchId===t.batchId&&Zo(this.mutations,t.mutations,((t,e)=>Kc(t,e)))&&Zo(this.baseMutations,t.baseMutations,((t,e)=>Kc(t,e)))}}class Vh{constructor(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}static from(t,e,n){Vo(t.mutations.length===n.length);let r=lu;const i=t.mutations;for(let t=0;t<i.length;t++)r=r.insert(i[t].key,n[t].version);return new Vh(t,e,n,r)}}class jh{constructor(t,e,n,r,i=na.min(),s=na.min(),o=la.EMPTY_BYTE_STRING){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o}withSequenceNumber(t){return new jh(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(t,e){return new jh(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)}withLastLimboFreeSnapshotVersion(t){return new jh(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)}}class qh{constructor(t){this.Wt=t}}function Bh(t,e){if(e.document)return function(t,e,n){const r=Pu(t,e.name),i=Ru(e.updateTime),s=new Ma({mapValue:{fields:e.fields}}),o=Ua.newFoundDocument(r,i,s);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}(t.Wt,e.document,!!e.hasCommittedMutations);if(e.noDocument){const t=ba.fromSegments(e.noDocument.path),n=Gh(e.noDocument.readTime),r=Ua.newNoDocument(t,n);return e.hasCommittedMutations?r.setHasCommittedMutations():r}if(e.unknownDocument){const t=ba.fromSegments(e.unknownDocument.path),n=Gh(e.unknownDocument.version);return Ua.newUnknownDocument(t,n)}return Uo()}function Kh(t,e,n){const r=zh(n),i=e.key.path.popLast().toArray();if(e.isFoundDocument()){const n=function(t,e){return{name:Lu(t,e.key),fields:e.data.value.mapValue.fields,updateTime:Au(t,e.version.toTimestamp())}}(t.Wt,e),s=e.hasCommittedMutations;return new ph(null,null,n,s,r,i)}if(e.isNoDocument()){const t=e.key.path.toArray(),n=Hh(e.version),s=e.hasCommittedMutations;return new ph(null,new dh(t,n),null,s,r,i)}if(e.isUnknownDocument()){const t=e.key.path.toArray(),n=Hh(e.version);return new ph(new fh(t,n),null,null,!0,r,i)}return Uo()}function zh(t){const e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function Hh(t){const e=t.toTimestamp();return new ah(e.seconds,e.nanoseconds)}function Gh(t){const e=new ea(t.seconds,t.nanoseconds);return na.fromTimestamp(e)}function $h(t,e){const n=(e.baseMutations||[]).map((e=>Bu(t.Wt,e)));for(let t=0;t<e.mutations.length-1;++t){const n=e.mutations[t];if(t+1<e.mutations.length&&void 0!==e.mutations[t+1].transform){const r=e.mutations[t+1];n.updateTransforms=r.transform.fieldTransforms,e.mutations.splice(t+1,1),++t}}const r=e.mutations.map((e=>Bu(t.Wt,e))),i=ea.fromMillis(e.localWriteTimeMs);return new Uh(e.batchId,i,n,r)}function Wh(t){const e=Gh(t.readTime),n=void 0!==t.lastLimboFreeSnapshotVersion?Gh(t.lastLimboFreeSnapshotVersion):na.min();let r;var i;return void 0!==t.query.documents?(Vo(1===(i=t.query).documents.length),r=fc(oc(Fu(i.documents[0])))):r=function(t){return fc(Hu(t))}(t.query),new jh(r,t.targetId,0,t.lastListenSequenceNumber,e,n,la.fromBase64String(t.resumeToken))}function Qh(t,e){const n=Hh(e.snapshotVersion),r=Hh(e.lastLimboFreeSnapshotVersion);let i;i=Ka(e.target)?Ku(t.Wt,e.target):zu(t.Wt,e.target);const s=e.resumeToken.toBase64();return new gh(e.targetId,qa(e.target),n,s,e.sequenceNumber,r,i)}function Yh(t){const e=Hu({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?function(t,e,n){return new sc(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}(e,e.limit,"L"):e}class Xh{getBundleMetadata(t,e){return Jh(t).get(e).next((t=>{if(t)return{id:(e=t).bundleId,createTime:Gh(e.createTime),version:e.version};var e}))}saveBundleMetadata(t,e){return Jh(t).put({bundleId:(n=e).id,createTime:Hh(Ru(n.createTime)),version:n.version});var n}getNamedQuery(t,e){return Zh(t).get(e).next((t=>{if(t)return{name:(e=t).name,query:Yh(e.bundledQuery),readTime:Gh(e.readTime)};var e}))}saveNamedQuery(t,e){return Zh(t).put(function(t){return{name:t.name,readTime:Hh(Ru(t.readTime)),bundledQuery:t.bundledQuery}}(e))}}function Jh(t){return Fh(t,bh.store)}function Zh(t){return Fh(t,Th.store)}class tl{constructor(){this.Gt=new el}addToCollectionParentIndex(t,e){return this.Gt.add(e),kh.resolve()}getCollectionParents(t,e){return kh.resolve(this.Gt.getEntries(e))}}class el{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new su(aa.comparator),i=!r.has(n);return this.index[e]=r.add(n),i}has(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)}getEntries(t){return(this.index[t]||new su(aa.comparator)).toArray()}}class nl{constructor(){this.zt=new el}addToCollectionParentIndex(t,e){if(!this.zt.has(e)){const n=e.lastSegment(),r=e.popLast();t.addOnCommittedListener((()=>{this.zt.add(e)}));const i={collectionId:n,parent:rh(r)};return rl(t).put(i)}return kh.resolve()}getCollectionParents(t,e){const n=[],r=IDBKeyRange.bound([e,""],[ta(e),""],!1,!0);return rl(t).Lt(r).next((t=>{for(const r of t){if(r.collectionId!==e)break;n.push(oh(r.parent))}return n}))}}function rl(t){return Fh(t,wh.store)}const il={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class sl{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new sl(t,sl.DEFAULT_COLLECTION_PERCENTILE,sl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function ol(t,e,n){const r=t.store(hh.store),i=t.store(lh.store),s=[],o=IDBKeyRange.only(n.batchId);let a=0;const c=r.Kt({range:o},((t,e,n)=>(a++,n.delete())));s.push(c.next((()=>{Vo(1===a)})));const u=[];for(const t of n.mutations){const r=lh.key(e,t.key.path,n.batchId);s.push(i.delete(r)),u.push(t.key)}return kh.waitFor(s).next((()=>u))}function al(t){if(!t)return 0;let e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Uo();e=t.noDocument}return JSON.stringify(e).length}sl.DEFAULT_COLLECTION_PERCENTILE=10,sl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,sl.DEFAULT=new sl(41943040,sl.DEFAULT_COLLECTION_PERCENTILE,sl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),sl.DISABLED=new sl(-1,0,0);class cl{constructor(t,e,n,r){this.userId=t,this.N=e,this.Ht=n,this.referenceDelegate=r,this.Jt={}}static Yt(t,e,n,r){Vo(""!==t.uid);const i=t.isAuthenticated()?t.uid:"";return new cl(i,e,n,r)}checkEmpty(t){let e=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return hl(t).Kt({index:hh.userMutationsIndex,range:n},((t,n,r)=>{e=!1,r.done()})).next((()=>e))}addMutationBatch(t,e,n,r){const i=ll(t),s=hl(t);return s.add({}).next((o=>{Vo("number"==typeof o);const a=new Uh(o,e,n,r),c=function(t,e,n){const r=n.baseMutations.map((e=>qu(t.Wt,e))),i=n.mutations.map((e=>qu(t.Wt,e)));return new hh(e,n.batchId,n.localWriteTime.toMillis(),r,i)}(this.N,this.userId,a),u=[];let h=new su(((t,e)=>Jo(t.canonicalString(),e.canonicalString())));for(const t of r){const e=lh.key(this.userId,t.key.path,o);h=h.add(t.key.path.popLast()),u.push(s.put(c)),u.push(i.put(e,lh.PLACEHOLDER))}return h.forEach((e=>{u.push(this.Ht.addToCollectionParentIndex(t,e))})),t.addOnCommittedListener((()=>{this.Jt[o]=a.keys()})),kh.waitFor(u).next((()=>a))}))}lookupMutationBatch(t,e){return hl(t).get(e).next((t=>t?(Vo(t.userId===this.userId),$h(this.N,t)):null))}Xt(t,e){return this.Jt[e]?kh.resolve(this.Jt[e]):this.lookupMutationBatch(t,e).next((t=>{if(t){const n=t.keys();return this.Jt[e]=n,n}return null}))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,r=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return hl(t).Kt({index:hh.userMutationsIndex,range:r},((t,e,r)=>{e.userId===this.userId&&(Vo(e.batchId>=n),i=$h(this.N,e)),r.done()})).next((()=>i))}getHighestUnacknowledgedBatchId(t){const e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return hl(t).Kt({index:hh.userMutationsIndex,range:e,reverse:!0},((t,e,r)=>{n=e.batchId,r.done()})).next((()=>n))}getAllMutationBatches(t){const e=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return hl(t).Lt(hh.userMutationsIndex,e).next((t=>t.map((t=>$h(this.N,t)))))}getAllMutationBatchesAffectingDocumentKey(t,e){const n=lh.prefixForPath(this.userId,e.path),r=IDBKeyRange.lowerBound(n),i=[];return ll(t).Kt({range:r},((n,r,s)=>{const[o,a,c]=n,u=oh(a);if(o===this.userId&&e.path.isEqual(u))return hl(t).get(c).next((t=>{if(!t)throw Uo();Vo(t.userId===this.userId),i.push($h(this.N,t))}));s.done()})).next((()=>i))}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new su(Jo);const r=[];return e.forEach((e=>{const i=lh.prefixForPath(this.userId,e.path),s=IDBKeyRange.lowerBound(i),o=ll(t).Kt({range:s},((t,r,i)=>{const[s,o,a]=t,c=oh(o);s===this.userId&&e.path.isEqual(c)?n=n.add(a):i.done()}));r.push(o)})),kh.waitFor(r).next((()=>this.Zt(t,n)))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,r=n.length+1,i=lh.prefixForPath(this.userId,n),s=IDBKeyRange.lowerBound(i);let o=new su(Jo);return ll(t).Kt({range:s},((t,e,i)=>{const[s,a,c]=t,u=oh(a);s===this.userId&&n.isPrefixOf(u)?u.length===r&&(o=o.add(c)):i.done()})).next((()=>this.Zt(t,o)))}Zt(t,e){const n=[],r=[];return e.forEach((e=>{r.push(hl(t).get(e).next((t=>{if(null===t)throw Uo();Vo(t.userId===this.userId),n.push($h(this.N,t))})))})),kh.waitFor(r).next((()=>n))}removeMutationBatch(t,e){return ol(t.Qt,this.userId,e).next((n=>(t.addOnCommittedListener((()=>{this.te(e.batchId)})),kh.forEach(n,(e=>this.referenceDelegate.markPotentiallyOrphaned(t,e))))))}te(t){delete this.Jt[t]}performConsistencyCheck(t){return this.checkEmpty(t).next((e=>{if(!e)return kh.resolve();const n=IDBKeyRange.lowerBound(lh.prefixForUser(this.userId)),r=[];return ll(t).Kt({range:n},((t,e,n)=>{if(t[0]===this.userId){const e=oh(t[1]);r.push(e)}else n.done()})).next((()=>{Vo(0===r.length)}))}))}containsKey(t,e){return ul(t,this.userId,e)}ee(t){return dl(t).get(this.userId).next((t=>t||new uh(this.userId,-1,"")))}}function ul(t,e,n){const r=lh.prefixForPath(e,n.path),i=r[1],s=IDBKeyRange.lowerBound(r);let o=!1;return ll(t).Kt({range:s,qt:!0},((t,n,r)=>{const[s,a,c]=t;s===e&&a===i&&(o=!0),r.done()})).next((()=>o))}function hl(t){return Fh(t,hh.store)}function ll(t){return Fh(t,lh.store)}function dl(t){return Fh(t,uh.store)}class fl{constructor(t){this.ne=t}next(){return this.ne+=2,this.ne}static se(){return new fl(0)}static ie(){return new fl(-1)}}class pl{constructor(t,e){this.referenceDelegate=t,this.N=e}allocateTargetId(t){return this.re(t).next((e=>{const n=new fl(e.highestTargetId);return e.highestTargetId=n.next(),this.oe(t,e).next((()=>e.highestTargetId))}))}getLastRemoteSnapshotVersion(t){return this.re(t).next((t=>na.fromTimestamp(new ea(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(t){return this.re(t).next((t=>t.highestListenSequenceNumber))}setTargetsMetadata(t,e,n){return this.re(t).next((r=>(r.highestListenSequenceNumber=e,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),e>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=e),this.oe(t,r))))}addTargetData(t,e){return this.ae(t,e).next((()=>this.re(t).next((n=>(n.targetCount+=1,this.ce(e,n),this.oe(t,n))))))}updateTargetData(t,e){return this.ae(t,e)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next((()=>ml(t).delete(e.targetId))).next((()=>this.re(t))).next((e=>(Vo(e.targetCount>0),e.targetCount-=1,this.oe(t,e))))}removeTargets(t,e,n){let r=0;const i=[];return ml(t).Kt(((s,o)=>{const a=Wh(o);a.sequenceNumber<=e&&null===n.get(a.targetId)&&(r++,i.push(this.removeTargetData(t,a)))})).next((()=>kh.waitFor(i))).next((()=>r))}forEachTarget(t,e){return ml(t).Kt(((t,n)=>{const r=Wh(n);e(r)}))}re(t){return gl(t).get(vh.key).next((t=>(Vo(null!==t),t)))}oe(t,e){return gl(t).put(vh.key,e)}ae(t,e){return ml(t).put(Qh(this.N,e))}ce(t,e){let n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n}getTargetCount(t){return this.re(t).next((t=>t.targetCount))}getTargetData(t,e){const n=qa(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let i=null;return ml(t).Kt({range:r,index:gh.queryTargetsIndexName},((t,n,r)=>{const s=Wh(n);Ba(e,s.target)&&(i=s,r.done())})).next((()=>i))}addMatchingKeys(t,e,n){const r=[],i=yl(t);return e.forEach((e=>{const s=rh(e.path);r.push(i.put(new yh(n,s))),r.push(this.referenceDelegate.addReference(t,n,e))})),kh.waitFor(r)}removeMatchingKeys(t,e,n){const r=yl(t);return kh.forEach(e,(e=>{const i=rh(e.path);return kh.waitFor([r.delete([n,i]),this.referenceDelegate.removeReference(t,n,e)])}))}removeMatchingKeysForTargetId(t,e){const n=yl(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(t,e){const n=IDBKeyRange.bound([e],[e+1],!1,!0),r=yl(t);let i=fu();return r.Kt({range:n,qt:!0},((t,e,n)=>{const r=oh(t[1]),s=new ba(r);i=i.add(s)})).next((()=>i))}containsKey(t,e){const n=rh(e.path),r=IDBKeyRange.bound([n],[ta(n)],!1,!0);let i=0;return yl(t).Kt({index:yh.documentTargetsIndex,qt:!0,range:r},(([t,e],n,r)=>{0!==t&&(i++,r.done())})).next((()=>i>0))}Et(t,e){return ml(t).get(e).next((t=>t?Wh(t):null))}}function ml(t){return Fh(t,gh.store)}function gl(t){return Fh(t,vh.store)}function yl(t){return Fh(t,yh.store)}async function vl(t){if(t.code!==qo.FAILED_PRECONDITION||t.message!==Sh)throw t;Lo("LocalStore","Unexpectedly lost primary lease")}function wl([t,e],[n,r]){const i=Jo(t,n);return 0===i?Jo(e,r):i}class Il{constructor(t){this.ue=t,this.buffer=new su(wl),this.he=0}le(){return++this.he}fe(t){const e=[t,this.le()];if(this.buffer.size<this.ue)this.buffer=this.buffer.add(e);else{const t=this.buffer.last();wl(e,t)<0&&(this.buffer=this.buffer.delete(t).add(e))}}get maxValue(){return this.buffer.last()[0]}}class bl{constructor(t,e){this.garbageCollector=t,this.asyncQueue=e,this.de=!1,this.we=null}start(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this._e(t)}stop(){this.we&&(this.we.cancel(),this.we=null)}get started(){return null!==this.we}_e(t){const e=this.de?3e5:6e4;Lo("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.we=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.we=null,this.de=!0;try{await t.collectGarbage(this.garbageCollector)}catch(t){Rh(t)?Lo("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await vl(t)}await this._e(t)}))}}class Tl{constructor(t,e){this.me=t,this.params=e}calculateTargetCount(t,e){return this.me.ge(t).next((t=>Math.floor(e/100*t)))}nthSequenceNumber(t,e){if(0===e)return kh.resolve(Qo.T);const n=new Il(e);return this.me.forEachTarget(t,(t=>n.fe(t.sequenceNumber))).next((()=>this.me.ye(t,(t=>n.fe(t))))).next((()=>n.maxValue))}removeTargets(t,e,n){return this.me.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.me.removeOrphanedDocuments(t,e)}collect(t,e){return-1===this.params.cacheSizeCollectionThreshold?(Lo("LruGarbageCollector","Garbage collection skipped; disabled"),kh.resolve(il)):this.getCacheSize(t).next((n=>n<this.params.cacheSizeCollectionThreshold?(Lo("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),il):this.pe(t,e)))}getCacheSize(t){return this.me.getCacheSize(t)}pe(t,e){let n,r,i,s,o,a,c;const u=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((e=>(e>this.params.maximumSequenceNumbersToCollect?(Lo("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${e}`),r=this.params.maximumSequenceNumbersToCollect):r=e,s=Date.now(),this.nthSequenceNumber(t,r)))).next((r=>(n=r,o=Date.now(),this.removeTargets(t,n,e)))).next((e=>(i=e,a=Date.now(),this.removeOrphanedDocuments(t,n)))).next((t=>(c=Date.now(),Oo()<=A.DEBUG&&Lo("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${s-u}ms\n\tDetermined least recently used ${r} in `+(o-s)+"ms\n"+`\tRemoved ${i} targets in `+(a-o)+"ms\n"+`\tRemoved ${t} documents in `+(c-a)+"ms\n"+`Total Duration: ${c-u}ms`),kh.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t}))))}}class El{constructor(t,e){this.db=t,this.garbageCollector=function(t,e){return new Tl(t,e)}(this,e)}ge(t){const e=this.Ee(t);return this.db.getTargetCache().getTargetCount(t).next((t=>e.next((e=>t+e))))}Ee(t){let e=0;return this.ye(t,(t=>{e++})).next((()=>e))}forEachTarget(t,e){return this.db.getTargetCache().forEachTarget(t,e)}ye(t,e){return this.Te(t,((t,n)=>e(n)))}addReference(t,e,n){return Sl(t,n)}removeReference(t,e,n){return Sl(t,n)}removeTargets(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)}markPotentiallyOrphaned(t,e){return Sl(t,e)}Ie(t,e){return function(t,e){let n=!1;return dl(t).jt((r=>ul(t,r,e).next((t=>(t&&(n=!0),kh.resolve(!t)))))).next((()=>n))}(t,e)}removeOrphanedDocuments(t,e){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let i=0;return this.Te(t,((s,o)=>{if(o<=e){const e=this.Ie(t,s).next((e=>{if(!e)return i++,n.getEntry(t,s).next((()=>(n.removeEntry(s),yl(t).delete([0,rh(s.path)]))))}));r.push(e)}})).next((()=>kh.waitFor(r))).next((()=>n.apply(t))).next((()=>i))}removeTarget(t,e){const n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)}updateLimboDocument(t,e){return Sl(t,e)}Te(t,e){const n=yl(t);let r,i=Qo.T;return n.Kt({index:yh.documentTargetsIndex},(([t,n],{path:s,sequenceNumber:o})=>{0===t?(i!==Qo.T&&e(new ba(oh(r)),i),i=o,r=s):i=Qo.T})).next((()=>{i!==Qo.T&&e(new ba(oh(r)),i)}))}getCacheSize(t){return this.db.getRemoteDocumentCache().getSize(t)}}function Sl(t,e){return yl(t).put(function(t,e){return new yh(0,rh(t.path),e)}(e,t.currentSequenceNumber))}class _l{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,r]of n)if(this.equalsFn(e,t))return r}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],t))return void(r[n]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1}forEach(t){ia(this.inner,((e,n)=>{for(const[e,r]of n)t(e,r)}))}isEmpty(){return sa(this.inner)}}class kl{constructor(){this.changes=new _l((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}getReadTime(t){const e=this.changes.get(t);return e?e.readTime:na.min()}addEntry(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})}removeEntry(t,e=null){this.assertNotApplied(),this.changes.set(t,{document:Ua.newInvalidDocument(t),readTime:e})}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?kh.resolve(n.document):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class Nl{constructor(t,e){this.N=t,this.Ht=e}addEntry(t,e,n){return Cl(t).put(Rl(e),n)}removeEntry(t,e){const n=Cl(t),r=Rl(e);return n.delete(r)}updateMetadata(t,e){return this.getMetadata(t).next((n=>(n.byteSize+=e,this.Ae(t,n))))}getEntry(t,e){return Cl(t).get(Rl(e)).next((t=>this.Re(e,t)))}be(t,e){return Cl(t).get(Rl(e)).next((t=>({document:this.Re(e,t),size:al(t)})))}getEntries(t,e){let n=cu();return this.Pe(t,e,((t,e)=>{const r=this.Re(t,e);n=n.insert(t,r)})).next((()=>n))}ve(t,e){let n=cu(),r=new nu(ba.comparator);return this.Pe(t,e,((t,e)=>{const i=this.Re(t,e);n=n.insert(t,i),r=r.insert(t,al(e))})).next((()=>({documents:n,Ve:r})))}Pe(t,e,n){if(e.isEmpty())return kh.resolve();const r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator();let s=i.getNext();return Cl(t).Kt({range:r},((t,e,r)=>{const o=ba.fromSegments(t);for(;s&&ba.comparator(s,o)<0;)n(s,null),s=i.getNext();s&&s.isEqual(o)&&(n(s,e),s=i.hasNext()?i.getNext():null),s?r.Mt(s.path.toArray()):r.done()})).next((()=>{for(;s;)n(s,null),s=i.hasNext()?i.getNext():null}))}getDocumentsMatchingQuery(t,e,n){let r=cu();const i=e.path.length+1,s={};if(n.isEqual(na.min())){const t=e.path.toArray();s.range=IDBKeyRange.lowerBound(t)}else{const t=e.path.toArray(),r=zh(n);s.range=IDBKeyRange.lowerBound([t,r],!0),s.index=ph.collectionReadTimeIndex}return Cl(t).Kt(s,((t,n,s)=>{if(t.length!==i)return;const o=Bh(this.N,n);e.path.isPrefixOf(o.key.path)?yc(e,o)&&(r=r.insert(o.key,o)):s.done()})).next((()=>r))}newChangeBuffer(t){return new Al(this,!!t&&t.trackRemovals)}getSize(t){return this.getMetadata(t).next((t=>t.byteSize))}getMetadata(t){return Dl(t).get(mh.key).next((t=>(Vo(!!t),t)))}Ae(t,e){return Dl(t).put(mh.key,e)}Re(t,e){if(e){const t=Bh(this.N,e);if(!t.isNoDocument()||!t.version.isEqual(na.min()))return t}return Ua.newInvalidDocument(t)}}class Al extends kl{constructor(t,e){super(),this.Se=t,this.trackRemovals=e,this.De=new _l((t=>t.toString()),((t,e)=>t.isEqual(e)))}applyChanges(t){const e=[];let n=0,r=new su(((t,e)=>Jo(t.canonicalString(),e.canonicalString())));return this.changes.forEach(((i,s)=>{const o=this.De.get(i);if(s.document.isValidDocument()){const a=Kh(this.Se.N,s.document,this.getReadTime(i));r=r.add(i.path.popLast());const c=al(a);n+=c-o,e.push(this.Se.addEntry(t,i,a))}else if(n-=o,this.trackRemovals){const n=Kh(this.Se.N,Ua.newNoDocument(i,na.min()),this.getReadTime(i));e.push(this.Se.addEntry(t,i,n))}else e.push(this.Se.removeEntry(t,i))})),r.forEach((n=>{e.push(this.Se.Ht.addToCollectionParentIndex(t,n))})),e.push(this.Se.updateMetadata(t,n)),kh.waitFor(e)}getFromCache(t,e){return this.Se.be(t,e).next((t=>(this.De.set(e,t.size),t.document)))}getAllFromCache(t,e){return this.Se.ve(t,e).next((({documents:t,Ve:e})=>(e.forEach(((t,e)=>{this.De.set(t,e)})),t)))}}function Dl(t){return Fh(t,mh.store)}function Cl(t){return Fh(t,ph.store)}function Rl(t){return t.path.toArray()}class xl{constructor(t){this.N=t}Ct(t,e,n,r){Vo(n<r&&n>=0&&r<=11);const i=new Nh("createOrUpgrade",e);n<1&&r>=1&&(function(t){t.createObjectStore(ch.store)}(t),function(t){t.createObjectStore(uh.store,{keyPath:uh.keyPath}),t.createObjectStore(hh.store,{keyPath:hh.keyPath,autoIncrement:!0}).createIndex(hh.userMutationsIndex,hh.userMutationsKeyPath,{unique:!0}),t.createObjectStore(lh.store)}(t),Ol(t),function(t){t.createObjectStore(ph.store)}(t));let s=kh.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(yh.store),t.deleteObjectStore(gh.store),t.deleteObjectStore(vh.store)}(t),Ol(t)),s=s.next((()=>function(t){const e=t.store(vh.store),n=new vh(0,0,na.min().toTimestamp(),0);return e.put(vh.key,n)}(i)))),n<4&&r>=4&&(0!==n&&(s=s.next((()=>function(t,e){return e.store(hh.store).Lt().next((n=>{t.deleteObjectStore(hh.store),t.createObjectStore(hh.store,{keyPath:hh.keyPath,autoIncrement:!0}).createIndex(hh.userMutationsIndex,hh.userMutationsKeyPath,{unique:!0});const r=e.store(hh.store),i=n.map((t=>r.put(t)));return kh.waitFor(i)}))}(t,i)))),s=s.next((()=>{!function(t){t.createObjectStore(Ih.store,{keyPath:Ih.keyPath})}(t)}))),n<5&&r>=5&&(s=s.next((()=>this.Ce(i)))),n<6&&r>=6&&(s=s.next((()=>(function(t){t.createObjectStore(mh.store)}(t),this.Ne(i))))),n<7&&r>=7&&(s=s.next((()=>this.xe(i)))),n<8&&r>=8&&(s=s.next((()=>this.ke(t,i)))),n<9&&r>=9&&(s=s.next((()=>{!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){const e=t.objectStore(ph.store);e.createIndex(ph.readTimeIndex,ph.readTimeIndexPath,{unique:!1}),e.createIndex(ph.collectionReadTimeIndex,ph.collectionReadTimeIndexPath,{unique:!1})}(e)}))),n<10&&r>=10&&(s=s.next((()=>this.$e(i)))),n<11&&r>=11&&(s=s.next((()=>{!function(t){t.createObjectStore(bh.store,{keyPath:bh.keyPath})}(t),function(t){t.createObjectStore(Th.store,{keyPath:Th.keyPath})}(t)}))),s}Ne(t){let e=0;return t.store(ph.store).Kt(((t,n)=>{e+=al(n)})).next((()=>{const n=new mh(e);return t.store(mh.store).put(mh.key,n)}))}Ce(t){const e=t.store(uh.store),n=t.store(hh.store);return e.Lt().next((e=>kh.forEach(e,(e=>{const r=IDBKeyRange.bound([e.userId,-1],[e.userId,e.lastAcknowledgedBatchId]);return n.Lt(hh.userMutationsIndex,r).next((n=>kh.forEach(n,(n=>{Vo(n.userId===e.userId);const r=$h(this.N,n);return ol(t,e.userId,r).next((()=>{}))}))))}))))}xe(t){const e=t.store(yh.store),n=t.store(ph.store);return t.store(vh.store).get(vh.key).next((t=>{const r=[];return n.Kt(((n,i)=>{const s=new aa(n),o=function(t){return[0,rh(t)]}(s);r.push(e.get(o).next((n=>n?kh.resolve():(n=>e.put(new yh(0,rh(n),t.highestListenSequenceNumber)))(s))))})).next((()=>kh.waitFor(r)))}))}ke(t,e){t.createObjectStore(wh.store,{keyPath:wh.keyPath});const n=e.store(wh.store),r=new el,i=t=>{if(r.add(t)){const e=t.lastSegment(),r=t.popLast();return n.put({collectionId:e,parent:rh(r)})}};return e.store(ph.store).Kt({qt:!0},((t,e)=>{const n=new aa(t);return i(n.popLast())})).next((()=>e.store(lh.store).Kt({qt:!0},(([t,e,n],r)=>{const s=oh(e);return i(s.popLast())}))))}$e(t){const e=t.store(gh.store);return e.Kt(((t,n)=>{const r=Wh(n),i=Qh(this.N,r);return e.put(i)}))}}function Ol(t){t.createObjectStore(yh.store,{keyPath:yh.keyPath}).createIndex(yh.documentTargetsIndex,yh.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(gh.store,{keyPath:gh.keyPath}).createIndex(gh.queryTargetsIndexName,gh.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(vh.store)}const Ll="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Pl{constructor(t,e,n,r,i,s,o,a,c,u){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Oe=i,this.window=s,this.document=o,this.Fe=c,this.Me=u,this.Le=null,this.Be=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Ue=null,this.inForeground=!1,this.qe=null,this.Ke=null,this.je=Number.NEGATIVE_INFINITY,this.Qe=t=>Promise.resolve(),!Pl.bt())throw new Bo(qo.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new El(this,r),this.We=e+"main",this.N=new qh(a),this.Ge=new Ah(this.We,11,new xl(this.N)),this.ze=new pl(this.referenceDelegate,this.N),this.Ht=new nl,this.He=function(t,e){return new Nl(t,e)}(this.N,this.Ht),this.Je=new Xh,this.window&&this.window.localStorage?this.Ye=this.window.localStorage:(this.Ye=null,!1===u&&Po("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Xe().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new Bo(qo.FAILED_PRECONDITION,Ll);return this.Ze(),this.tn(),this.en(),this.runTransaction("getHighestListenSequenceNumber","readonly",(t=>this.ze.getHighestSequenceNumber(t)))})).then((t=>{this.Le=new Qo(t,this.Fe)})).then((()=>{this.Be=!0})).catch((t=>(this.Ge&&this.Ge.close(),Promise.reject(t))))}nn(t){return this.Qe=async e=>{if(this.started)return t(e)},t(this.isPrimary)}setDatabaseDeletedListener(t){this.Ge.xt((async e=>{null===e.newVersion&&await t()}))}setNetworkEnabled(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.Oe.enqueueAndForget((async()=>{this.started&&await this.Xe()})))}Xe(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(t=>Fl(t).put(new Ih(this.clientId,Date.now(),this.networkEnabled,this.inForeground)).next((()=>{if(this.isPrimary)return this.sn(t).next((t=>{t||(this.isPrimary=!1,this.Oe.enqueueRetryable((()=>this.Qe(!1))))}))})).next((()=>this.rn(t))).next((e=>this.isPrimary&&!e?this.on(t).next((()=>!1)):!!e&&this.an(t).next((()=>!0)))))).catch((t=>{if(Rh(t))return Lo("IndexedDbPersistence","Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return Lo("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1})).then((t=>{this.isPrimary!==t&&this.Oe.enqueueRetryable((()=>this.Qe(t))),this.isPrimary=t}))}sn(t){return Ml(t).get(ch.key).next((t=>kh.resolve(this.cn(t))))}un(t){return Fl(t).delete(this.clientId)}async hn(){if(this.isPrimary&&!this.ln(this.je,18e5)){this.je=Date.now();const t=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(t=>{const e=Fh(t,Ih.store);return e.Lt().next((t=>{const n=this.fn(t,18e5),r=t.filter((t=>-1===n.indexOf(t)));return kh.forEach(r,(t=>e.delete(t.clientId))).next((()=>r))}))})).catch((()=>[]));if(this.Ye)for(const e of t)this.Ye.removeItem(this.dn(e.clientId))}}en(){this.Ke=this.Oe.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.Xe().then((()=>this.hn())).then((()=>this.en()))))}cn(t){return!!t&&t.ownerId===this.clientId}rn(t){return this.Me?kh.resolve(!0):Ml(t).get(ch.key).next((e=>{if(null!==e&&this.ln(e.leaseTimestampMs,5e3)&&!this.wn(e.ownerId)){if(this.cn(e)&&this.networkEnabled)return!0;if(!this.cn(e)){if(!e.allowTabSynchronization)throw new Bo(qo.FAILED_PRECONDITION,Ll);return!1}}return!(!this.networkEnabled||!this.inForeground)||Fl(t).Lt().next((t=>void 0===this.fn(t,5e3).find((t=>{if(this.clientId!==t.clientId){const e=!this.networkEnabled&&t.networkEnabled,n=!this.inForeground&&t.inForeground,r=this.networkEnabled===t.networkEnabled;if(e||n&&r)return!0}return!1}))))})).next((t=>(this.isPrimary!==t&&Lo("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t)))}async shutdown(){this.Be=!1,this._n(),this.Ke&&(this.Ke.cancel(),this.Ke=null),this.mn(),this.gn(),await this.Ge.runTransaction("shutdown","readwrite",[ch.store,Ih.store],(t=>{const e=new Mh(t,Qo.T);return this.on(e).next((()=>this.un(e)))})),this.Ge.close(),this.yn()}fn(t,e){return t.filter((t=>this.ln(t.updateTimeMs,e)&&!this.wn(t.clientId)))}pn(){return this.runTransaction("getActiveClients","readonly",(t=>Fl(t).Lt().next((t=>this.fn(t,18e5).map((t=>t.clientId))))))}get started(){return this.Be}getMutationQueue(t){return cl.Yt(t,this.N,this.Ht,this.referenceDelegate)}getTargetCache(){return this.ze}getRemoteDocumentCache(){return this.He}getIndexManager(){return this.Ht}getBundleCache(){return this.Je}runTransaction(t,e,n){Lo("IndexedDbPersistence","Starting transaction:",t);const r="readonly"===e?"readonly":"readwrite";let i;return this.Ge.runTransaction(t,r,Eh,(r=>(i=new Mh(r,this.Le?this.Le.next():Qo.T),"readwrite-primary"===e?this.sn(i).next((t=>!!t||this.rn(i))).next((e=>{if(!e)throw Po(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.Oe.enqueueRetryable((()=>this.Qe(!1))),new Bo(qo.FAILED_PRECONDITION,Sh);return n(i)})).next((t=>this.an(i).next((()=>t)))):this.En(i).next((()=>n(i)))))).then((t=>(i.raiseOnCommittedEvent(),t)))}En(t){return Ml(t).get(ch.key).next((t=>{if(null!==t&&this.ln(t.leaseTimestampMs,5e3)&&!this.wn(t.ownerId)&&!this.cn(t)&&!(this.Me||this.allowTabSynchronization&&t.allowTabSynchronization))throw new Bo(qo.FAILED_PRECONDITION,Ll)}))}an(t){const e=new ch(this.clientId,this.allowTabSynchronization,Date.now());return Ml(t).put(ch.key,e)}static bt(){return Ah.bt()}on(t){const e=Ml(t);return e.get(ch.key).next((t=>this.cn(t)?(Lo("IndexedDbPersistence","Releasing primary lease."),e.delete(ch.key)):kh.resolve()))}ln(t,e){const n=Date.now();return!(t<n-e||t>n&&(Po(`Detected an update time that is in the future: ${t} > ${n}`),1))}Ze(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.qe=()=>{this.Oe.enqueueAndForget((()=>(this.inForeground="visible"===this.document.visibilityState,this.Xe())))},this.document.addEventListener("visibilitychange",this.qe),this.inForeground="visible"===this.document.visibilityState)}mn(){this.qe&&(this.document.removeEventListener("visibilitychange",this.qe),this.qe=null)}tn(){var t;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Ue=()=>{this._n(),!function(){try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(t){return!1}}()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")&&navigator.appVersion.match("Version/14")&&this.Oe.enterRestrictedMode(!0),this.Oe.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.Ue))}gn(){this.Ue&&(this.window.removeEventListener("pagehide",this.Ue),this.Ue=null)}wn(t){var e;try{const n=null!==(null===(e=this.Ye)||void 0===e?void 0:e.getItem(this.dn(t)));return Lo("IndexedDbPersistence",`Client '${t}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(t){return Po("IndexedDbPersistence","Failed to get zombied client id.",t),!1}}_n(){if(this.Ye)try{this.Ye.setItem(this.dn(this.clientId),String(Date.now()))}catch(t){Po("Failed to set zombie client id.",t)}}yn(){if(this.Ye)try{this.Ye.removeItem(this.dn(this.clientId))}catch(t){}}dn(t){return`firestore_zombie_${this.persistenceKey}_${t}`}}function Ml(t){return Fh(t,ch.store)}function Fl(t){return Fh(t,Ih.store)}class Ul{constructor(t,e,n){this.He=t,this.In=e,this.Ht=n}An(t,e){return this.In.getAllMutationBatchesAffectingDocumentKey(t,e).next((n=>this.Rn(t,e,n)))}Rn(t,e,n){return this.He.getEntry(t,e).next((t=>{for(const e of n)e.applyToLocalView(t);return t}))}bn(t,e){t.forEach(((t,n)=>{for(const t of e)t.applyToLocalView(n)}))}Pn(t,e){return this.He.getEntries(t,e).next((e=>this.vn(t,e).next((()=>e))))}vn(t,e){return this.In.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>this.bn(e,t)))}getDocumentsMatchingQuery(t,e,n){return function(t){return ba.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Vn(t,e.path):lc(e)?this.Sn(t,e,n):this.Dn(t,e,n)}Vn(t,e){return this.An(t,new ba(e)).next((t=>{let e=hu();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}Sn(t,e,n){const r=e.collectionGroup;let i=hu();return this.Ht.getCollectionParents(t,r).next((s=>kh.forEach(s,(s=>{const o=function(t,e){return new sc(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,s.child(r));return this.Dn(t,o,n).next((t=>{t.forEach(((t,e)=>{i=i.insert(t,e)}))}))})).next((()=>i))))}Dn(t,e,n){let r,i;return this.He.getDocumentsMatchingQuery(t,e,n).next((n=>(r=n,this.In.getAllMutationBatchesAffectingQuery(t,e)))).next((e=>(i=e,this.Cn(t,i,r).next((t=>{r=t;for(const t of i)for(const e of t.mutations){const n=e.key;let i=r.get(n);null==i&&(i=Ua.newInvalidDocument(n),r=r.insert(n,i)),qc(e,i,t.localWriteTime),i.isFoundDocument()||(r=r.remove(n))}}))))).next((()=>(r.forEach(((t,n)=>{yc(e,n)||(r=r.remove(t))})),r)))}Cn(t,e,n){let r=fu();for(const t of e)for(const e of t.mutations)e instanceof Gc&&null===n.get(e.key)&&(r=r.add(e.key));let i=n;return this.He.getEntries(t,r).next((t=>(t.forEach(((t,e)=>{e.isFoundDocument()&&(i=i.insert(t,e))})),i)))}}class Vl{constructor(t,e,n,r){this.targetId=t,this.fromCache=e,this.Nn=n,this.xn=r}static kn(t,e){let n=fu(),r=fu();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:r=r.add(t.doc.key)}return new Vl(t,e.fromCache,n,r)}}class jl{$n(t){this.On=t}getDocumentsMatchingQuery(t,e,n,r){return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}(e)||n.isEqual(na.min())?this.Fn(t,e):this.On.Pn(t,r).next((i=>{const s=this.Mn(e,i);return(ac(e)||cc(e))&&this.Ln(e.limitType,s,r,n)?this.Fn(t,e):(Oo()<=A.DEBUG&&Lo("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),gc(e)),this.On.getDocumentsMatchingQuery(t,e,n).next((t=>(s.forEach((e=>{t=t.insert(e.key,e)})),t))))}))}Mn(t,e){let n=new su(vc(t));return e.forEach(((e,r)=>{yc(t,r)&&(n=n.add(r))})),n}Ln(t,e,n,r){if(n.size!==e.size)return!0;const i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Fn(t,e){return Oo()<=A.DEBUG&&Lo("QueryEngine","Using full collection scan to execute query:",gc(e)),this.On.getDocumentsMatchingQuery(t,e,na.min())}}class ql{constructor(t,e,n,r){this.persistence=t,this.Bn=e,this.N=r,this.Un=new nu(Jo),this.qn=new _l((t=>qa(t)),Ba),this.Kn=na.min(),this.In=t.getMutationQueue(n),this.jn=t.getRemoteDocumentCache(),this.ze=t.getTargetCache(),this.Qn=new Ul(this.jn,this.In,this.persistence.getIndexManager()),this.Je=t.getBundleCache(),this.Bn.$n(this.Qn)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.Un)))}}function Bl(t,e,n,r){return new ql(t,e,n,r)}async function Kl(t,e){const n=jo(t);let r=n.In,i=n.Qn;const s=await n.persistence.runTransaction("Handle user change","readonly",(t=>{let s;return n.In.getAllMutationBatches(t).next((o=>(s=o,r=n.persistence.getMutationQueue(e),i=new Ul(n.jn,r,n.persistence.getIndexManager()),r.getAllMutationBatches(t)))).next((e=>{const n=[],r=[];let o=fu();for(const t of s){n.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){r.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return i.Pn(t,o).next((t=>({Wn:t,removedBatchIds:n,addedBatchIds:r})))}))}));return n.In=r,n.Qn=i,n.Bn.$n(n.Qn),s}function zl(t){const e=jo(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.ze.getLastRemoteSnapshotVersion(t)))}function Hl(t,e){const n=jo(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(t=>(void 0===e&&(e=-1),n.In.getNextMutationBatchAfterBatchId(t,e))))}async function Gl(t,e,n){const r=jo(t),i=r.Un.get(e),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,(t=>r.persistence.referenceDelegate.removeTarget(t,i)))}catch(t){if(!Rh(t))throw t;Lo("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}r.Un=r.Un.remove(e),r.qn.delete(i.target)}function $l(t,e,n){const r=jo(t);let i=na.min(),s=fu();return r.persistence.runTransaction("Execute query","readonly",(t=>function(t,e,n){const r=jo(t),i=r.qn.get(n);return void 0!==i?kh.resolve(r.Un.get(i)):r.ze.getTargetData(e,n)}(r,t,fc(e)).next((e=>{if(e)return i=e.lastLimboFreeSnapshotVersion,r.ze.getMatchingKeysForTargetId(t,e.targetId).next((t=>{s=t}))})).next((()=>r.Bn.getDocumentsMatchingQuery(t,e,n?i:na.min(),n?s:fu()))).next((t=>({documents:t,Gn:s})))))}class Wl{constructor(t){this.N=t,this.Yn=new Map,this.Xn=new Map}getBundleMetadata(t,e){return kh.resolve(this.Yn.get(e))}saveBundleMetadata(t,e){var n;return this.Yn.set(e.id,{id:(n=e).id,version:n.version,createTime:Ru(n.createTime)}),kh.resolve()}getNamedQuery(t,e){return kh.resolve(this.Xn.get(e))}saveNamedQuery(t,e){return this.Xn.set(e.name,function(t){return{name:t.name,query:Yh(t.bundledQuery),readTime:Ru(t.readTime)}}(e)),kh.resolve()}}class Ql{constructor(){this.Zn=new su(Yl.ts),this.es=new su(Yl.ns)}isEmpty(){return this.Zn.isEmpty()}addReference(t,e){const n=new Yl(t,e);this.Zn=this.Zn.add(n),this.es=this.es.add(n)}ss(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.rs(new Yl(t,e))}os(t,e){t.forEach((t=>this.removeReference(t,e)))}cs(t){const e=new ba(new aa([])),n=new Yl(e,t),r=new Yl(e,t+1),i=[];return this.es.forEachInRange([n,r],(t=>{this.rs(t),i.push(t.key)})),i}us(){this.Zn.forEach((t=>this.rs(t)))}rs(t){this.Zn=this.Zn.delete(t),this.es=this.es.delete(t)}hs(t){const e=new ba(new aa([])),n=new Yl(e,t),r=new Yl(e,t+1);let i=fu();return this.es.forEachInRange([n,r],(t=>{i=i.add(t.key)})),i}containsKey(t){const e=new Yl(t,0),n=this.Zn.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class Yl{constructor(t,e){this.key=t,this.ls=e}static ts(t,e){return ba.comparator(t.key,e.key)||Jo(t.ls,e.ls)}static ns(t,e){return Jo(t.ls,e.ls)||ba.comparator(t.key,e.key)}}class Xl{constructor(t,e){this.Ht=t,this.referenceDelegate=e,this.In=[],this.fs=1,this.ds=new su(Yl.ts)}checkEmpty(t){return kh.resolve(0===this.In.length)}addMutationBatch(t,e,n,r){const i=this.fs;this.fs++,this.In.length>0&&this.In[this.In.length-1];const s=new Uh(i,e,n,r);this.In.push(s);for(const e of r)this.ds=this.ds.add(new Yl(e.key,i)),this.Ht.addToCollectionParentIndex(t,e.key.path.popLast());return kh.resolve(s)}lookupMutationBatch(t,e){return kh.resolve(this.ws(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,r=this._s(n),i=r<0?0:r;return kh.resolve(this.In.length>i?this.In[i]:null)}getHighestUnacknowledgedBatchId(){return kh.resolve(0===this.In.length?-1:this.fs-1)}getAllMutationBatches(t){return kh.resolve(this.In.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new Yl(e,0),r=new Yl(e,Number.POSITIVE_INFINITY),i=[];return this.ds.forEachInRange([n,r],(t=>{const e=this.ws(t.ls);i.push(e)})),kh.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new su(Jo);return e.forEach((t=>{const e=new Yl(t,0),r=new Yl(t,Number.POSITIVE_INFINITY);this.ds.forEachInRange([e,r],(t=>{n=n.add(t.ls)}))})),kh.resolve(this.gs(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,r=n.length+1;let i=n;ba.isDocumentKey(i)||(i=i.child(""));const s=new Yl(new ba(i),0);let o=new su(Jo);return this.ds.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(o=o.add(t.ls)),!0)}),s),kh.resolve(this.gs(o))}gs(t){const e=[];return t.forEach((t=>{const n=this.ws(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){Vo(0===this.ys(e.batchId,"removed")),this.In.shift();let n=this.ds;return kh.forEach(e.mutations,(r=>{const i=new Yl(r.key,e.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(t,r.key)})).next((()=>{this.ds=n}))}te(t){}containsKey(t,e){const n=new Yl(e,0),r=this.ds.firstAfterOrEqual(n);return kh.resolve(e.isEqual(r&&r.key))}performConsistencyCheck(t){return this.In.length,kh.resolve()}ys(t,e){return this._s(t)}_s(t){return 0===this.In.length?0:t-this.In[0].batchId}ws(t){const e=this._s(t);return e<0||e>=this.In.length?null:this.In[e]}}class Jl{constructor(t,e){this.Ht=t,this.ps=e,this.docs=new nu(ba.comparator),this.size=0}addEntry(t,e,n){const r=e.key,i=this.docs.get(r),s=i?i.size:0,o=this.ps(e);return this.docs=this.docs.insert(r,{document:e.clone(),size:o,readTime:n}),this.size+=o-s,this.Ht.addToCollectionParentIndex(t,r.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return kh.resolve(n?n.document.clone():Ua.newInvalidDocument(e))}getEntries(t,e){let n=cu();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.clone():Ua.newInvalidDocument(t))})),kh.resolve(n)}getDocumentsMatchingQuery(t,e,n){let r=cu();const i=new ba(e.path.child("")),s=this.docs.getIteratorFrom(i);for(;s.hasNext();){const{key:t,value:{document:i,readTime:o}}=s.getNext();if(!e.path.isPrefixOf(t.path))break;o.compareTo(n)<=0||yc(e,i)&&(r=r.insert(i.key,i.clone()))}return kh.resolve(r)}Es(t,e){return kh.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new Zl(this)}getSize(t){return kh.resolve(this.size)}}class Zl extends kl{constructor(t){super(),this.Se=t}applyChanges(t){const e=[];return this.changes.forEach(((n,r)=>{r.document.isValidDocument()?e.push(this.Se.addEntry(t,r.document,this.getReadTime(n))):this.Se.removeEntry(n)})),kh.waitFor(e)}getFromCache(t,e){return this.Se.getEntry(t,e)}getAllFromCache(t,e){return this.Se.getEntries(t,e)}}class td{constructor(t){this.persistence=t,this.Ts=new _l((t=>qa(t)),Ba),this.lastRemoteSnapshotVersion=na.min(),this.highestTargetId=0,this.Is=0,this.As=new Ql,this.targetCount=0,this.Rs=fl.se()}forEachTarget(t,e){return this.Ts.forEach(((t,n)=>e(n))),kh.resolve()}getLastRemoteSnapshotVersion(t){return kh.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return kh.resolve(this.Is)}allocateTargetId(t){return this.highestTargetId=this.Rs.next(),kh.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Is&&(this.Is=e),kh.resolve()}ae(t){this.Ts.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.Rs=new fl(e),this.highestTargetId=e),t.sequenceNumber>this.Is&&(this.Is=t.sequenceNumber)}addTargetData(t,e){return this.ae(e),this.targetCount+=1,kh.resolve()}updateTargetData(t,e){return this.ae(e),kh.resolve()}removeTargetData(t,e){return this.Ts.delete(e.target),this.As.cs(e.targetId),this.targetCount-=1,kh.resolve()}removeTargets(t,e,n){let r=0;const i=[];return this.Ts.forEach(((s,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.Ts.delete(s),i.push(this.removeMatchingKeysForTargetId(t,o.targetId)),r++)})),kh.waitFor(i).next((()=>r))}getTargetCount(t){return kh.resolve(this.targetCount)}getTargetData(t,e){const n=this.Ts.get(e)||null;return kh.resolve(n)}addMatchingKeys(t,e,n){return this.As.ss(e,n),kh.resolve()}removeMatchingKeys(t,e,n){this.As.os(e,n);const r=this.persistence.referenceDelegate,i=[];return r&&e.forEach((e=>{i.push(r.markPotentiallyOrphaned(t,e))})),kh.waitFor(i)}removeMatchingKeysForTargetId(t,e){return this.As.cs(e),kh.resolve()}getMatchingKeysForTargetId(t,e){const n=this.As.hs(e);return kh.resolve(n)}containsKey(t,e){return kh.resolve(this.As.containsKey(e))}}class ed{constructor(t,e){this.bs={},this.Le=new Qo(0),this.Be=!1,this.Be=!0,this.referenceDelegate=t(this),this.ze=new td(this),this.Ht=new tl,this.He=function(t,e){return new Jl(t,e)}(this.Ht,(t=>this.referenceDelegate.Ps(t))),this.N=new qh(e),this.Je=new Wl(this.N)}start(){return Promise.resolve()}shutdown(){return this.Be=!1,Promise.resolve()}get started(){return this.Be}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(){return this.Ht}getMutationQueue(t){let e=this.bs[t.toKey()];return e||(e=new Xl(this.Ht,this.referenceDelegate),this.bs[t.toKey()]=e),e}getTargetCache(){return this.ze}getRemoteDocumentCache(){return this.He}getBundleCache(){return this.Je}runTransaction(t,e,n){Lo("MemoryPersistence","Starting transaction:",t);const r=new nd(this.Le.next());return this.referenceDelegate.vs(),n(r).next((t=>this.referenceDelegate.Vs(r).next((()=>t)))).toPromise().then((t=>(r.raiseOnCommittedEvent(),t)))}Ss(t,e){return kh.or(Object.values(this.bs).map((n=>()=>n.containsKey(t,e))))}}class nd extends _h{constructor(t){super(),this.currentSequenceNumber=t}}class rd{constructor(t){this.persistence=t,this.Ds=new Ql,this.Cs=null}static Ns(t){return new rd(t)}get xs(){if(this.Cs)return this.Cs;throw Uo()}addReference(t,e,n){return this.Ds.addReference(n,e),this.xs.delete(n.toString()),kh.resolve()}removeReference(t,e,n){return this.Ds.removeReference(n,e),this.xs.add(n.toString()),kh.resolve()}markPotentiallyOrphaned(t,e){return this.xs.add(e.toString()),kh.resolve()}removeTarget(t,e){this.Ds.cs(e.targetId).forEach((t=>this.xs.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.xs.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}vs(){this.Cs=new Set}Vs(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return kh.forEach(this.xs,(n=>{const r=ba.fromPath(n);return this.ks(t,r).next((t=>{t||e.removeEntry(r)}))})).next((()=>(this.Cs=null,e.apply(t))))}updateLimboDocument(t,e){return this.ks(t,e).next((t=>{t?this.xs.delete(e.toString()):this.xs.add(e.toString())}))}Ps(t){return 0}ks(t,e){return kh.or([()=>kh.resolve(this.Ds.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ss(t,e)])}}class id{constructor(){this.activeTargetIds=mu()}Fs(t){this.activeTargetIds=this.activeTargetIds.add(t)}Ms(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Os(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class sd{constructor(){this.yi=new id,this.pi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return this.yi.Fs(t),this.pi[t]||"not-current"}updateQueryState(t,e,n){this.pi[t]=e}removeLocalQueryTarget(t){this.yi.Ms(t)}isLocalQueryTarget(t){return this.yi.activeTargetIds.has(t)}clearQueryState(t){delete this.pi[t]}getAllActiveQueryTargets(){return this.yi.activeTargetIds}isActiveQueryTarget(t){return this.yi.activeTargetIds.has(t)}start(){return this.yi=new id,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(){}}class od{Ei(t){}shutdown(){}}class ad{constructor(){this.Ti=()=>this.Ii(),this.Ai=()=>this.Ri(),this.bi=[],this.Pi()}Ei(t){this.bi.push(t)}shutdown(){window.removeEventListener("online",this.Ti),window.removeEventListener("offline",this.Ai)}Pi(){window.addEventListener("online",this.Ti),window.addEventListener("offline",this.Ai)}Ii(){Lo("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.bi)t(0)}Ri(){Lo("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.bi)t(1)}static bt(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const cd={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class ud{constructor(t){this.vi=t.vi,this.Vi=t.Vi}Si(t){this.Di=t}Ci(t){this.Ni=t}onMessage(t){this.xi=t}close(){this.Vi()}send(t){this.vi(t)}ki(){this.Di()}$i(t){this.Ni(t)}Oi(t){this.xi(t)}}class hd extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http";this.Fi=e+"://"+t.host,this.Mi="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}Li(t,e,n,r){const i=this.Bi(t,e);Lo("RestConnection","Sending: ",i,n);const s={};return this.Ui(s,r),this.qi(t,i,s,n).then((t=>(Lo("RestConnection","Received: ",t),t)),(e=>{throw Mo("RestConnection",`${t} failed with error: `,e,"url: ",i,"request:",n),e}))}Ki(t,e,n,r){return this.Li(t,e,n,r)}Ui(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/"+Ro,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e)for(const n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])}Bi(t,e){const n=cd[t];return`${this.Fi}/v1/${e}:${n}`}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams}qi(t,e,n,r){return new Promise(((i,s)=>{const o=new Do;o.listenOnce(So.COMPLETE,(()=>{try{switch(o.getLastErrorCode()){case Eo.NO_ERROR:const e=o.getResponseJson();Lo("Connection","XHR received:",JSON.stringify(e)),i(e);break;case Eo.TIMEOUT:Lo("Connection",'RPC "'+t+'" timed out'),s(new Bo(qo.DEADLINE_EXCEEDED,"Request time out"));break;case Eo.HTTP_ERROR:const n=o.getStatus();if(Lo("Connection",'RPC "'+t+'" failed with status:',n,"response text:",o.getResponseText()),n>0){const t=o.getResponseJson().error;if(t&&t.status&&t.message){const e=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(qo).indexOf(e)>=0?e:qo.UNKNOWN}(t.status);s(new Bo(e,t.message))}else s(new Bo(qo.UNKNOWN,"Server responded with status "+o.getStatus()))}else s(new Bo(qo.UNAVAILABLE,"Connection failed."));break;default:Uo()}}finally{Lo("Connection",'RPC "'+t+'" completed.')}}));const a=JSON.stringify(r);o.send(e,"POST",a,n,15)}))}ji(t,e){const n=[this.Fi,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=bo(),i=To(),s={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(s.xmlHttpFactory=new No({})),this.Ui(s.initMessageHeaders,e),c()||h()||a().indexOf("Electron/")>=0||l()||a().indexOf("MSAppHost/")>=0||u()||(s.httpHeadersOverwriteParam="$httpHeaders");const o=n.join("");Lo("Connection","Creating WebChannel: "+o,s);const d=r.createWebChannel(o,s);let f=!1,p=!1;const m=new ud({vi:t=>{p?Lo("Connection","Not sending because WebChannel is closed:",t):(f||(Lo("Connection","Opening WebChannel transport."),d.open(),f=!0),Lo("Connection","WebChannel sending:",t),d.send(t))},Vi:()=>d.close()}),g=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return g(d,Ao.EventType.OPEN,(()=>{p||Lo("Connection","WebChannel transport opened.")})),g(d,Ao.EventType.CLOSE,(()=>{p||(p=!0,Lo("Connection","WebChannel transport closed"),m.$i())})),g(d,Ao.EventType.ERROR,(t=>{p||(p=!0,Mo("Connection","WebChannel transport errored:",t),m.$i(new Bo(qo.UNAVAILABLE,"The operation could not be completed")))})),g(d,Ao.EventType.MESSAGE,(t=>{var e;if(!p){const n=t.data[0];Vo(!!n);const r=n,i=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(i){Lo("Connection","WebChannel received error:",i);const t=i.status;let e=function(t){const e=Zc[t];if(void 0!==e)return eu(e)}(t),n=i.message;void 0===e&&(e=qo.INTERNAL,n="Unknown error status: "+t+" with message "+i.message),p=!0,m.$i(new Bo(e,n)),d.close()}else Lo("Connection","WebChannel received:",n),m.Oi(n)}})),g(i,_o.STAT_EVENT,(t=>{t.stat===ko.PROXY?Lo("Connection","Detected buffering proxy"):t.stat===ko.NOPROXY&&Lo("Connection","Detected no buffering proxy")})),setTimeout((()=>{m.ki()}),0),m}}function ld(){return"undefined"!=typeof document?document:null}function dd(t){return new Nu(t,!0)}class fd{constructor(t,e,n=1e3,r=1.5,i=6e4){this.Oe=t,this.timerId=e,this.Qi=n,this.Wi=r,this.Gi=i,this.zi=0,this.Hi=null,this.Ji=Date.now(),this.reset()}reset(){this.zi=0}Yi(){this.zi=this.Gi}Xi(t){this.cancel();const e=Math.floor(this.zi+this.Zi()),n=Math.max(0,Date.now()-this.Ji),r=Math.max(0,e-n);r>0&&Lo("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.zi} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.Hi=this.Oe.enqueueAfterDelay(this.timerId,r,(()=>(this.Ji=Date.now(),t()))),this.zi*=this.Wi,this.zi<this.Qi&&(this.zi=this.Qi),this.zi>this.Gi&&(this.zi=this.Gi)}tr(){null!==this.Hi&&(this.Hi.skipDelay(),this.Hi=null)}cancel(){null!==this.Hi&&(this.Hi.cancel(),this.Hi=null)}Zi(){return(Math.random()-.5)*this.zi}}class pd{constructor(t,e,n,r,i,s){this.Oe=t,this.er=n,this.nr=r,this.credentialsProvider=i,this.listener=s,this.state=0,this.sr=0,this.ir=null,this.stream=null,this.rr=new fd(t,e)}ar(){return 1===this.state||2===this.state||4===this.state}cr(){return 2===this.state}start(){3!==this.state?this.auth():this.ur()}async stop(){this.ar()&&await this.close(0)}hr(){this.state=0,this.rr.reset()}lr(){this.cr()&&null===this.ir&&(this.ir=this.Oe.enqueueAfterDelay(this.er,6e4,(()=>this.dr())))}wr(t){this._r(),this.stream.send(t)}async dr(){if(this.cr())return this.close(0)}_r(){this.ir&&(this.ir.cancel(),this.ir=null)}async close(t,e){this._r(),this.rr.cancel(),this.sr++,3!==t?this.rr.reset():e&&e.code===qo.RESOURCE_EXHAUSTED?(Po(e.toString()),Po("Using maximum backoff delay to prevent overloading the backend."),this.rr.Yi()):e&&e.code===qo.UNAUTHENTICATED&&this.credentialsProvider.invalidateToken(),null!==this.stream&&(this.mr(),this.stream.close(),this.stream=null),this.state=t,await this.listener.Ci(e)}mr(){}auth(){this.state=1;const t=this.gr(this.sr),e=this.sr;this.credentialsProvider.getToken().then((t=>{this.sr===e&&this.yr(t)}),(e=>{t((()=>{const t=new Bo(qo.UNKNOWN,"Fetching auth token failed: "+e.message);return this.pr(t)}))}))}yr(t){const e=this.gr(this.sr);this.stream=this.Er(t),this.stream.Si((()=>{e((()=>(this.state=2,this.listener.Si())))})),this.stream.Ci((t=>{e((()=>this.pr(t)))})),this.stream.onMessage((t=>{e((()=>this.onMessage(t)))}))}ur(){this.state=4,this.rr.Xi((async()=>{this.state=0,this.start()}))}pr(t){return Lo("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(3,t)}gr(t){return e=>{this.Oe.enqueueAndForget((()=>this.sr===t?e():(Lo("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class md extends pd{constructor(t,e,n,r,i){super(t,"listen_stream_connection_backoff","listen_stream_idle",e,n,i),this.N=r}Er(t){return this.nr.ji("Listen",t)}onMessage(t){this.rr.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Uo()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(t,e){return t.D?(Vo(void 0===e||"string"==typeof e),la.fromBase64String(e||"")):(Vo(void 0===e||e instanceof Uint8Array),la.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?qo.UNKNOWN:eu(t.code);return new Bo(e,t.message||"")}(o);n=new Iu(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=Pu(t,r.document.name),s=Ru(r.document.updateTime),o=new Ma({mapValue:{fields:r.document.fields}}),a=Ua.newFoundDocument(i,s,o),c=r.targetIds||[],u=r.removedTargetIds||[];n=new vu(c,u,a.key,a)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=Pu(t,r.document),s=r.readTime?Ru(r.readTime):na.min(),o=Ua.newNoDocument(i,s),a=r.removedTargetIds||[];n=new vu([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=Pu(t,r.document),s=r.removedTargetIds||[];n=new vu([],s,i,null)}else{if(!("filter"in e))return Uo();{e.filter;const t=e.filter;t.targetId;const r=t.count||0,i=new Jc(r),s=t.targetId;n=new wu(s,i)}}return n}(this.N,t),n=function(t){if(!("targetChange"in t))return na.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?na.min():e.readTime?Ru(e.readTime):na.min()}(t);return this.listener.Tr(e,n)}Ir(t){const e={};e.database=Uu(this.N),e.addTarget=function(t,e){let n;const r=e.target;return n=Ka(r)?{documents:Ku(t,r)}:{query:zu(t,r)},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=Du(t,e.resumeToken):e.snapshotVersion.compareTo(na.min())>0&&(n.readTime=Au(t,e.snapshotVersion.toTimestamp())),n}(this.N,t);const n=function(t,e){const n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Uo()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.N,t);n&&(e.labels=n),this.wr(e)}Ar(t){const e={};e.database=Uu(this.N),e.removeTarget=t,this.wr(e)}}class gd extends pd{constructor(t,e,n,r,i){super(t,"write_stream_connection_backoff","write_stream_idle",e,n,i),this.N=r,this.Rr=!1}get br(){return this.Rr}start(){this.Rr=!1,this.lastStreamToken=void 0,super.start()}mr(){this.Rr&&this.Pr([])}Er(t){return this.nr.ji("Write",t)}onMessage(t){if(Vo(!!t.streamToken),this.lastStreamToken=t.streamToken,this.Rr){this.rr.reset();const e=function(t,e){return t&&t.length>0?(Vo(void 0!==e),t.map((t=>function(t,e){let n=t.updateTime?Ru(t.updateTime):Ru(e);return n.isEqual(na.min())&&(n=Ru(e)),new Mc(n,t.transformResults||[])}(t,e)))):[]}(t.writeResults,t.commitTime),n=Ru(t.commitTime);return this.listener.vr(n,e)}return Vo(!t.writeResults||0===t.writeResults.length),this.Rr=!0,this.listener.Vr()}Sr(){const t={};t.database=Uu(this.N),this.wr(t)}Pr(t){const e={streamToken:this.lastStreamToken,writes:t.map((t=>qu(this.N,t)))};this.wr(e)}}class yd extends class{}{constructor(t,e,n){super(),this.credentials=t,this.nr=e,this.N=n,this.Dr=!1}Cr(){if(this.Dr)throw new Bo(qo.FAILED_PRECONDITION,"The client has already been terminated.")}Li(t,e,n){return this.Cr(),this.credentials.getToken().then((r=>this.nr.Li(t,e,n,r))).catch((t=>{throw"FirebaseError"===t.name?(t.code===qo.UNAUTHENTICATED&&this.credentials.invalidateToken(),t):new Bo(qo.UNKNOWN,t.toString())}))}Ki(t,e,n){return this.Cr(),this.credentials.getToken().then((r=>this.nr.Ki(t,e,n,r))).catch((t=>{throw"FirebaseError"===t.name?(t.code===qo.UNAUTHENTICATED&&this.credentials.invalidateToken(),t):new Bo(qo.UNKNOWN,t.toString())}))}terminate(){this.Dr=!0}}class vd{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.Nr=0,this.kr=null,this.$r=!0}Or(){0===this.Nr&&(this.Fr("Unknown"),this.kr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.kr=null,this.Mr("Backend didn't respond within 10 seconds."),this.Fr("Offline"),Promise.resolve()))))}Lr(t){"Online"===this.state?this.Fr("Unknown"):(this.Nr++,this.Nr>=1&&(this.Br(),this.Mr(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.Fr("Offline")))}set(t){this.Br(),this.Nr=0,"Online"===t&&(this.$r=!1),this.Fr(t)}Fr(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}Mr(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.$r?(Po(e),this.$r=!1):Lo("OnlineStateTracker",e)}Br(){null!==this.kr&&(this.kr.cancel(),this.kr=null)}}class wd{constructor(t,e,n,r,i){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.Ur=[],this.qr=new Map,this.Kr=new Set,this.jr=[],this.Qr=i,this.Qr.Ei((t=>{n.enqueueAndForget((async()=>{Ad(this)&&(Lo("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=jo(t);e.Kr.add(4),await bd(e),e.Wr.set("Unknown"),e.Kr.delete(4),await Id(e)}(this))}))})),this.Wr=new vd(n,r)}}async function Id(t){if(Ad(t))for(const e of t.jr)await e(!0)}async function bd(t){for(const e of t.jr)await e(!1)}function Td(t,e){const n=jo(t);n.qr.has(e.targetId)||(n.qr.set(e.targetId,e),Nd(n)?kd(n):zd(n).cr()&&Sd(n,e))}function Ed(t,e){const n=jo(t),r=zd(n);n.qr.delete(e),r.cr()&&_d(n,e),0===n.qr.size&&(r.cr()?r.lr():Ad(n)&&n.Wr.set("Unknown"))}function Sd(t,e){t.Gr.Y(e.targetId),zd(t).Ir(e)}function _d(t,e){t.Gr.Y(e),zd(t).Ar(e)}function kd(t){t.Gr=new Tu({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),Et:e=>t.qr.get(e)||null}),zd(t).start(),t.Wr.Or()}function Nd(t){return Ad(t)&&!zd(t).ar()&&t.qr.size>0}function Ad(t){return 0===jo(t).Kr.size}function Dd(t){t.Gr=void 0}async function Cd(t){t.qr.forEach(((e,n)=>{Sd(t,e)}))}async function Rd(t,e){Dd(t),Nd(t)?(t.Wr.Lr(e),kd(t)):t.Wr.set("Unknown")}async function xd(t,e,n){if(t.Wr.set("Online"),e instanceof Iu&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const r of e.targetIds)t.qr.has(r)&&(await t.remoteSyncer.rejectListen(r,n),t.qr.delete(r),t.Gr.removeTarget(r))}(t,e)}catch(n){Lo("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await Od(t,n)}else if(e instanceof vu?t.Gr.rt(e):e instanceof wu?t.Gr.ft(e):t.Gr.ct(e),!n.isEqual(na.min()))try{const e=await zl(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.Gr._t(e);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=t.qr.get(r);i&&t.qr.set(r,i.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach((e=>{const n=t.qr.get(e);if(!n)return;t.qr.set(e,n.withResumeToken(la.EMPTY_BYTE_STRING,n.snapshotVersion)),_d(t,e);const r=new jh(n.target,e,1,n.sequenceNumber);Sd(t,r)})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){Lo("RemoteStore","Failed to raise snapshot:",e),await Od(t,e)}}async function Od(t,e,n){if(!Rh(e))throw e;t.Kr.add(1),await bd(t),t.Wr.set("Offline"),n||(n=()=>zl(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{Lo("RemoteStore","Retrying IndexedDB access"),await n(),t.Kr.delete(1),await Id(t)}))}function Ld(t,e){return e().catch((n=>Od(t,n,e)))}async function Pd(t){const e=jo(t),n=Hd(e);let r=e.Ur.length>0?e.Ur[e.Ur.length-1].batchId:-1;for(;Md(e);)try{const t=await Hl(e.localStore,r);if(null===t){0===e.Ur.length&&n.lr();break}r=t.batchId,Fd(e,t)}catch(t){await Od(e,t)}Ud(e)&&Vd(e)}function Md(t){return Ad(t)&&t.Ur.length<10}function Fd(t,e){t.Ur.push(e);const n=Hd(t);n.cr()&&n.br&&n.Pr(e.mutations)}function Ud(t){return Ad(t)&&!Hd(t).ar()&&t.Ur.length>0}function Vd(t){Hd(t).start()}async function jd(t){Hd(t).Sr()}async function qd(t){const e=Hd(t);for(const n of t.Ur)e.Pr(n.mutations)}async function Bd(t,e,n){const r=t.Ur.shift(),i=Vh.from(r,e,n);await Ld(t,(()=>t.remoteSyncer.applySuccessfulWrite(i))),await Pd(t)}async function Kd(t,e){e&&Hd(t).br&&await async function(t,e){if(function(t){switch(t){default:return Uo();case qo.CANCELLED:case qo.UNKNOWN:case qo.DEADLINE_EXCEEDED:case qo.RESOURCE_EXHAUSTED:case qo.INTERNAL:case qo.UNAVAILABLE:case qo.UNAUTHENTICATED:return!1;case qo.INVALID_ARGUMENT:case qo.NOT_FOUND:case qo.ALREADY_EXISTS:case qo.PERMISSION_DENIED:case qo.FAILED_PRECONDITION:case qo.ABORTED:case qo.OUT_OF_RANGE:case qo.UNIMPLEMENTED:case qo.DATA_LOSS:return!0}}(n=e.code)&&n!==qo.ABORTED){const n=t.Ur.shift();Hd(t).hr(),await Ld(t,(()=>t.remoteSyncer.rejectFailedWrite(n.batchId,e))),await Pd(t)}var n}(t,e),Ud(t)&&Vd(t)}function zd(t){return t.zr||(t.zr=function(t,e,n){const r=jo(t);return r.Cr(),new md(e,r.nr,r.credentials,r.N,n)}(t.datastore,t.asyncQueue,{Si:Cd.bind(null,t),Ci:Rd.bind(null,t),Tr:xd.bind(null,t)}),t.jr.push((async e=>{e?(t.zr.hr(),Nd(t)?kd(t):t.Wr.set("Unknown")):(await t.zr.stop(),Dd(t))}))),t.zr}function Hd(t){return t.Hr||(t.Hr=function(t,e,n){const r=jo(t);return r.Cr(),new gd(e,r.nr,r.credentials,r.N,n)}(t.datastore,t.asyncQueue,{Si:jd.bind(null,t),Ci:Kd.bind(null,t),Vr:qd.bind(null,t),vr:Bd.bind(null,t)}),t.jr.push((async e=>{e?(t.Hr.hr(),await Pd(t)):(await t.Hr.stop(),t.Ur.length>0&&(Lo("RemoteStore",`Stopping write stream with ${t.Ur.length} pending writes`),t.Ur=[]))}))),t.Hr}class Gd{constructor(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Ko,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}static createAndSchedule(t,e,n,r,i){const s=Date.now()+n,o=new Gd(t,e,s,r,i);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Bo(qo.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function $d(t,e){if(Po("AsyncQueue",`${e}: ${t}`),Rh(t))return new Bo(qo.UNAVAILABLE,`${e}: ${t}`);throw t}class Wd{constructor(t){this.comparator=t?(e,n)=>t(e,n)||ba.comparator(e.key,n.key):(t,e)=>ba.comparator(t.key,e.key),this.keyedMap=hu(),this.sortedSet=new nu(this.comparator)}static emptySet(t){return new Wd(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof Wd))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(!t.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new Wd;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class Qd{constructor(){this.Jr=new nu(ba.comparator)}track(t){const e=t.doc.key,n=this.Jr.get(e);n?0!==t.type&&3===n.type?this.Jr=this.Jr.insert(e,t):3===t.type&&1!==n.type?this.Jr=this.Jr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Jr=this.Jr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Jr=this.Jr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Jr=this.Jr.remove(e):1===t.type&&2===n.type?this.Jr=this.Jr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Jr=this.Jr.insert(e,{type:2,doc:t.doc}):Uo():this.Jr=this.Jr.insert(e,t)}Yr(){const t=[];return this.Jr.inorderTraversal(((e,n)=>{t.push(n)})),t}}class Yd{constructor(t,e,n,r,i,s,o,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a}static fromInitialDocuments(t,e,n,r){const i=[];return e.forEach((t=>{i.push({type:0,doc:t})})),new Yd(t,e,Wd.emptySet(e),i,n,r,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&pc(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class Xd{constructor(){this.Xr=void 0,this.listeners=[]}}class Jd{constructor(){this.queries=new _l((t=>mc(t)),pc),this.onlineState="Unknown",this.Zr=new Set}}async function Zd(t,e){const n=jo(t),r=e.query;let i=!1,s=n.queries.get(r);if(s||(i=!0,s=new Xd),i)try{s.Xr=await n.onListen(r)}catch(t){const n=$d(t,`Initialization of query '${gc(e.query)}' failed`);return void e.onError(n)}n.queries.set(r,s),s.listeners.push(e),e.eo(n.onlineState),s.Xr&&e.no(s.Xr)&&rf(n)}async function tf(t,e){const n=jo(t),r=e.query;let i=!1;const s=n.queries.get(r);if(s){const t=s.listeners.indexOf(e);t>=0&&(s.listeners.splice(t,1),i=0===s.listeners.length)}if(i)return n.queries.delete(r),n.onUnlisten(r)}function ef(t,e){const n=jo(t);let r=!1;for(const t of e){const e=t.query,i=n.queries.get(e);if(i){for(const e of i.listeners)e.no(t)&&(r=!0);i.Xr=t}}r&&rf(n)}function nf(t,e,n){const r=jo(t),i=r.queries.get(e);if(i)for(const t of i.listeners)t.onError(n);r.queries.delete(e)}function rf(t){t.Zr.forEach((t=>{t.next()}))}class sf{constructor(t,e,n){this.query=t,this.so=e,this.io=!1,this.ro=null,this.onlineState="Unknown",this.options=n||{}}no(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new Yd(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}let e=!1;return this.io?this.oo(t)&&(this.so.next(t),e=!0):this.ao(t,this.onlineState)&&(this.co(t),e=!0),this.ro=t,e}onError(t){this.so.error(t)}eo(t){this.onlineState=t;let e=!1;return this.ro&&!this.io&&this.ao(this.ro,t)&&(this.co(this.ro),e=!0),e}ao(t,e){if(!t.fromCache)return!0;const n="Offline"!==e;return!(this.options.uo&&n||t.docs.isEmpty()&&"Offline"!==e)}oo(t){if(t.docChanges.length>0)return!0;const e=this.ro&&this.ro.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}co(t){t=Yd.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.io=!0,this.so.next(t)}}class of{constructor(t){this.key=t}}class af{constructor(t){this.key=t}}class cf{constructor(t,e){this.query=t,this._o=e,this.mo=null,this.current=!1,this.yo=fu(),this.mutatedKeys=fu(),this.po=vc(t),this.Eo=new Wd(this.po)}get To(){return this._o}Io(t,e){const n=e?e.Ao:new Qd,r=e?e.Eo:this.Eo;let i=e?e.mutatedKeys:this.mutatedKeys,s=r,o=!1;const a=ac(this.query)&&r.size===this.query.limit?r.last():null,c=cc(this.query)&&r.size===this.query.limit?r.first():null;if(t.inorderTraversal(((t,e)=>{const u=r.get(t),h=yc(this.query,e)?e:null,l=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations);let f=!1;u&&h?u.data.isEqual(h.data)?l!==d&&(n.track({type:3,doc:h}),f=!0):this.Ro(u,h)||(n.track({type:2,doc:h}),f=!0,(a&&this.po(h,a)>0||c&&this.po(h,c)<0)&&(o=!0)):!u&&h?(n.track({type:0,doc:h}),f=!0):u&&!h&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(h?(s=s.add(h),i=d?i.add(t):i.delete(t)):(s=s.delete(t),i=i.delete(t)))})),ac(this.query)||cc(this.query))for(;s.size>this.query.limit;){const t=ac(this.query)?s.last():s.first();s=s.delete(t.key),i=i.delete(t.key),n.track({type:1,doc:t})}return{Eo:s,Ao:n,Ln:o,mutatedKeys:i}}Ro(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n){const r=this.Eo;this.Eo=t.Eo,this.mutatedKeys=t.mutatedKeys;const i=t.Ao.Yr();i.sort(((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Uo()}};return n(t)-n(e)}(t.type,e.type)||this.po(t.doc,e.doc))),this.bo(n);const s=e?this.Po():[],o=0===this.yo.size&&this.current?1:0,a=o!==this.mo;return this.mo=o,0!==i.length||a?{snapshot:new Yd(this.query,t.Eo,r,i,t.mutatedKeys,0===o,a,!1),vo:s}:{vo:s}}eo(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({Eo:this.Eo,Ao:new Qd,mutatedKeys:this.mutatedKeys,Ln:!1},!1)):{vo:[]}}Vo(t){return!this._o.has(t)&&!!this.Eo.has(t)&&!this.Eo.get(t).hasLocalMutations}bo(t){t&&(t.addedDocuments.forEach((t=>this._o=this._o.add(t))),t.modifiedDocuments.forEach((t=>{})),t.removedDocuments.forEach((t=>this._o=this._o.delete(t))),this.current=t.current)}Po(){if(!this.current)return[];const t=this.yo;this.yo=fu(),this.Eo.forEach((t=>{this.Vo(t.key)&&(this.yo=this.yo.add(t.key))}));const e=[];return t.forEach((t=>{this.yo.has(t)||e.push(new af(t))})),this.yo.forEach((n=>{t.has(n)||e.push(new of(n))})),e}So(t){this._o=t.Gn,this.yo=fu();const e=this.Io(t.documents);return this.applyChanges(e,!0)}Do(){return Yd.fromInitialDocuments(this.query,this.Eo,this.mutatedKeys,0===this.mo)}}class uf{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class hf{constructor(t){this.key=t,this.Co=!1}}class lf{constructor(t,e,n,r,i,s){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.No={},this.xo=new _l((t=>mc(t)),pc),this.ko=new Map,this.$o=new Set,this.Oo=new nu(ba.comparator),this.Fo=new Map,this.Mo=new Ql,this.Lo={},this.Bo=new Map,this.Uo=fl.ie(),this.onlineState="Unknown",this.qo=void 0}get isPrimaryClient(){return!0===this.qo}}async function df(t,e){const n=function(t){const e=jo(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=pf.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Af.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=gf.bind(null,e),e.No.Tr=ef.bind(null,e.eventManager),e.No.jo=nf.bind(null,e.eventManager),e}(t);let r,i;const s=n.xo.get(e);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.Do();else{const t=await function(t,e){const n=jo(t);return n.persistence.runTransaction("Allocate target","readwrite",(t=>{let r;return n.ze.getTargetData(t,e).next((i=>i?(r=i,kh.resolve(r)):n.ze.allocateTargetId(t).next((i=>(r=new jh(e,i,0,t.currentSequenceNumber),n.ze.addTargetData(t,r).next((()=>r)))))))})).then((t=>{const r=n.Un.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Un=n.Un.insert(t.targetId,t),n.qn.set(e,t.targetId)),t}))}(n.localStore,fc(e)),s=n.sharedClientState.addLocalQueryTarget(t.targetId);r=t.targetId,i=await async function(t,e,n,r){t.Ko=(e,n,r)=>async function(t,e,n,r){let i=e.view.Io(n);i.Ln&&(i=await $l(t.localStore,e.query,!1).then((({documents:t})=>e.view.Io(t,i))));const s=r&&r.targetChanges.get(e.targetId),o=e.view.applyChanges(i,t.isPrimaryClient,s);return Ef(t,e.targetId,o.vo),o.snapshot}(t,e,n,r);const i=await $l(t.localStore,e,!0),s=new cf(e,i.Gn),o=s.Io(i.documents),a=yu.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState),c=s.applyChanges(o,t.isPrimaryClient,a);Ef(t,n,c.vo);const u=new uf(e,n,s);return t.xo.set(e,u),t.ko.has(n)?t.ko.get(n).push(e):t.ko.set(n,[e]),c.snapshot}(n,e,r,"current"===s),n.isPrimaryClient&&Td(n.remoteStore,t)}return i}async function ff(t,e){const n=jo(t),r=n.xo.get(e),i=n.ko.get(r.targetId);if(i.length>1)return n.ko.set(r.targetId,i.filter((t=>!pc(t,e)))),void n.xo.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await Gl(n.localStore,r.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(r.targetId),Ed(n.remoteStore,r.targetId),bf(n,r.targetId)})).catch(vl)):(bf(n,r.targetId),await Gl(n.localStore,r.targetId,!0))}async function pf(t,e){const n=jo(t);try{const t=await function(t,e){const n=jo(t),r=e.snapshotVersion;let i=n.Un;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(t=>{const s=n.jn.newChangeBuffer({trackRemovals:!0});i=n.Un;const o=[];e.targetChanges.forEach(((e,s)=>{const a=i.get(s);if(!a)return;o.push(n.ze.removeMatchingKeys(t,e.removedDocuments,s).next((()=>n.ze.addMatchingKeys(t,e.addedDocuments,s))));const c=e.resumeToken;if(c.approximateByteSize()>0){const u=a.withResumeToken(c,r).withSequenceNumber(t.currentSequenceNumber);i=i.insert(s,u),function(t,e,n){return Vo(e.resumeToken.approximateByteSize()>0),0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(a,u,e)&&o.push(n.ze.updateTargetData(t,u))}}));let a=cu();if(e.documentUpdates.forEach(((r,i)=>{e.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))})),o.push(function(t,e,n,r,i){let s=fu();return n.forEach((t=>s=s.add(t))),e.getEntries(t,s).next((t=>{let s=cu();return n.forEach(((n,o)=>{const a=t.get(n),c=(null==i?void 0:i.get(n))||r;o.isNoDocument()&&o.version.isEqual(na.min())?(e.removeEntry(n,c),s=s.insert(n,o)):!a.isValidDocument()||o.version.compareTo(a.version)>0||0===o.version.compareTo(a.version)&&a.hasPendingWrites?(e.addEntry(o,c),s=s.insert(n,o)):Lo("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",o.version)})),s}))}(t,s,e.documentUpdates,r,void 0).next((t=>{a=t}))),!r.isEqual(na.min())){const e=n.ze.getLastRemoteSnapshotVersion(t).next((e=>n.ze.setTargetsMetadata(t,t.currentSequenceNumber,r)));o.push(e)}return kh.waitFor(o).next((()=>s.apply(t))).next((()=>n.Qn.vn(t,a))).next((()=>a))})).then((t=>(n.Un=i,t)))}(n.localStore,e);e.targetChanges.forEach(((t,e)=>{const r=n.Fo.get(e);r&&(Vo(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.Co=!0:t.modifiedDocuments.size>0?Vo(r.Co):t.removedDocuments.size>0&&(Vo(r.Co),r.Co=!1))})),await kf(n,t,e)}catch(t){await vl(t)}}function mf(t,e,n){const r=jo(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const t=[];r.xo.forEach(((n,r)=>{const i=r.view.eo(e);i.snapshot&&t.push(i.snapshot)})),function(t,e){const n=jo(t);n.onlineState=e;let r=!1;n.queries.forEach(((t,n)=>{for(const t of n.listeners)t.eo(e)&&(r=!0)})),r&&rf(n)}(r.eventManager,e),t.length&&r.No.Tr(t),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function gf(t,e,n){const r=jo(t);r.sharedClientState.updateQueryState(e,"rejected",n);const i=r.Fo.get(e),s=i&&i.key;if(s){let t=new nu(ba.comparator);t=t.insert(s,Ua.newNoDocument(s,na.min()));const n=fu().add(s),i=new gu(na.min(),new Map,new su(Jo),t,n);await pf(r,i),r.Oo=r.Oo.remove(s),r.Fo.delete(e),_f(r)}else await Gl(r.localStore,e,!1).then((()=>bf(r,e,n))).catch(vl)}async function yf(t,e){const n=jo(t),r=e.batch.batchId;try{const t=await function(t,e){const n=jo(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(t=>{const r=e.batch.keys(),i=n.jn.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){const i=n.batch,s=i.keys();let o=kh.resolve();return s.forEach((t=>{o=o.next((()=>r.getEntry(e,t))).next((e=>{const s=n.docVersions.get(t);Vo(null!==s),e.version.compareTo(s)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&r.addEntry(e,n.commitVersion))}))})),o.next((()=>t.In.removeMutationBatch(e,i)))}(n,t,e,i).next((()=>i.apply(t))).next((()=>n.In.performConsistencyCheck(t))).next((()=>n.Qn.Pn(t,r)))}))}(n.localStore,e);If(n,r,null),wf(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await kf(n,t)}catch(t){await vl(t)}}async function vf(t,e,n){const r=jo(t);try{const t=await function(t,e){const n=jo(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(t=>{let r;return n.In.lookupMutationBatch(t,e).next((e=>(Vo(null!==e),r=e.keys(),n.In.removeMutationBatch(t,e)))).next((()=>n.In.performConsistencyCheck(t))).next((()=>n.Qn.Pn(t,r)))}))}(r.localStore,e);If(r,e,n),wf(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await kf(r,t)}catch(n){await vl(n)}}function wf(t,e){(t.Bo.get(e)||[]).forEach((t=>{t.resolve()})),t.Bo.delete(e)}function If(t,e,n){const r=jo(t);let i=r.Lo[r.currentUser.toKey()];if(i){const t=i.get(e);t&&(n?t.reject(n):t.resolve(),i=i.remove(e)),r.Lo[r.currentUser.toKey()]=i}}function bf(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.ko.get(e))t.xo.delete(r),n&&t.No.jo(r,n);t.ko.delete(e),t.isPrimaryClient&&t.Mo.cs(e).forEach((e=>{t.Mo.containsKey(e)||Tf(t,e)}))}function Tf(t,e){t.$o.delete(e.path.canonicalString());const n=t.Oo.get(e);null!==n&&(Ed(t.remoteStore,n),t.Oo=t.Oo.remove(e),t.Fo.delete(n),_f(t))}function Ef(t,e,n){for(const r of n)r instanceof of?(t.Mo.addReference(r.key,e),Sf(t,r)):r instanceof af?(Lo("SyncEngine","Document no longer in limbo: "+r.key),t.Mo.removeReference(r.key,e),t.Mo.containsKey(r.key)||Tf(t,r.key)):Uo()}function Sf(t,e){const n=e.key,r=n.path.canonicalString();t.Oo.get(n)||t.$o.has(r)||(Lo("SyncEngine","New document in limbo: "+n),t.$o.add(r),_f(t))}function _f(t){for(;t.$o.size>0&&t.Oo.size<t.maxConcurrentLimboResolutions;){const e=t.$o.values().next().value;t.$o.delete(e);const n=new ba(aa.fromString(e)),r=t.Uo.next();t.Fo.set(r,new hf(n)),t.Oo=t.Oo.insert(n,r),Td(t.remoteStore,new jh(fc(oc(n.path)),r,2,Qo.T))}}async function kf(t,e,n){const r=jo(t),i=[],s=[],o=[];r.xo.isEmpty()||(r.xo.forEach(((t,a)=>{o.push(r.Ko(a,e,n).then((t=>{if(t){r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,t.fromCache?"not-current":"current"),i.push(t);const e=Vl.kn(a.targetId,t);s.push(e)}})))})),await Promise.all(o),r.No.Tr(i),await async function(t,e){const n=jo(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>kh.forEach(e,(e=>kh.forEach(e.Nn,(r=>n.persistence.referenceDelegate.addReference(t,e.targetId,r))).next((()=>kh.forEach(e.xn,(r=>n.persistence.referenceDelegate.removeReference(t,e.targetId,r)))))))))}catch(t){if(!Rh(t))throw t;Lo("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.Un.get(e),r=t.snapshotVersion,i=t.withLastLimboFreeSnapshotVersion(r);n.Un=n.Un.insert(e,i)}}}(r.localStore,s))}async function Nf(t,e){const n=jo(t);if(!n.currentUser.isEqual(e)){Lo("SyncEngine","User change. New user:",e.toKey());const t=await Kl(n.localStore,e);n.currentUser=e,function(t,e){t.Bo.forEach((t=>{t.forEach((t=>{t.reject(new Bo(qo.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.Bo.clear()}(n),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await kf(n,t.Wn)}}function Af(t,e){const n=jo(t),r=n.Fo.get(e);if(r&&r.Co)return fu().add(r.key);{let t=fu();const r=n.ko.get(e);if(!r)return t;for(const e of r){const r=n.xo.get(e);t=t.unionWith(r.view.To)}return t}}function Df(t){const e=jo(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=yf.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=vf.bind(null,e),e}class Cf{constructor(){this.synchronizeTabs=!1}async initialize(t){this.N=dd(t.databaseInfo.databaseId),this.sharedClientState=this.Wo(t),this.persistence=this.Go(t),await this.persistence.start(),this.gcScheduler=this.zo(t),this.localStore=this.Ho(t)}zo(t){return null}Ho(t){return Bl(this.persistence,new jl,t.initialUser,this.N)}Go(t){return new ed(rd.Ns,this.N)}Wo(t){return new sd}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Rf extends Cf{constructor(t,e,n){super(),this.Jo=t,this.cacheSizeBytes=e,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(t){await super.initialize(t),await async function(t){const e=jo(t);return e.persistence.runTransaction("Synchronize last document change read time","readonly",(t=>function(t){const e=Cl(t);let n=na.min();return e.Kt({index:ph.readTimeIndex,reverse:!0},((t,e,r)=>{e.readTime&&(n=function(t){const e=new ea(t[0],t[1]);return na.fromTimestamp(e)}(e.readTime)),r.done()})).next((()=>n))}(t))).then((t=>{e.Kn=t}))}(this.localStore),await this.Jo.initialize(this,t),await Df(this.Jo.syncEngine),await Pd(this.Jo.remoteStore),await this.persistence.nn((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(this.localStore),Promise.resolve())))}Ho(t){return Bl(this.persistence,new jl,t.initialUser,this.N)}zo(t){const e=this.persistence.referenceDelegate.garbageCollector;return new bl(e,t.asyncQueue)}Go(t){const e=function(t,e){let n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?sl.withCacheSize(this.cacheSizeBytes):sl.DEFAULT;return new Pl(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,"undefined"!=typeof window?window:null,ld(),this.N,this.sharedClientState,!!this.forceOwnership)}Wo(t){return new sd}}class xf{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>mf(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=Nf.bind(null,this.syncEngine),await async function(t,e){const n=jo(t);e?(n.Kr.delete(2),await Id(n)):e||(n.Kr.add(2),await bd(n),n.Wr.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new Jd}createDatastore(t){const e=dd(t.databaseInfo.databaseId),n=(r=t.databaseInfo,new hd(r));var r;return function(t,e,n){return new yd(t,e,n)}(t.credentials,n,e)}createRemoteStore(t){return e=this.localStore,n=this.datastore,r=t.asyncQueue,i=t=>mf(this.syncEngine,t,0),s=ad.bt()?new ad:new od,new wd(e,n,r,i,s);var e,n,r,i,s}createSyncEngine(t,e){return function(t,e,n,r,i,s,o){const a=new lf(t,e,n,r,i,s);return o&&(a.qo=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}terminate(){return async function(t){const e=jo(t);Lo("RemoteStore","RemoteStore shutting down."),e.Kr.add(5),await bd(e),e.Qr.shutdown(),e.Wr.set("Unknown")}(this.remoteStore)}}class Of{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Yo(this.observer.next,t)}error(t){this.observer.error?this.Yo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)}Xo(){this.muted=!0}Yo(t,e){this.muted||setTimeout((()=>{this.muted||t(e)}),0)}}class Lf{constructor(t,e,n){this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=Co.UNAUTHENTICATED,this.clientId=Xo.I(),this.credentialListener=()=>Promise.resolve(),this.credentials.start(e,(async t=>{Lo("FirestoreClient","Received user=",t.uid),await this.credentialListener(t),this.user=t}))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.credentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Bo(qo.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new Ko;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.credentials.shutdown(),t.resolve()}catch(e){const n=$d(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function Pf(t,e){t.asyncQueue.verifyOperationInProgress(),Lo("FirestoreClient","Initializing OfflineComponentProvider");const n=await t.getConfiguration();await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener((async t=>{r.isEqual(t)||(await Kl(e.localStore,t),r=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t.offlineComponents=e}async function Mf(t,e){t.asyncQueue.verifyOperationInProgress();const n=await async function(t){return t.offlineComponents||(Lo("FirestoreClient","Using default OfflineComponentProvider"),await Pf(t,new Cf)),t.offlineComponents}(t);Lo("FirestoreClient","Initializing OnlineComponentProvider");const r=await t.getConfiguration();await e.initialize(n,r),t.setCredentialChangeListener((t=>async function(t,e){const n=jo(t);n.asyncQueue.verifyOperationInProgress(),Lo("RemoteStore","RemoteStore received new credentials");const r=Ad(n);n.Kr.add(3),await bd(n),r&&n.Wr.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Kr.delete(3),await Id(n)}(e.remoteStore,t))),t.onlineComponents=e}async function Ff(t){return t.onlineComponents||(Lo("FirestoreClient","Using default OnlineComponentProvider"),await Mf(t,new xf)),t.onlineComponents}async function Uf(t){const e=await Ff(t),n=e.eventManager;return n.onListen=df.bind(null,e.syncEngine),n.onUnlisten=ff.bind(null,e.syncEngine),n}class Vf{constructor(t,e,n,r,i,s,o,a){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.useFetchStreams=a}}class jf{constructor(t,e){this.projectId=t,this.database=e||"(default)"}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof jf&&t.projectId===this.projectId&&t.database===this.database}}const qf=new Map;function Bf(t,e,n){if(!n)throw new Bo(qo.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function Kf(t){if(!ba.isDocumentKey(t))throw new Bo(qo.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function zf(t){if(ba.isDocumentKey(t))throw new Bo(qo.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function Hf(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":Uo()}function Gf(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Bo(qo.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Hf(t);throw new Bo(qo.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}class $f{constructor(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new Bo(qo.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Bo(qo.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,function(t,e,n,r){if(!0===e&&!0===r)throw new Bo(qo.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")}(0,t.experimentalForceLongPolling,0,t.experimentalAutoDetectLongPolling)}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class Wf{constructor(t,e){this._credentials=e,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new $f({}),this._settingsFrozen=!1,t instanceof jf?this._databaseId=t:(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Bo(qo.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new jf(t.options.projectId)}(t))}get app(){if(!this._app)throw new Bo(qo.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new Bo(qo.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new $f(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new Ho;switch(t.type){case"gapi":const e=t.client;return Vo(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Wo(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new Bo(qo.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=qf.get(t);e&&(Lo("ComponentProvider","Removing Datastore"),qf.delete(t),e.terminate())}(this),Promise.resolve()}}class Qf{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Xf(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new Qf(this.firestore,t,this._key)}}class Yf{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new Yf(this.firestore,t,this._query)}}class Xf extends Yf{constructor(t,e,n){super(t,e,oc(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new Qf(this.firestore,null,new ba(t))}withConverter(t){return new Xf(this.firestore,t,this._path)}}function Jf(t,e,...n){if(t=T(t),Bf("collection","path",e),t instanceof Wf){const r=aa.fromString(e,...n);return zf(r),new Xf(t,null,r)}{if(!(t instanceof Qf||t instanceof Xf))throw new Bo(qo.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(aa.fromString(e,...n));return zf(r),new Xf(t.firestore,null,r)}}function Zf(t,e,...n){if(t=T(t),1===arguments.length&&(e=Xo.I()),Bf("doc","path",e),t instanceof Wf){const r=aa.fromString(e,...n);return Kf(r),new Qf(t,null,new ba(r))}{if(!(t instanceof Qf||t instanceof Xf))throw new Bo(qo.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(aa.fromString(e,...n));return Kf(r),new Qf(t.firestore,t instanceof Xf?t.converter:null,new ba(r))}}class tp{constructor(){this.fa=Promise.resolve(),this.da=[],this.wa=!1,this._a=[],this.ma=null,this.ga=!1,this.ya=!1,this.pa=[],this.rr=new fd(this,"async_queue_retry"),this.Ea=()=>{const t=ld();t&&Lo("AsyncQueue","Visibility state changed to "+t.visibilityState),this.rr.tr()};const t=ld();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Ea)}get isShuttingDown(){return this.wa}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Ta(),this.Ia(t)}enterRestrictedMode(t){if(!this.wa){this.wa=!0,this.ya=t||!1;const e=ld();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.Ea)}}enqueue(t){if(this.Ta(),this.wa)return new Promise((()=>{}));const e=new Ko;return this.Ia((()=>this.wa&&this.ya?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.da.push(t),this.Aa())))}async Aa(){if(0!==this.da.length){try{await this.da[0](),this.da.shift(),this.rr.reset()}catch(t){if(!Rh(t))throw t;Lo("AsyncQueue","Operation failed with retryable error: "+t)}this.da.length>0&&this.rr.Xi((()=>this.Aa()))}}Ia(t){const e=this.fa.then((()=>(this.ga=!0,t().catch((t=>{throw this.ma=t,this.ga=!1,Po("INTERNAL UNHANDLED ERROR: ",function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t})).then((t=>(this.ga=!1,t))))));return this.fa=e,e}enqueueAfterDelay(t,e,n){this.Ta(),this.pa.indexOf(t)>-1&&(e=0);const r=Gd.createAndSchedule(this,t,e,n,(t=>this.Ra(t)));return this._a.push(r),r}Ta(){this.ma&&Uo()}verifyOperationInProgress(){}async ba(){let t;do{t=this.fa,await t}while(t!==this.fa)}Pa(t){for(const e of this._a)if(e.timerId===t)return!0;return!1}va(t){return this.ba().then((()=>{this._a.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this._a)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.ba()}))}Va(t){this.pa.push(t)}Ra(t){const e=this._a.indexOf(t);this._a.splice(e,1)}}function ep(t){return function(t,e){if("object"!=typeof t||null===t)return!1;const n=t;for(const t of["next","error","complete"])if(t in n&&"function"==typeof n[t])return!0;return!1}(t)}class np extends Wf{constructor(t,e){super(t,e),this.type="firestore",this._queue=new tp,this._persistenceKey="name"in t?t.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||ip(this),this._firestoreClient.terminate()}}function rp(t){return t._firestoreClient||ip(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function ip(t){var e;const n=t._freezeSettings(),r=function(t,e,n,r){return new Vf(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new Lf(t._credentials,t._queue,r)}function sp(t,e){!function(t){if(t._initialized||t._terminated)throw new Bo(qo.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}(t=Gf(t,np));const n=rp(t),r=t._freezeSettings(),i=new xf;return function(t,e,n){const r=new Ko;return t.asyncQueue.enqueue((async()=>{try{await Pf(t,n),await Mf(t,e),r.resolve()}catch(t){if(!function(t){return"FirebaseError"===t.name?t.code===qo.FAILED_PRECONDITION||t.code===qo.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(t))throw t;console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+t),r.reject(t)}})).then((()=>r.promise))}(n,i,new Rf(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}class op{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new Bo(qo.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ua(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class ap{constructor(t){this._byteString=t}static fromBase64String(t){try{return new ap(la.fromBase64String(t))}catch(t){throw new Bo(qo.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new ap(la.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class cp{constructor(t){this._methodName=t}}class up{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new Bo(qo.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Bo(qo.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return Jo(this._lat,t._lat)||Jo(this._long,t._long)}}const hp=/^__.*__$/;class lp{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return null!==this.fieldMask?new Gc(t,this.data,this.fieldMask,e,this.fieldTransforms):new Hc(t,this.data,e,this.fieldTransforms)}}function dp(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Uo()}}class fp{constructor(t,e,n,r,i,s){this.settings=t,this.databaseId=e,this.N=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Sa(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Da(){return this.settings.Da}Ca(t){return new fp(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.N,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Na(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Ca({path:n,xa:!1});return r.ka(t),r}$a(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Ca({path:n,xa:!1});return r.Sa(),r}Oa(t){return this.Ca({path:void 0,xa:!0})}Fa(t){return Sp(t,this.settings.methodName,this.settings.Ma||!1,this.path,this.settings.La)}contains(t){return void 0!==this.fieldMask.find((e=>t.isPrefixOf(e)))||void 0!==this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))}Sa(){if(this.path)for(let t=0;t<this.path.length;t++)this.ka(this.path.get(t))}ka(t){if(0===t.length)throw this.Fa("Document fields must not be empty");if(dp(this.Da)&&hp.test(t))throw this.Fa('Document fields cannot begin and end with "__"')}}class pp{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.N=n||dd(t)}Ba(t,e,n,r=!1){return new fp({Da:t,methodName:e,La:n,path:ua.emptyPath(),xa:!1,Ma:r},this.databaseId,this.N,this.ignoreUndefinedProperties)}}function mp(t){const e=t._freezeSettings(),n=dd(t._databaseId);return new pp(t._databaseId,!!e.ignoreUndefinedProperties,n)}function gp(t,e,n,r,i,s={}){const o=t.Ba(s.merge||s.mergeFields?2:0,e,n,i);Ip("Data must be an object, but it was:",o,r);const a=vp(r,o);let c,u;if(s.merge)c=new ha(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){const t=[];for(const r of s.mergeFields){const i=bp(e,r,n);if(!o.contains(i))throw new Bo(qo.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);_p(t,i)||t.push(i)}c=new ha(t),u=o.fieldTransforms.filter((t=>c.covers(t.field)))}else c=null,u=o.fieldTransforms;return new lp(new Ma(a),c,u)}function yp(t,e){if(wp(t=T(t)))return Ip("Unsupported field value:",e,t),vp(t,e);if(t instanceof cp)return function(t,e){if(!dp(e.Da))throw e.Fa(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e.Fa(`${t._methodName}() is not currently supported inside arrays`);const n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.xa&&4!==e.Da)throw e.Fa("Nested arrays are not supported");return function(t,e){const n=[];let r=0;for(const i of t){let t=yp(i,e.Oa(r));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=T(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Tc(e.N,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=ea.fromDate(t);return{timestampValue:Au(e.N,n)}}if(t instanceof ea){const n=new ea(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:Au(e.N,n)}}if(t instanceof up)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof ap)return{bytesValue:Du(e.N,t._byteString)};if(t instanceof Qf){const n=e.databaseId,r=t.firestore._databaseId;if(!r.isEqual(n))throw e.Fa(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:xu(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Fa(`Unsupported field value: ${Hf(t)}`)}(t,e)}function vp(t,e){const n={};return sa(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):ia(t,((t,r)=>{const i=yp(r,e.Na(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function wp(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof ea||t instanceof up||t instanceof ap||t instanceof Qf||t instanceof cp)}function Ip(t,e,n){if(!wp(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){const r=Hf(n);throw"an object"===r?e.Fa(t+" a custom object"):e.Fa(t+" "+r)}}function bp(t,e,n){if((e=T(e))instanceof op)return e._internalPath;if("string"==typeof e)return Ep(t,e);throw Sp("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}const Tp=new RegExp("[~\\*/\\[\\]]");function Ep(t,e,n){if(e.search(Tp)>=0)throw Sp(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new op(...e.split("."))._internalPath}catch(r){throw Sp(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Sp(t,e,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new Bo(qo.INVALID_ARGUMENT,a+t+c)}function _p(t,e){return t.some((t=>t.isEqual(e)))}class kp{constructor(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Qf(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new Np(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(Ap("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class Np extends kp{data(){return super.data()}}function Ap(t,e){return"string"==typeof e?Ep(t,e):e instanceof op?e._internalPath:e._delegate._internalPath}class Dp{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Cp extends kp{constructor(t,e,n,r,i,s){super(t,e,n,r,s),this._firestore=t,this._firestoreImpl=t,this.metadata=i}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new Rp(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(Ap("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class Rp extends Cp{data(t={}){return super.data(t)}}class xp{constructor(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new Dp(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach((n=>{t.call(e,new Rp(this._firestore,this._userDataWriter,n.key,n,new Dp(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new Bo(qo.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map((n=>({type:"added",doc:new Rp(t._firestore,t._userDataWriter,n.doc.key,n.doc,new Dp(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter),oldIndex:-1,newIndex:e++})))}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((t=>e||3!==t.type)).map((e=>{const r=new Rp(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Dp(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let i=-1,s=-1;return 0!==e.type&&(i=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(n=n.add(e.doc),s=n.indexOf(e.doc.key)),{type:Op(e.type),doc:r,oldIndex:i,newIndex:s}}))}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function Op(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Uo()}}function Lp(t,...e){for(const n of e)t=n._apply(t);return t}class Pp extends class{}{constructor(t,e,n){super(),this.Ka=t,this.ja=e,this.Qa=n,this.type="where"}_apply(t){const e=mp(t.firestore),n=function(t,e,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new Bo(qo.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on FieldPath.documentId().`);if("in"===s||"not-in"===s){Up(o,s);const e=[];for(const n of o)e.push(Fp(r,t,n));a={arrayValue:{values:e}}}else a=Fp(r,t,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||Up(o,s),a=function(t,e,n,r=!1){return yp(n,t.Ba(r?4:3,e))}(n,"where",o,"in"===s||"not-in"===s);const c=za.create(i,s,a);return function(t,e){if(e.v()){const n=hc(t);if(null!==n&&!n.isEqual(e.field))throw new Bo(qo.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${e.field.toString()}'`);const r=uc(t);null!==r&&function(t,e,n){if(!n.isEqual(e))throw new Bo(qo.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}(0,e.field,r)}const n=function(t,e){for(const n of t.filters)if(e.indexOf(n.op)>=0)return n.op;return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==n)throw n===e.op?new Bo(qo.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Bo(qo.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}(t,c),c}(t._query,0,e,t.firestore._databaseId,this.Ka,this.ja,this.Qa);return new Yf(t.firestore,t.converter,function(t,e){const n=t.filters.concat([e]);return new sc(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t._query,n))}}function Mp(t,e,n){const r=e,i=Ap("where",t);return new Pp(i,r,n)}function Fp(t,e,n){if("string"==typeof(n=T(n))){if(""===n)throw new Bo(qo.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!lc(e)&&-1!==n.indexOf("/"))throw new Bo(qo.INVALID_ARGUMENT,`Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(aa.fromString(n));if(!ba.isDocumentKey(r))throw new Bo(qo.INVALID_ARGUMENT,`Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Da(t,new ba(r))}if(n instanceof Qf)return Da(t,n._key);throw new Bo(qo.INVALID_ARGUMENT,`Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: ${Hf(n)}.`)}function Up(t,e){if(!Array.isArray(t)||0===t.length)throw new Bo(qo.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(t.length>10)throw new Bo(qo.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`)}function Vp(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}function jp(t){t=Gf(t,Qf);const e=Gf(t.firestore,np);return function(t,e,n={}){const r=new Ko;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,r,i){const s=new Of({next:s=>{e.enqueueAndForget((()=>tf(t,o)));const a=s.docs.has(n);!a&&s.fromCache?i.reject(new Bo(qo.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&s.fromCache&&r&&"server"===r.source?i.reject(new Bo(qo.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(s)},error:t=>i.reject(t)}),o=new sf(oc(n.path),s,{includeMetadataChanges:!0,uo:!0});return Zd(t,o)}(await Uf(t),t.asyncQueue,e,n,r))),r.promise}(rp(e),t._key).then((n=>$p(e,t,n)))}class qp extends class{convertValue(t,e="none"){switch(Ta(t)){case 0:return null;case 1:return t.booleanValue;case 2:return pa(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(ma(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw Uo()}}convertObject(t,e){const n={};return ia(t.fields,((t,r)=>{n[t]=this.convertValue(r,e)})),n}convertGeoPoint(t){return new up(pa(t.latitude),pa(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=ya(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(va(t));default:return null}}convertTimestamp(t){const e=fa(t);return new ea(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=aa.fromString(t);Vo(nh(n));const r=new jf(n.get(1),n.get(3)),i=new ba(n.popFirst(5));return r.isEqual(e)||Po(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),i}}{constructor(t){super(),this.firestore=t}convertBytes(t){return new ap(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new Qf(this.firestore,null,e)}}function Bp(t,e,n){t=Gf(t,Qf);const r=Gf(t.firestore,np),i=Vp(t.converter,e,n);return Gp(r,[gp(mp(r),"setDoc",t._key,i,null!==t.converter,n).toMutation(t._key,Fc.none())])}function Kp(t){return Gp(Gf(t.firestore,np),[new Yc(t._key,Fc.none())])}function zp(t,e){const n=Gf(t.firestore,np),r=Zf(t),i=Vp(t.converter,e);return Gp(n,[gp(mp(t.firestore),"addDoc",r._key,i,null!==t.converter,{}).toMutation(r._key,Fc.exists(!1))]).then((()=>r))}function Hp(t,...e){var n,r,i;t=T(t);let s={includeMetadataChanges:!1},o=0;"object"!=typeof e[o]||ep(e[o])||(s=e[o],o++);const a={includeMetadataChanges:s.includeMetadataChanges};if(ep(e[o])){const t=e[o];e[o]=null===(n=t.next)||void 0===n?void 0:n.bind(t),e[o+1]=null===(r=t.error)||void 0===r?void 0:r.bind(t),e[o+2]=null===(i=t.complete)||void 0===i?void 0:i.bind(t)}let c,u,h;if(t instanceof Qf)u=Gf(t.firestore,np),h=oc(t._key.path),c={next:n=>{e[o]&&e[o]($p(u,t,n))},error:e[o+1],complete:e[o+2]};else{const n=Gf(t,Yf);u=Gf(n.firestore,np),h=n._query;const r=new qp(u);c={next:t=>{e[o]&&e[o](new xp(u,r,n,t))},error:e[o+1],complete:e[o+2]},function(t){if(cc(t)&&0===t.explicitOrderBy.length)throw new Bo(qo.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(t._query)}return function(t,e,n,r){const i=new Of(r),s=new sf(e,i,n);return t.asyncQueue.enqueueAndForget((async()=>Zd(await Uf(t),s))),()=>{i.Xo(),t.asyncQueue.enqueueAndForget((async()=>tf(await Uf(t),s)))}}(rp(u),h,a,c)}function Gp(t,e){return function(t,e){const n=new Ko;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){const r=Df(t);try{const t=await function(t,e){const n=jo(t),r=ea.now(),i=e.reduce(((t,e)=>t.add(e.key)),fu());let s;return n.persistence.runTransaction("Locally write mutations","readwrite",(t=>n.Qn.Pn(t,i).next((i=>{s=i;const o=[];for(const t of e){const e=Bc(t,s.get(t.key));null!=e&&o.push(new Gc(t.key,e,Fa(e.value.mapValue),Fc.exists(!0)))}return n.In.addMutationBatch(t,r,o,e)})))).then((t=>(t.applyToLocalDocumentSet(s),{batchId:t.batchId,changes:s})))}(r.localStore,e);r.sharedClientState.addPendingMutation(t.batchId),function(t,e,n){let r=t.Lo[t.currentUser.toKey()];r||(r=new nu(Jo)),r=r.insert(e,n),t.Lo[t.currentUser.toKey()]=r}(r,t.batchId,n),await kf(r,t.changes),await Pd(r.remoteStore)}catch(t){const e=$d(t,"Failed to persist write");n.reject(e)}}(await function(t){return Ff(t).then((t=>t.syncEngine))}(t),e,n))),n.promise}(rp(t),e)}function $p(t,e,n){const r=n.docs.get(e._key),i=new qp(t);return new Cp(t,i,e._key,r,new Dp(n.hasPendingWrites,n.fromCache),e.converter)}Ro="9.1.0",q(new E("firestore",((t,{options:e})=>{const n=t.getProvider("app").getImmediate(),r=new np(n,new Go(t.getProvider("auth-internal")));return e=Object.assign({useFetchStreams:!0},e),r._setSettings(e),r}),"PUBLIC")),$("@firebase/firestore","3.1.0",void 0);var Wp=function(t,e={}){"object"!=typeof e&&(e={name:e});const n=Object.assign({name:"[DEFAULT]",automaticDataCollectionEnabled:!1},e),r=n.name;if("string"!=typeof r||!r)throw K.create("bad-app-name",{appName:String(r)});const i=U.get(r);if(i){if(m(t,i.options)&&m(n,i.config))return i;throw K.create("duplicate-app",{appName:r})}const s=new k(r);for(const t of V.values())s.addComponent(t);const o=new z(t,n,s);return U.set(r,o),o}({apiKey:"AIzaSyAW-KupdKMzfeJE6XfRf4Qjwyd3efR4LxE",authDomain:"myproducts-70c74.firebaseapp.com",projectId:"myproducts-70c74",appId:"1:343263943960:web:9a0a16ffc1a93da7a1126d",measurementId:"G-LB5YXBZDZV"}),Qp=function(t=G()){const e=B(t,"auth");return e.isInitialized()?e.getImmediate():function(t,e){const n=B(t,"auth");if(n.isInitialized()){const t=n.getImmediate();if(m(n.getOptions(),null!=e?e:{}))return t;J(t,"already-initialized")}return n.initialize({options:e})}(t,{popupRedirectResolver:gn,persistence:[Fe,Ie,Te]})}(Wp),Yp=function(t=G()){return B(t,"firestore").getImmediate()}(Wp);function Xp(t,e){if(t){if("string"==typeof t)return Jp(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Jp(t,e):void 0}}function Jp(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Zp=function(t){var e,n,r,i="",s=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=Xp(t))){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,a=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){a=!0,s=t},f:function(){try{o||null==n.return||n.return()}finally{if(a)throw s}}}}(t);try{for(s.s();!(e=s.n()).done;){var o=(n=e.value,r=2,function(t){if(Array.isArray(t))return t}(n)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,s=[],o=!0,a=!1;try{for(n=n.call(t);!(o=(r=n.next()).done)&&(s.push(r.value),!e||s.length!==e);o=!0);}catch(t){a=!0,i=t}finally{try{o||null==n.return||n.return()}finally{if(a)throw i}}return s}}(n,r)||Xp(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=o[0],c=o[1];i+='\n      <li>\n        <div class="product-info">\n          <span class="product-name">'.concat(c.name,'</span>\n          <span class="product-description">').concat(c.description,'</span>\n        </div>\n\n        <div class="actions">\n          <a href="#" title="Excluir produto" class="delete-product" data-id="').concat(a,'">\n            <img\n              src="/assets/images/trash.svg"\n              alt="Lixeira"\n              width="24"\n              height="24"\n            />\n          </a>\n        </div>\n      </li>\n    ')}}catch(t){s.e(t)}finally{s.f()}return i},tm=function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=document.querySelector("ul.product-list");n.innerHTML=t||1!=e?t||0!=e?t:"<p>Parece que voc ainda no adicionou nada...</p>":"<p>Faa login para ver seus produtos.</p>"};function em(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return nm(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?nm(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,a=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){a=!0,s=t},f:function(){try{o||null==n.return||n.return()}finally{if(a)throw s}}}}function nm(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function rm(t,e,n,r,i,s,o){try{var a=t[s](o),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(r,i)}function im(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var s=t.apply(e,n);function o(t){rm(s,r,i,o,a,"next",t)}function a(t){rm(s,r,i,o,a,"throw",t)}o(void 0)}))}}var sm=function(){var t=im(regeneratorRuntime.mark((function t(e){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:n=em(e);try{for(n.s();!(r=n.n()).done;)r.value.querySelector("a.delete-product").addEventListener("click",function(){var t=im(regeneratorRuntime.mark((function t(e){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.preventDefault(),"img"==(n=e.target).tagName.toLowerCase()&&(n=n.parentElement),r=n.dataset.id,t.next=6,cm(r);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}catch(t){n.e(t)}finally{n.f()}case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),om=function(){var t=im(regeneratorRuntime.mark((function t(e){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Jf(Yp,"products"),r=Lp(n,Mp("owner_id","==",e)),t.abrupt("return",Hp(r,(function(t){var e=[];t.forEach((function(t){e.push([t.id,t.data()])}));var n=Zp(e);if(tm(n,!1),n){var r=Array.from(document.querySelectorAll("ul.product-list li"));sm(r)}}),(function(t){return console.log(t)})));case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),am=function(){var t=im(regeneratorRuntime.mark((function t(e){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:return n=Jf(Yp,"products"),t.next=5,zp(n,e);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),cm=function(){var t=im(regeneratorRuntime.mark((function t(e){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:return n=Zf(Yp,"products",e),t.next=5,Kp(n);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),um=function(){var t=im(regeneratorRuntime.mark((function t(e,n){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e&&n){t.next=2;break}return t.abrupt("return");case 2:return r=Zf(Yp,"users",e),t.next=5,Bp(r,n);case 5:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),hm=function(){var t=im(regeneratorRuntime.mark((function t(e){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:return n=Zf(Yp,"users",e),t.next=5,jp(n);case 5:return r=t.sent,t.abrupt("return",r.data());case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),lm=function(){var t=im(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,sp(Yp,{});case 3:t.next=9;break;case 5:t.prev=5,t.t0=t.catch(0),"failed-precondition"==t.t0.code&&console.warn("Falha ao persistir dados."),"unimplemented"==t.t0.code&&console.warn("Seu navegador nao suporta persistncia de dados.");case 9:case"end":return t.stop()}}),t,null,[[0,5]])})));return function(){return t.apply(this,arguments)}}();function dm(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return fm(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?fm(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,a=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){a=!0,s=t},f:function(){try{o||null==n.return||n.return()}finally{if(a)throw s}}}}function fm(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var pm,mm=document.querySelector("#page-header nav ul"),gm=document.querySelector("#page-header nav div.menu"),ym=document.getElementById("close-menu"),vm=function t(e){e&&e.preventDefault(),mm.style.display="none",ym.removeEventListener("click",t)},wm=function(){mm.style.display="flex",ym.addEventListener("click",vm)},Im=function(t){var e=Array.from(document.querySelectorAll("#page-header nav ul a.logged-in")),n=Array.from(document.querySelectorAll("#page-header nav ul a.logged-out"));if(t){var r,i=dm(e);try{for(i.s();!(r=i.n()).done;)r.value.style.display="block"}catch(t){i.e(t)}finally{i.f()}var s,o=dm(n);try{for(o.s();!(s=o.n()).done;)s.value.style.display="none"}catch(t){o.e(t)}finally{o.f()}}else{for(var a=0,c=e;a<c.length;a++)c[a].style.display="none";for(var u=0,h=n;u<h.length;u++)h[u].style.display="block"}},bm=function(t,e){var n,r=document.querySelector(".account-details");n=t&&e?"\n    <h2>Detalhes da Conta</h2>\n\n    <p>Logado como ".concat(e,"</p>\n\n    <p>").concat(t,"</p>\n  "):"\n      <h2>Detalhes da Conta</h2>\n\n      <p>Faa login para ver os detalhes da sua conta.</p>\n    ",r.innerHTML=n},Tm=function(t,e){if(t&&e){var n=t.querySelector("h2"),r=document.createElement("p");r.classList.add("alert"),r.innerText=e,n.insertAdjacentElement("afterend",r)}},Em=function(){Array.from(document.querySelectorAll("p.alert")).forEach((function(t){return t.remove()}))};function Sm(t,e,n,r,i,s,o){try{var a=t[s](o),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(r,i)}function _m(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var s=t.apply(e,n);function o(t){Sm(s,r,i,o,a,"next",t)}function a(t){Sm(s,r,i,o,a,"throw",t)}o(void 0)}))}}var km=function(){var t=_m(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:try{e=function(){return null},me(Qp,function(){var t=_m(regeneratorRuntime.mark((function t(n){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=12;break}return t.next=3,om(n.uid);case 3:return e=t.sent,pm=n.uid,t.next=7,hm(n.uid);case 7:r=t.sent,Im(n),bm(r.bio,n.email),t.next=17;break;case 12:return pm=null,Im(n),bm(),tm(null,!0),t.abrupt("return",e());case 17:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}catch(t){console.log(t)}case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),Nm=function(){var t=_m(regeneratorRuntime.mark((function t(){var e,n,r,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:try{e=document.getElementById("signup-form"),n=e["signup-email"],r=e["signup-password"],i=e.bio,e.addEventListener("submit",function(){var t=_m(regeneratorRuntime.mark((function t(s){var o,a,c,u,h;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,s.preventDefault(),Em(),o=n.value,a=r.value,c=i.value,t.next=8,fe(Qp,o,a);case 8:return u=t.sent,t.next=11,um(u.user.uid,{bio:c});case 11:xm("modal#signup-modal"),e.reset(),t.next=19;break;case 15:t.prev=15,t.t0=t.catch(0),"Firebase: Error (auth/email-already-in-use)."==t.t0.message&&(h="E-mail j em uso."),Tm(e,h);case 19:case"end":return t.stop()}}),t,null,[[0,15]])})));return function(e){return t.apply(this,arguments)}}())}catch(t){console.log(t)}case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),Am=function(){var t=_m(regeneratorRuntime.mark((function t(){var e,n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=document.getElementById("login-form"),n=e["login-email"],r=e["login-password"],e.addEventListener("submit",function(){var t=_m(regeneratorRuntime.mark((function t(i){var s,o,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i.preventDefault(),Em(),s=n.value,o=r.value,t.prev=4,t.next=7,pe(Qp,s,o);case 7:t.sent,xm(document.querySelector("modal#login-modal")),e.reset(),t.next=17;break;case 12:t.prev=12,t.t0=t.catch(4),"Firebase: Error (auth/wrong-password)."==t.t0.message&&(a="Senha incorreta."),"Firebase: Error (auth/user-not-found)."==t.t0.message&&(a="Usurio inexistente."),Tm(e,a);case 17:case"end":return t.stop()}}),t,null,[[4,12]])})));return function(e){return t.apply(this,arguments)}}());case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),Dm=function(){var t=_m(regeneratorRuntime.mark((function t(){var e,n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:try{e=document.getElementById("create-product-form"),n=document.getElementById("product-name"),r=document.getElementById("product-description"),e.addEventListener("submit",function(){var t=_m(regeneratorRuntime.mark((function t(i){var s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i.preventDefault(),s={name:n.value,description:r.value,owner_id:pm},xm("modal#create-product-modal"),e.reset(),t.next=6,am(s);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}catch(t){console.log(t)}case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),Cm=function(){var t=_m(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,ge(Qp);case 3:t.next=8;break;case 5:t.prev=5,t.t0=t.catch(0),console.log(t.t0);case 8:case"end":return t.stop()}}),t,null,[[0,5]])})));return function(){return t.apply(this,arguments)}}(),Rm=null,xm=function t(e){e instanceof HTMLElement&&(Rm=e);var n=Rm.querySelector("form");n&&n.reset(),Em(),Rm.classList.add("hide"),Rm.classList.remove("active"),Rm.removeEventListener("click",t)},Om=function(t,e){t&&e&&e.addEventListener("click",(function(e){var n=e.target;if("a"===n.tagName.toLowerCase()){e.preventDefault();var r=n.dataset.triggers;if("logout"===r)return void Cm();Rm=t.find((function(t){return t.dataset.target===r})),function(){if(Rm)Rm.classList.contains("hide")&&(vm(),Rm.classList.remove("hide"),Rm.classList.add("active"),Rm&&Rm.addEventListener("click",xm))}()}}))};function Lm(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Pm=Array.from(document.querySelectorAll(".modal"));function Mm(){var t,e=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Lm(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Lm(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,a=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){a=!0,s=t},f:function(){try{o||null==n.return||n.return()}finally{if(a)throw s}}}}(Pm);try{for(e.s();!(t=e.n()).done;)t.value.firstElementChild.addEventListener("click",(function(t){return t.stopPropagation()}))}catch(t){e.e(t)}finally{e.f()}}function Fm(t,e,n,r,i,s,o){try{var a=t[s](o),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(r,i)}function Um(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var s=t.apply(e,n);function o(t){Fm(s,r,i,o,a,"next",t)}function a(t){Fm(s,r,i,o,a,"throw",t)}o(void 0)}))}}window.addEventListener("load",Um(regeneratorRuntime.mark((function t(){var e,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=Array.from(document.querySelectorAll(".modal")),n=document.querySelector("#page-header nav ul"),!("serviceWorker"in navigator)){t.next=11;break}return t.prev=3,t.next=6,navigator.serviceWorker.register("/sw.js");case 6:t.next=11;break;case 8:t.prev=8,t.t0=t.catch(3),console.log(t.t0);case 11:lm(),km(),Mm(),gm.addEventListener("click",wm),Om(e,n),Nm(),Am(),Dm();case 19:case"end":return t.stop()}}),t,null,[[3,8]])}))))})()})();
//# sourceMappingURL=app.js.map